var Ms=Object.defineProperty;var no=o=>{throw TypeError(o)};var Rs=(o,t,e)=>t in o?Ms(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var N=(o,t,e)=>Rs(o,typeof t!="symbol"?t+"":t,e),Ps=(o,t,e)=>t.has(o)||no("Cannot "+e);var oo=(o,t,e)=>t.has(o)?no("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e);var mt=(o,t,e)=>(Ps(o,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Ls,Ds;function Ns(){return{geminiUrl:Ls,vertexUrl:Ds}}function bs(o,t,e){var n,i,s;if(!(!((n=o.httpOptions)===null||n===void 0)&&n.baseUrl)){const a=Ns();return o.vertexai?(i=a.vertexUrl)!==null&&i!==void 0?i:t:(s=a.geminiUrl)!==null&&s!==void 0?s:e}return o.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class st{}function x(o,t){const e=/\{([^}]+)\}/g;return o.replace(e,(n,i)=>{if(Object.prototype.hasOwnProperty.call(t,i)){const s=t[i];return s!=null?String(s):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function l(o,t,e){for(let s=0;s<t.length-1;s++){const a=t[s];if(a.endsWith("[]")){const u=a.slice(0,-2);if(!(u in o))if(Array.isArray(e))o[u]=Array.from({length:e.length},()=>({}));else throw new Error(`Value must be a list given an array path ${a}`);if(Array.isArray(o[u])){const d=o[u];if(Array.isArray(e))for(let c=0;c<d.length;c++){const f=d[c];l(f,t.slice(s+1),e[c])}else for(const c of d)l(c,t.slice(s+1),e)}return}else if(a.endsWith("[0]")){const u=a.slice(0,-3);u in o||(o[u]=[{}]);const d=o[u];l(d[0],t.slice(s+1),e);return}(!o[a]||typeof o[a]!="object")&&(o[a]={}),o=o[a]}const n=t[t.length-1],i=o[n];if(i!==void 0){if(!e||typeof e=="object"&&Object.keys(e).length===0||e===i)return;if(typeof i=="object"&&typeof e=="object"&&i!==null&&e!==null)Object.assign(i,e);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else o[n]=e}function r(o,t){try{if(t.length===1&&t[0]==="_self")return o;for(let e=0;e<t.length;e++){if(typeof o!="object"||o===null)return;const n=t[e];if(n.endsWith("[]")){const i=n.slice(0,-2);if(i in o){const s=o[i];return Array.isArray(s)?s.map(a=>r(a,t.slice(e+1))):void 0}else return}else o=o[n]}return o}catch(e){if(e instanceof TypeError)return;throw e}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function b(o,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(o.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function Ti(o,t){const e=b(o,t);return e?e.startsWith("publishers/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}`:e.startsWith("models/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/publishers/google/${e}`:e:""}function Ci(o,t){return Array.isArray(t)?t.map(e=>xt(o,e)):[xt(o,t)]}function xt(o,t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function Bs(o,t){const e=xt(o,t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Vs(o,t){const e=xt(o,t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function io(o,t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Ei(o,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>io(o,e)):[io(o,t)]}function nn(o){return o!=null&&typeof o=="object"&&"parts"in o&&Array.isArray(o.parts)}function so(o){return o!=null&&typeof o=="object"&&"functionCall"in o}function ro(o){return o!=null&&typeof o=="object"&&"functionResponse"in o}function J(o,t){if(t==null)throw new Error("ContentUnion is required");return nn(t)?t:{role:"user",parts:Ei(o,t)}}function Ii(o,t){if(!t)return[];if(o.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{const n=J(o,e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(o.isVertexAI()){const e=J(o,t);return e.parts&&e.parts.length>0&&e.parts[0].text!==void 0?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>J(o,e)):[J(o,t)]}function Se(o,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(so(t)||ro(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[J(o,t)]}const e=[],n=[],i=nn(t[0]);for(const s of t){const a=nn(s);if(a!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(a)e.push(s);else{if(so(s)||ro(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(s)}}return i||e.push({role:"user",parts:Ei(o,n)}),e}function wi(o,t){return t}function xi(o,t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Vt(o,t){return t}function Ut(o,t){if(!Array.isArray(t))throw new Error("tool is required and must be an array of Tools");return t}function Us(o,t,e,n=1){const i=!t.startsWith(`${e}/`)&&t.split("/").length===n;return o.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${o.getProject()}/${t}`:t.startsWith(`${e}/`)?`projects/${o.getProject()}/locations/${o.getLocation()}/${t}`:i?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}/${t}`:t:i?`${e}/${t}`:t}function _e(o,t){if(typeof t!="string")throw new Error("name must be a string");return Us(o,t,"cachedContents")}function Si(o,t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function ke(o,t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function $s(o){return o!=null&&typeof o=="object"&&"name"in o}function Fs(o){return o!=null&&typeof o=="object"&&"video"in o}function qs(o){return o!=null&&typeof o=="object"&&"uri"in o}function _i(o,t){var e;let n;if($s(t)&&(n=t.name),!(qs(t)&&(n=t.uri,n===void 0))&&!(Fs(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const s=n.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${n}`);n=s[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function ki(o,t){let e;return o.isVertexAI()?e=t?"publishers/google/models":"models":e=t?"models":"tunedModels",e}function Ai(o,t){for(const e of["models","tunedModels","publisherModels"])if(Gs(t,e))return t[e];return[]}function Gs(o,t){return o!==null&&typeof o=="object"&&t in o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Hs(o,t){const e={};if(r(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=r(t,["data"]);n!=null&&l(e,["data"],n);const i=r(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Ys(o,t){const e={};if(r(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=r(t,["thought"]);n!=null&&l(e,["thought"],n);const i=r(t,["inlineData"]);i!=null&&l(e,["inlineData"],Hs(o,i));const s=r(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const a=r(t,["executableCode"]);a!=null&&l(e,["executableCode"],a);const u=r(t,["fileData"]);u!=null&&l(e,["fileData"],u);const d=r(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);const c=r(t,["functionResponse"]);c!=null&&l(e,["functionResponse"],c);const f=r(t,["text"]);return f!=null&&l(e,["text"],f),e}function lo(o,t){const e={},n=r(t,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>Ys(o,a))),l(e,["parts"],s)}const i=r(t,["role"]);return i!=null&&l(e,["role"],i),e}function Ws(){return{}}function zs(o,t){const e={},n=r(t,["mode"]);n!=null&&l(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function Js(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],zs(o,n)),e}function Ks(o,t){const e={};if(r(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(t,["googleSearch"])!=null&&l(e,["googleSearch"],Ws());const i=r(t,["googleSearchRetrieval"]);if(i!=null&&l(e,["googleSearchRetrieval"],Js(o,i)),r(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");const s=r(t,["codeExecution"]);s!=null&&l(e,["codeExecution"],s);const a=r(t,["functionDeclarations"]);return a!=null&&l(e,["functionDeclarations"],a),e}function Os(o,t){const e={},n=r(t,["mode"]);n!=null&&l(e,["mode"],n);const i=r(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function Zs(o,t){const e={},n=r(t,["functionCallingConfig"]);if(n!=null&&l(e,["functionCallingConfig"],Os(o,n)),r(t,["retrievalConfig"])!==void 0)throw new Error("retrievalConfig parameter is not supported in Gemini API.");return e}function Qs(o,t,e){const n={},i=r(t,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);const s=r(t,["expireTime"]);e!==void 0&&s!=null&&l(e,["expireTime"],s);const a=r(t,["displayName"]);e!==void 0&&a!=null&&l(e,["displayName"],a);const u=r(t,["contents"]);if(e!==void 0&&u!=null){let p=Se(o,u);Array.isArray(p)&&(p=p.map(m=>lo(o,m))),l(e,["contents"],p)}const d=r(t,["systemInstruction"]);e!==void 0&&d!=null&&l(e,["systemInstruction"],lo(o,J(o,d)));const c=r(t,["tools"]);if(e!==void 0&&c!=null){let p=c;Array.isArray(p)&&(p=p.map(m=>Ks(o,m))),l(e,["tools"],p)}const f=r(t,["toolConfig"]);return e!==void 0&&f!=null&&l(e,["toolConfig"],Zs(o,f)),n}function Xs(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["model"],Ti(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],Qs(o,i,e)),e}function js(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["_url","name"],_e(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function er(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["_url","name"],_e(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function tr(o,t,e){const n={},i=r(t,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);const s=r(t,["expireTime"]);return e!==void 0&&s!=null&&l(e,["expireTime"],s),n}function nr(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["_url","name"],_e(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],tr(o,i,e)),e}function or(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const s=r(t,["pageToken"]);return e!==void 0&&s!=null&&l(e,["_query","pageToken"],s),n}function ir(o,t){const e={},n=r(t,["config"]);return n!=null&&l(e,["config"],or(o,n,e)),e}function sr(o,t){const e={},n=r(t,["displayName"]);n!=null&&l(e,["displayName"],n);const i=r(t,["data"]);i!=null&&l(e,["data"],i);const s=r(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function rr(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&l(e,["thought"],i);const s=r(t,["inlineData"]);s!=null&&l(e,["inlineData"],sr(o,s));const a=r(t,["codeExecutionResult"]);a!=null&&l(e,["codeExecutionResult"],a);const u=r(t,["executableCode"]);u!=null&&l(e,["executableCode"],u);const d=r(t,["fileData"]);d!=null&&l(e,["fileData"],d);const c=r(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);const f=r(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&l(e,["text"],p),e}function ao(o,t){const e={},n=r(t,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>rr(o,a))),l(e,["parts"],s)}const i=r(t,["role"]);return i!=null&&l(e,["role"],i),e}function lr(){return{}}function ar(o,t){const e={},n=r(t,["mode"]);n!=null&&l(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function ur(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],ar(o,n)),e}function cr(){return{}}function dr(o,t){const e={},n=r(t,["apiKeyString"]);return n!=null&&l(e,["apiKeyString"],n),e}function fr(o,t){const e={},n=r(t,["apiKeyConfig"]);n!=null&&l(e,["apiKeyConfig"],dr(o,n));const i=r(t,["authType"]);i!=null&&l(e,["authType"],i);const s=r(t,["googleServiceAccountConfig"]);s!=null&&l(e,["googleServiceAccountConfig"],s);const a=r(t,["httpBasicAuthConfig"]);a!=null&&l(e,["httpBasicAuthConfig"],a);const u=r(t,["oauthConfig"]);u!=null&&l(e,["oauthConfig"],u);const d=r(t,["oidcConfig"]);return d!=null&&l(e,["oidcConfig"],d),e}function pr(o,t){const e={},n=r(t,["authConfig"]);return n!=null&&l(e,["authConfig"],fr(o,n)),e}function mr(o,t){const e={},n=r(t,["retrieval"]);n!=null&&l(e,["retrieval"],n),r(t,["googleSearch"])!=null&&l(e,["googleSearch"],lr());const s=r(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],ur(o,s)),r(t,["enterpriseWebSearch"])!=null&&l(e,["enterpriseWebSearch"],cr());const u=r(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],pr(o,u));const d=r(t,["codeExecution"]);d!=null&&l(e,["codeExecution"],d);const c=r(t,["functionDeclarations"]);return c!=null&&l(e,["functionDeclarations"],c),e}function gr(o,t){const e={},n=r(t,["mode"]);n!=null&&l(e,["mode"],n);const i=r(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function hr(o,t){const e={},n=r(t,["latitude"]);n!=null&&l(e,["latitude"],n);const i=r(t,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function yr(o,t){const e={},n=r(t,["latLng"]);return n!=null&&l(e,["latLng"],hr(o,n)),e}function vr(o,t){const e={},n=r(t,["functionCallingConfig"]);n!=null&&l(e,["functionCallingConfig"],gr(o,n));const i=r(t,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],yr(o,i)),e}function Tr(o,t,e){const n={},i=r(t,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);const s=r(t,["expireTime"]);e!==void 0&&s!=null&&l(e,["expireTime"],s);const a=r(t,["displayName"]);e!==void 0&&a!=null&&l(e,["displayName"],a);const u=r(t,["contents"]);if(e!==void 0&&u!=null){let p=Se(o,u);Array.isArray(p)&&(p=p.map(m=>ao(o,m))),l(e,["contents"],p)}const d=r(t,["systemInstruction"]);e!==void 0&&d!=null&&l(e,["systemInstruction"],ao(o,J(o,d)));const c=r(t,["tools"]);if(e!==void 0&&c!=null){let p=c;Array.isArray(p)&&(p=p.map(m=>mr(o,m))),l(e,["tools"],p)}const f=r(t,["toolConfig"]);return e!==void 0&&f!=null&&l(e,["toolConfig"],vr(o,f)),n}function Cr(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["model"],Ti(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],Tr(o,i,e)),e}function Er(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["_url","name"],_e(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function Ir(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["_url","name"],_e(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function wr(o,t,e){const n={},i=r(t,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);const s=r(t,["expireTime"]);return e!==void 0&&s!=null&&l(e,["expireTime"],s),n}function xr(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["_url","name"],_e(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],wr(o,i,e)),e}function Sr(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const s=r(t,["pageToken"]);return e!==void 0&&s!=null&&l(e,["_query","pageToken"],s),n}function _r(o,t){const e={},n=r(t,["config"]);return n!=null&&l(e,["config"],Sr(o,n,e)),e}function Ct(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["displayName"]);i!=null&&l(e,["displayName"],i);const s=r(t,["model"]);s!=null&&l(e,["model"],s);const a=r(t,["createTime"]);a!=null&&l(e,["createTime"],a);const u=r(t,["updateTime"]);u!=null&&l(e,["updateTime"],u);const d=r(t,["expireTime"]);d!=null&&l(e,["expireTime"],d);const c=r(t,["usageMetadata"]);return c!=null&&l(e,["usageMetadata"],c),e}function kr(){return{}}function Ar(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);const i=r(t,["cachedContents"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>Ct(o,a))),l(e,["cachedContents"],s)}return e}function Et(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["displayName"]);i!=null&&l(e,["displayName"],i);const s=r(t,["model"]);s!=null&&l(e,["model"],s);const a=r(t,["createTime"]);a!=null&&l(e,["createTime"],a);const u=r(t,["updateTime"]);u!=null&&l(e,["updateTime"],u);const d=r(t,["expireTime"]);d!=null&&l(e,["expireTime"],d);const c=r(t,["usageMetadata"]);return c!=null&&l(e,["usageMetadata"],c),e}function Mr(){return{}}function Rr(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);const i=r(t,["cachedContents"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>Et(o,a))),l(e,["cachedContents"],s)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var We;(function(o){o.PAGED_ITEM_BATCH_JOBS="batchJobs",o.PAGED_ITEM_MODELS="models",o.PAGED_ITEM_TUNING_JOBS="tuningJobs",o.PAGED_ITEM_FILES="files",o.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(We||(We={}));class $t{constructor(t,e,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=e,this.init(t,n,i)}init(t,e,n){var i,s;this.nameInternal=t,this.pageInternal=e[this.nameInternal]||[],this.idxInternal=0;let a={config:{}};n?typeof n=="object"?a=Object.assign({},n):a=n:a={config:{}},a.config&&(a.config.pageToken=e.nextPageToken),this.paramsInternal=a,this.pageInternalSize=(s=(i=a.config)===null||i===void 0?void 0:i.pageSize)!==null&&s!==void 0?s:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var uo;(function(o){o.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",o.OUTCOME_OK="OUTCOME_OK",o.OUTCOME_FAILED="OUTCOME_FAILED",o.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(uo||(uo={}));var co;(function(o){o.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",o.PYTHON="PYTHON"})(co||(co={}));var fo;(function(o){o.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(fo||(fo={}));var po;(function(o){o.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",o.SEVERITY="SEVERITY",o.PROBABILITY="PROBABILITY"})(po||(po={}));var mo;(function(o){o.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE",o.OFF="OFF"})(mo||(mo={}));var go;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(go||(go={}));var ho;(function(o){o.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",o.NO_AUTH="NO_AUTH",o.API_KEY_AUTH="API_KEY_AUTH",o.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",o.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",o.OAUTH="OAUTH",o.OIDC_AUTH="OIDC_AUTH"})(ho||(ho={}));var ze;(function(o){o.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",o.STRING="STRING",o.NUMBER="NUMBER",o.INTEGER="INTEGER",o.BOOLEAN="BOOLEAN",o.ARRAY="ARRAY",o.OBJECT="OBJECT"})(ze||(ze={}));var yo;(function(o){o.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",o.STOP="STOP",o.MAX_TOKENS="MAX_TOKENS",o.SAFETY="SAFETY",o.RECITATION="RECITATION",o.LANGUAGE="LANGUAGE",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT",o.SPII="SPII",o.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",o.IMAGE_SAFETY="IMAGE_SAFETY"})(yo||(yo={}));var vo;(function(o){o.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",o.NEGLIGIBLE="NEGLIGIBLE",o.LOW="LOW",o.MEDIUM="MEDIUM",o.HIGH="HIGH"})(vo||(vo={}));var To;(function(o){o.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",o.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",o.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",o.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",o.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(To||(To={}));var Co;(function(o){o.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",o.SAFETY="SAFETY",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(Co||(Co={}));var Eo;(function(o){o.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",o.ON_DEMAND="ON_DEMAND",o.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Eo||(Eo={}));var me;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.AUDIO="AUDIO"})(me||(me={}));var Io;(function(o){o.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",o.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",o.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",o.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Io||(Io={}));var on;(function(o){o.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",o.JOB_STATE_QUEUED="JOB_STATE_QUEUED",o.JOB_STATE_PENDING="JOB_STATE_PENDING",o.JOB_STATE_RUNNING="JOB_STATE_RUNNING",o.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",o.JOB_STATE_FAILED="JOB_STATE_FAILED",o.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",o.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",o.JOB_STATE_PAUSED="JOB_STATE_PAUSED",o.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",o.JOB_STATE_UPDATING="JOB_STATE_UPDATING",o.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(on||(on={}));var wo;(function(o){o.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",o.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",o.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",o.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",o.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",o.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",o.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(wo||(wo={}));var xo;(function(o){o.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",o.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",o.BALANCED="BALANCED",o.PRIORITIZE_COST="PRIORITIZE_COST"})(xo||(xo={}));var So;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(So||(So={}));var _o;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.AUTO="AUTO",o.ANY="ANY",o.NONE="NONE"})(_o||(_o={}));var ko;(function(o){o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE"})(ko||(ko={}));var Ao;(function(o){o.DONT_ALLOW="DONT_ALLOW",o.ALLOW_ADULT="ALLOW_ADULT",o.ALLOW_ALL="ALLOW_ALL"})(Ao||(Ao={}));var Mo;(function(o){o.auto="auto",o.en="en",o.ja="ja",o.ko="ko",o.hi="hi"})(Mo||(Mo={}));var Ro;(function(o){o.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",o.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",o.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",o.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",o.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Ro||(Ro={}));var Po;(function(o){o.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",o.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",o.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",o.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Po||(Po={}));var Lo;(function(o){o.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",o.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",o.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",o.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Lo||(Lo={}));var Do;(function(o){o.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",o.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",o.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",o.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",o.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",o.EDIT_MODE_STYLE="EDIT_MODE_STYLE",o.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",o.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Do||(Do={}));var No;(function(o){o.STATE_UNSPECIFIED="STATE_UNSPECIFIED",o.PROCESSING="PROCESSING",o.ACTIVE="ACTIVE",o.FAILED="FAILED"})(No||(No={}));var bo;(function(o){o.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",o.UPLOADED="UPLOADED",o.GENERATED="GENERATED"})(bo||(bo={}));var Bo;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.VIDEO="VIDEO",o.AUDIO="AUDIO",o.DOCUMENT="DOCUMENT"})(Bo||(Bo={}));var Vo;(function(o){o.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",o.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",o.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Vo||(Vo={}));var Uo;(function(o){o.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",o.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",o.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Uo||(Uo={}));var $o;(function(o){o.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",o.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",o.NO_INTERRUPTION="NO_INTERRUPTION"})($o||($o={}));var Fo;(function(o){o.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",o.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",o.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Fo||(Fo={}));class gt{get text(){var t,e,n,i,s,a,u,d;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",f=!1;const p=[];for(const m of(d=(u=(a=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[g,h]of Object.entries(m))g!=="text"&&g!=="thought"&&(h!==null||h!==void 0)&&p.push(g);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;f=!0,c+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?c:void 0}get data(){var t,e,n,i,s,a,u,d;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="";const f=[];for(const p of(d=(u=(a=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[m,g]of Object.entries(p))m!=="inlineData"&&(g!==null||g!==void 0)&&f.push(m);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var t,e,n,i,s,a,u,d;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const c=(d=(u=(a=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var t,e,n,i,s,a,u,d,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(d=(u=(a=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var t,e,n,i,s,a,u,d,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(d=(u=(a=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.output}}class qo{}class Go{}class Pr{}class Lr{}class Ho{}class Yo{}class Wo{}class Dr{}class zo{}class Jo{}class Ko{}class Nr{}class sn{constructor(t){const e={};for(const n of t.headers.entries())e[n[0]]=n[1];this.headers=e,this.responseInternal=t}json(){return this.responseInternal.json()}}class br{}class Br{}class Vr{get text(){var t,e,n;let i="",s=!1;const a=[];for(const u of(n=(e=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||e===void 0?void 0:e.parts)!==null&&n!==void 0?n:[]){for(const[d,c]of Object.entries(u))d!=="text"&&d!=="thought"&&c!==null&&a.push(d);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;s=!0,i+=u.text}}return a.length>0&&console.warn(`there are non-text parts ${a} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),s?i:void 0}get data(){var t,e,n;let i="";const s=[];for(const a of(n=(e=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||e===void 0?void 0:e.parts)!==null&&n!==void 0?n:[]){for(const[u,d]of Object.entries(a))u!=="inlineData"&&d!==null&&s.push(u);a.inlineData&&typeof a.inlineData.data=="string"&&(i+=atob(a.inlineData.data))}return s.length>0&&console.warn(`there are non-data parts ${s} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ur extends st{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new $t(We.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(e),e)}async create(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Cr(this.apiClient,t);return u=x("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>Et(this.apiClient,f))}else{const c=Xs(this.apiClient,t);return u=x("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>Ct(this.apiClient,f))}}async get(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Er(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>Et(this.apiClient,f))}else{const c=js(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>Ct(this.apiClient,f))}}async delete(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Ir(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(()=>{const f=Mr(),p=new Jo;return Object.assign(p,f),p})}else{const c=er(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(()=>{const f=kr(),p=new Jo;return Object.assign(p,f),p})}}async update(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=xr(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>Et(this.apiClient,f))}else{const c=nr(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>Ct(this.apiClient,f))}}async listInternal(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=_r(this.apiClient,t);return u=x("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Rr(this.apiClient,f),m=new Ko;return Object.assign(m,p),m})}else{const c=ir(this.apiClient,t);return u=x("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Ar(this.apiClient,f),m=new Ko;return Object.assign(m,p),m})}}}function Oo(o){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&o[t],n=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function G(o){return this instanceof G?(this.v=o,this):new G(o)}function St(o,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(o,t||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(g){return function(h){return Promise.resolve(h).then(g,p)}}function u(g,h){n[g]&&(i[g]=function(v){return new Promise(function(y,T){s.push([g,v,y,T])>1||d(g,v)})},h&&(i[g]=h(i[g])))}function d(g,h){try{c(n[g](h))}catch(v){m(s[0][3],v)}}function c(g){g.value instanceof G?Promise.resolve(g.value.v).then(f,p):m(s[0][2],g)}function f(g){d("next",g)}function p(g){d("throw",g)}function m(g,h){g(h),s.shift(),s.length&&d(s[0][0],s[0][1])}}function rn(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],e;return t?t.call(o):(o=typeof Oo=="function"?Oo(o):o[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(s){e[s]=o[s]&&function(a){return new Promise(function(u,d){a=o[s](a),i(u,d,a.done,a.value)})}}function i(s,a,u,d){Promise.resolve(d).then(function(c){s({value:c,done:u})},a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $r(o){var t;if(o.candidates==null||o.candidates.length===0)return!1;const e=(t=o.candidates[0])===null||t===void 0?void 0:t.content;return e===void 0?!1:Mi(e)}function Mi(o){if(o.parts===void 0||o.parts.length===0)return!1;for(const t of o.parts)if(t===void 0||Object.keys(t).length===0||t.text!==void 0&&t.text==="")return!1;return!0}function Fr(o){if(o.length!==0){if(o[0].role!=="user")throw new Error("History must start with a user turn.");for(const t of o)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function qr(o){if(o===void 0||o.length===0)return[];const t=[],e=o.length;let n=0,i=o[0];for(;n<e;)if(o[n].role==="user")i=o[n],n++;else{const s=[];let a=!0;for(;n<e&&o[n].role==="model";)s.push(o[n]),a&&!Mi(o[n])&&(a=!1),n++;a&&(t.push(i),t.push(...s))}return t}class Gr{constructor(t,e){this.modelsModule=t,this.apiClient=e}create(t){return new Hr(this.apiClient,this.modelsModule,t.model,t.config,t.history)}}class Hr{constructor(t,e,n,i={},s=[]){this.apiClient=t,this.modelsModule=e,this.model=n,this.config=i,this.history=s,this.sendPromise=Promise.resolve(),Fr(s)}async sendMessage(t){var e;await this.sendPromise;const n=J(this.apiClient,t.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});return this.sendPromise=(async()=>{var s,a;const d=(a=(s=(await i).candidates)===null||s===void 0?void 0:s[0])===null||a===void 0?void 0:a.content,c=d?[d]:[];this.recordHistory(n,c)})(),await this.sendPromise,i}async sendMessageStream(t){var e;await this.sendPromise;const n=J(this.apiClient,t.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const s=await i;return this.processStreamResponse(s,n)}getHistory(t=!1){return t?qr(this.history):this.history}processStreamResponse(t,e){var n,i;return St(this,arguments,function*(){var a,u,d,c;const f=[];try{for(var p=!0,m=rn(t),g;g=yield G(m.next()),a=g.done,!a;p=!0){c=g.value,p=!1;const h=c;if($r(h)){const v=(i=(n=h.candidates)===null||n===void 0?void 0:n[0])===null||i===void 0?void 0:i.content;v!==void 0&&f.push(v)}yield yield G(h)}}catch(h){u={error:h}}finally{try{!p&&!a&&(d=m.return)&&(yield G(d.call(m)))}finally{if(u)throw u.error}}this.recordHistory(e,f)})}recordHistory(t,e){let n=[];e.length>0&&e.every(i=>i.role==="model")?n=e:n.push({role:"model",parts:[]}),this.history.push(t),this.history.push(...n)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Yr(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const s=r(t,["pageToken"]);return e!==void 0&&s!=null&&l(e,["_query","pageToken"],s),n}function Wr(o,t){const e={},n=r(t,["config"]);return n!=null&&l(e,["config"],Yr(o,n,e)),e}function zr(o,t){const e={},n=r(t,["details"]);n!=null&&l(e,["details"],n);const i=r(t,["message"]);i!=null&&l(e,["message"],i);const s=r(t,["code"]);return s!=null&&l(e,["code"],s),e}function Jr(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["displayName"]);i!=null&&l(e,["displayName"],i);const s=r(t,["mimeType"]);s!=null&&l(e,["mimeType"],s);const a=r(t,["sizeBytes"]);a!=null&&l(e,["sizeBytes"],a);const u=r(t,["createTime"]);u!=null&&l(e,["createTime"],u);const d=r(t,["expirationTime"]);d!=null&&l(e,["expirationTime"],d);const c=r(t,["updateTime"]);c!=null&&l(e,["updateTime"],c);const f=r(t,["sha256Hash"]);f!=null&&l(e,["sha256Hash"],f);const p=r(t,["uri"]);p!=null&&l(e,["uri"],p);const m=r(t,["downloadUri"]);m!=null&&l(e,["downloadUri"],m);const g=r(t,["state"]);g!=null&&l(e,["state"],g);const h=r(t,["source"]);h!=null&&l(e,["source"],h);const v=r(t,["videoMetadata"]);v!=null&&l(e,["videoMetadata"],v);const y=r(t,["error"]);return y!=null&&l(e,["error"],zr(o,y)),e}function Kr(o,t){const e={},n=r(t,["file"]);n!=null&&l(e,["file"],Jr(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function Or(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["_url","file"],_i(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function Zr(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["_url","file"],_i(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function Qr(o,t){const e={},n=r(t,["details"]);n!=null&&l(e,["details"],n);const i=r(t,["message"]);i!=null&&l(e,["message"],i);const s=r(t,["code"]);return s!=null&&l(e,["code"],s),e}function ln(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["displayName"]);i!=null&&l(e,["displayName"],i);const s=r(t,["mimeType"]);s!=null&&l(e,["mimeType"],s);const a=r(t,["sizeBytes"]);a!=null&&l(e,["sizeBytes"],a);const u=r(t,["createTime"]);u!=null&&l(e,["createTime"],u);const d=r(t,["expirationTime"]);d!=null&&l(e,["expirationTime"],d);const c=r(t,["updateTime"]);c!=null&&l(e,["updateTime"],c);const f=r(t,["sha256Hash"]);f!=null&&l(e,["sha256Hash"],f);const p=r(t,["uri"]);p!=null&&l(e,["uri"],p);const m=r(t,["downloadUri"]);m!=null&&l(e,["downloadUri"],m);const g=r(t,["state"]);g!=null&&l(e,["state"],g);const h=r(t,["source"]);h!=null&&l(e,["source"],h);const v=r(t,["videoMetadata"]);v!=null&&l(e,["videoMetadata"],v);const y=r(t,["error"]);return y!=null&&l(e,["error"],Qr(o,y)),e}function Xr(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);const i=r(t,["files"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>ln(o,a))),l(e,["files"],s)}return e}function jr(){return{}}function el(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tl extends st{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new $t(We.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(e),e)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(e=>ln(this.apiClient,e))}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var e,n;let i,s="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Wr(this.apiClient,t);return s=x("files",u._url),a=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Xr(this.apiClient,d),f=new Nr;return Object.assign(f,c),f})}}async createInternal(t){var e,n;let i,s="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Kr(this.apiClient,t);return s=x("upload/v1beta/files",u._url),a=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(()=>{const d=jr(),c=new br;return Object.assign(c,d),c})}}async get(t){var e,n;let i,s="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Or(this.apiClient,t);return s=x("files/{file}",u._url),a=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>ln(this.apiClient,d))}}async delete(t){var e,n;let i,s="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Zr(this.apiClient,t);return s=x("files/{file}",u._url),a=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(()=>{const d=el(),c=new Br;return Object.assign(c,d),c})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function nl(o,t){const e={};if(r(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=r(t,["data"]);n!=null&&l(e,["data"],n);const i=r(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function ol(o,t){const e={},n=r(t,["displayName"]);n!=null&&l(e,["displayName"],n);const i=r(t,["data"]);i!=null&&l(e,["data"],i);const s=r(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function il(o,t){const e={};if(r(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=r(t,["thought"]);n!=null&&l(e,["thought"],n);const i=r(t,["inlineData"]);i!=null&&l(e,["inlineData"],nl(o,i));const s=r(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const a=r(t,["executableCode"]);a!=null&&l(e,["executableCode"],a);const u=r(t,["fileData"]);u!=null&&l(e,["fileData"],u);const d=r(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);const c=r(t,["functionResponse"]);c!=null&&l(e,["functionResponse"],c);const f=r(t,["text"]);return f!=null&&l(e,["text"],f),e}function sl(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&l(e,["thought"],i);const s=r(t,["inlineData"]);s!=null&&l(e,["inlineData"],ol(o,s));const a=r(t,["codeExecutionResult"]);a!=null&&l(e,["codeExecutionResult"],a);const u=r(t,["executableCode"]);u!=null&&l(e,["executableCode"],u);const d=r(t,["fileData"]);d!=null&&l(e,["fileData"],d);const c=r(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);const f=r(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&l(e,["text"],p),e}function rl(o,t){const e={},n=r(t,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>il(o,a))),l(e,["parts"],s)}const i=r(t,["role"]);return i!=null&&l(e,["role"],i),e}function ll(o,t){const e={},n=r(t,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>sl(o,a))),l(e,["parts"],s)}const i=r(t,["role"]);return i!=null&&l(e,["role"],i),e}function al(){return{}}function ul(){return{}}function cl(o,t){const e={},n=r(t,["mode"]);n!=null&&l(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function dl(o,t){const e={},n=r(t,["mode"]);n!=null&&l(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function fl(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],cl(o,n)),e}function pl(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],dl(o,n)),e}function ml(){return{}}function gl(o,t){const e={},n=r(t,["apiKeyString"]);return n!=null&&l(e,["apiKeyString"],n),e}function hl(o,t){const e={},n=r(t,["apiKeyConfig"]);n!=null&&l(e,["apiKeyConfig"],gl(o,n));const i=r(t,["authType"]);i!=null&&l(e,["authType"],i);const s=r(t,["googleServiceAccountConfig"]);s!=null&&l(e,["googleServiceAccountConfig"],s);const a=r(t,["httpBasicAuthConfig"]);a!=null&&l(e,["httpBasicAuthConfig"],a);const u=r(t,["oauthConfig"]);u!=null&&l(e,["oauthConfig"],u);const d=r(t,["oidcConfig"]);return d!=null&&l(e,["oidcConfig"],d),e}function yl(o,t){const e={},n=r(t,["authConfig"]);return n!=null&&l(e,["authConfig"],hl(o,n)),e}function vl(o,t){const e={};if(r(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(t,["googleSearch"])!=null&&l(e,["googleSearch"],al());const i=r(t,["googleSearchRetrieval"]);if(i!=null&&l(e,["googleSearchRetrieval"],fl(o,i)),r(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");const s=r(t,["codeExecution"]);s!=null&&l(e,["codeExecution"],s);const a=r(t,["functionDeclarations"]);return a!=null&&l(e,["functionDeclarations"],a),e}function Tl(o,t){const e={},n=r(t,["retrieval"]);n!=null&&l(e,["retrieval"],n),r(t,["googleSearch"])!=null&&l(e,["googleSearch"],ul());const s=r(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],pl(o,s)),r(t,["enterpriseWebSearch"])!=null&&l(e,["enterpriseWebSearch"],ml());const u=r(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],yl(o,u));const d=r(t,["codeExecution"]);d!=null&&l(e,["codeExecution"],d);const c=r(t,["functionDeclarations"]);return c!=null&&l(e,["functionDeclarations"],c),e}function Cl(o,t){const e={},n=r(t,["handle"]);if(n!=null&&l(e,["handle"],n),r(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function El(o,t){const e={},n=r(t,["handle"]);n!=null&&l(e,["handle"],n);const i=r(t,["transparent"]);return i!=null&&l(e,["transparent"],i),e}function Zo(){return{}}function Qo(){return{}}function Il(o,t){const e={},n=r(t,["disabled"]);n!=null&&l(e,["disabled"],n);const i=r(t,["startOfSpeechSensitivity"]);i!=null&&l(e,["startOfSpeechSensitivity"],i);const s=r(t,["endOfSpeechSensitivity"]);s!=null&&l(e,["endOfSpeechSensitivity"],s);const a=r(t,["prefixPaddingMs"]);a!=null&&l(e,["prefixPaddingMs"],a);const u=r(t,["silenceDurationMs"]);return u!=null&&l(e,["silenceDurationMs"],u),e}function wl(o,t){const e={},n=r(t,["disabled"]);n!=null&&l(e,["disabled"],n);const i=r(t,["startOfSpeechSensitivity"]);i!=null&&l(e,["startOfSpeechSensitivity"],i);const s=r(t,["endOfSpeechSensitivity"]);s!=null&&l(e,["endOfSpeechSensitivity"],s);const a=r(t,["prefixPaddingMs"]);a!=null&&l(e,["prefixPaddingMs"],a);const u=r(t,["silenceDurationMs"]);return u!=null&&l(e,["silenceDurationMs"],u),e}function xl(o,t){const e={},n=r(t,["automaticActivityDetection"]);n!=null&&l(e,["automaticActivityDetection"],Il(o,n));const i=r(t,["activityHandling"]);i!=null&&l(e,["activityHandling"],i);const s=r(t,["turnCoverage"]);return s!=null&&l(e,["turnCoverage"],s),e}function Sl(o,t){const e={},n=r(t,["automaticActivityDetection"]);n!=null&&l(e,["automaticActivityDetection"],wl(o,n));const i=r(t,["activityHandling"]);i!=null&&l(e,["activityHandling"],i);const s=r(t,["turnCoverage"]);return s!=null&&l(e,["turnCoverage"],s),e}function _l(o,t){const e={},n=r(t,["targetTokens"]);return n!=null&&l(e,["targetTokens"],n),e}function kl(o,t){const e={},n=r(t,["targetTokens"]);return n!=null&&l(e,["targetTokens"],n),e}function Al(o,t){const e={},n=r(t,["triggerTokens"]);n!=null&&l(e,["triggerTokens"],n);const i=r(t,["slidingWindow"]);return i!=null&&l(e,["slidingWindow"],_l(o,i)),e}function Ml(o,t){const e={},n=r(t,["triggerTokens"]);n!=null&&l(e,["triggerTokens"],n);const i=r(t,["slidingWindow"]);return i!=null&&l(e,["slidingWindow"],kl(o,i)),e}function Rl(o,t,e){const n={},i=r(t,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);const s=r(t,["responseModalities"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","responseModalities"],s);const a=r(t,["temperature"]);e!==void 0&&a!=null&&l(e,["setup","generationConfig","temperature"],a);const u=r(t,["topP"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topP"],u);const d=r(t,["topK"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","topK"],d);const c=r(t,["maxOutputTokens"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","maxOutputTokens"],c);const f=r(t,["mediaResolution"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","mediaResolution"],f);const p=r(t,["seed"]);e!==void 0&&p!=null&&l(e,["setup","generationConfig","seed"],p);const m=r(t,["speechConfig"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","speechConfig"],m);const g=r(t,["systemInstruction"]);e!==void 0&&g!=null&&l(e,["setup","systemInstruction"],rl(o,J(o,g)));const h=r(t,["tools"]);if(e!==void 0&&h!=null){let w=Ut(o,h);Array.isArray(w)&&(w=w.map(M=>vl(o,Vt(o,M)))),l(e,["setup","tools"],w)}const v=r(t,["sessionResumption"]);e!==void 0&&v!=null&&l(e,["setup","sessionResumption"],Cl(o,v));const y=r(t,["inputAudioTranscription"]);e!==void 0&&y!=null&&l(e,["setup","inputAudioTranscription"],Zo());const T=r(t,["outputAudioTranscription"]);e!==void 0&&T!=null&&l(e,["setup","outputAudioTranscription"],Zo());const C=r(t,["realtimeInputConfig"]);e!==void 0&&C!=null&&l(e,["setup","realtimeInputConfig"],xl(o,C));const A=r(t,["contextWindowCompression"]);return e!==void 0&&A!=null&&l(e,["setup","contextWindowCompression"],Al(o,A)),n}function Pl(o,t,e){const n={},i=r(t,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);const s=r(t,["responseModalities"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","responseModalities"],s);const a=r(t,["temperature"]);e!==void 0&&a!=null&&l(e,["setup","generationConfig","temperature"],a);const u=r(t,["topP"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topP"],u);const d=r(t,["topK"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","topK"],d);const c=r(t,["maxOutputTokens"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","maxOutputTokens"],c);const f=r(t,["mediaResolution"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","mediaResolution"],f);const p=r(t,["seed"]);e!==void 0&&p!=null&&l(e,["setup","generationConfig","seed"],p);const m=r(t,["speechConfig"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","speechConfig"],m);const g=r(t,["systemInstruction"]);e!==void 0&&g!=null&&l(e,["setup","systemInstruction"],ll(o,J(o,g)));const h=r(t,["tools"]);if(e!==void 0&&h!=null){let w=Ut(o,h);Array.isArray(w)&&(w=w.map(M=>Tl(o,Vt(o,M)))),l(e,["setup","tools"],w)}const v=r(t,["sessionResumption"]);e!==void 0&&v!=null&&l(e,["setup","sessionResumption"],El(o,v));const y=r(t,["inputAudioTranscription"]);e!==void 0&&y!=null&&l(e,["setup","inputAudioTranscription"],Qo());const T=r(t,["outputAudioTranscription"]);e!==void 0&&T!=null&&l(e,["setup","outputAudioTranscription"],Qo());const C=r(t,["realtimeInputConfig"]);e!==void 0&&C!=null&&l(e,["setup","realtimeInputConfig"],Sl(o,C));const A=r(t,["contextWindowCompression"]);return e!==void 0&&A!=null&&l(e,["setup","contextWindowCompression"],Ml(o,A)),n}function Ll(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["setup","model"],b(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],Rl(o,i,e)),e}function Dl(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["setup","model"],b(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],Pl(o,i,e)),e}function Nl(){return{}}function bl(){return{}}function Bl(){return{}}function Vl(){return{}}function Ul(o,t){const e={},n=r(t,["media"]);n!=null&&l(e,["mediaChunks"],Ci(o,n));const i=r(t,["audio"]);i!=null&&l(e,["audio"],Vs(o,i));const s=r(t,["audioStreamEnd"]);s!=null&&l(e,["audioStreamEnd"],s);const a=r(t,["video"]);a!=null&&l(e,["video"],Bs(o,a));const u=r(t,["text"]);return u!=null&&l(e,["text"],u),r(t,["activityStart"])!=null&&l(e,["activityStart"],Nl()),r(t,["activityEnd"])!=null&&l(e,["activityEnd"],Bl()),e}function $l(o,t){const e={},n=r(t,["media"]);if(n!=null&&l(e,["mediaChunks"],Ci(o,n)),r(t,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const i=r(t,["audioStreamEnd"]);if(i!=null&&l(e,["audioStreamEnd"],i),r(t,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(r(t,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return r(t,["activityStart"])!=null&&l(e,["activityStart"],bl()),r(t,["activityEnd"])!=null&&l(e,["activityEnd"],Vl()),e}function Fl(){return{}}function ql(){return{}}function Gl(o,t){const e={},n=r(t,["data"]);n!=null&&l(e,["data"],n);const i=r(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Hl(o,t){const e={},n=r(t,["displayName"]);n!=null&&l(e,["displayName"],n);const i=r(t,["data"]);i!=null&&l(e,["data"],i);const s=r(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Yl(o,t){const e={},n=r(t,["thought"]);n!=null&&l(e,["thought"],n);const i=r(t,["inlineData"]);i!=null&&l(e,["inlineData"],Gl(o,i));const s=r(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const a=r(t,["executableCode"]);a!=null&&l(e,["executableCode"],a);const u=r(t,["fileData"]);u!=null&&l(e,["fileData"],u);const d=r(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);const c=r(t,["functionResponse"]);c!=null&&l(e,["functionResponse"],c);const f=r(t,["text"]);return f!=null&&l(e,["text"],f),e}function Wl(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&l(e,["thought"],i);const s=r(t,["inlineData"]);s!=null&&l(e,["inlineData"],Hl(o,s));const a=r(t,["codeExecutionResult"]);a!=null&&l(e,["codeExecutionResult"],a);const u=r(t,["executableCode"]);u!=null&&l(e,["executableCode"],u);const d=r(t,["fileData"]);d!=null&&l(e,["fileData"],d);const c=r(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);const f=r(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&l(e,["text"],p),e}function zl(o,t){const e={},n=r(t,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>Yl(o,a))),l(e,["parts"],s)}const i=r(t,["role"]);return i!=null&&l(e,["role"],i),e}function Jl(o,t){const e={},n=r(t,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>Wl(o,a))),l(e,["parts"],s)}const i=r(t,["role"]);return i!=null&&l(e,["role"],i),e}function Xo(o,t){const e={},n=r(t,["text"]);n!=null&&l(e,["text"],n);const i=r(t,["finished"]);return i!=null&&l(e,["finished"],i),e}function jo(o,t){const e={},n=r(t,["text"]);n!=null&&l(e,["text"],n);const i=r(t,["finished"]);return i!=null&&l(e,["finished"],i),e}function Kl(o,t){const e={},n=r(t,["modelTurn"]);n!=null&&l(e,["modelTurn"],zl(o,n));const i=r(t,["turnComplete"]);i!=null&&l(e,["turnComplete"],i);const s=r(t,["interrupted"]);s!=null&&l(e,["interrupted"],s);const a=r(t,["groundingMetadata"]);a!=null&&l(e,["groundingMetadata"],a);const u=r(t,["generationComplete"]);u!=null&&l(e,["generationComplete"],u);const d=r(t,["inputTranscription"]);d!=null&&l(e,["inputTranscription"],Xo(o,d));const c=r(t,["outputTranscription"]);return c!=null&&l(e,["outputTranscription"],Xo(o,c)),e}function Ol(o,t){const e={},n=r(t,["modelTurn"]);n!=null&&l(e,["modelTurn"],Jl(o,n));const i=r(t,["turnComplete"]);i!=null&&l(e,["turnComplete"],i);const s=r(t,["interrupted"]);s!=null&&l(e,["interrupted"],s);const a=r(t,["groundingMetadata"]);a!=null&&l(e,["groundingMetadata"],a);const u=r(t,["generationComplete"]);u!=null&&l(e,["generationComplete"],u);const d=r(t,["inputTranscription"]);d!=null&&l(e,["inputTranscription"],jo(o,d));const c=r(t,["outputTranscription"]);return c!=null&&l(e,["outputTranscription"],jo(o,c)),e}function Zl(o,t){const e={},n=r(t,["id"]);n!=null&&l(e,["id"],n);const i=r(t,["args"]);i!=null&&l(e,["args"],i);const s=r(t,["name"]);return s!=null&&l(e,["name"],s),e}function Ql(o,t){const e={},n=r(t,["args"]);n!=null&&l(e,["args"],n);const i=r(t,["name"]);return i!=null&&l(e,["name"],i),e}function Xl(o,t){const e={},n=r(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Zl(o,s))),l(e,["functionCalls"],i)}return e}function jl(o,t){const e={},n=r(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Ql(o,s))),l(e,["functionCalls"],i)}return e}function ea(o,t){const e={},n=r(t,["ids"]);return n!=null&&l(e,["ids"],n),e}function ta(o,t){const e={},n=r(t,["ids"]);return n!=null&&l(e,["ids"],n),e}function ht(o,t){const e={},n=r(t,["modality"]);n!=null&&l(e,["modality"],n);const i=r(t,["tokenCount"]);return i!=null&&l(e,["tokenCount"],i),e}function yt(o,t){const e={},n=r(t,["modality"]);n!=null&&l(e,["modality"],n);const i=r(t,["tokenCount"]);return i!=null&&l(e,["tokenCount"],i),e}function na(o,t){const e={},n=r(t,["promptTokenCount"]);n!=null&&l(e,["promptTokenCount"],n);const i=r(t,["cachedContentTokenCount"]);i!=null&&l(e,["cachedContentTokenCount"],i);const s=r(t,["responseTokenCount"]);s!=null&&l(e,["responseTokenCount"],s);const a=r(t,["toolUsePromptTokenCount"]);a!=null&&l(e,["toolUsePromptTokenCount"],a);const u=r(t,["thoughtsTokenCount"]);u!=null&&l(e,["thoughtsTokenCount"],u);const d=r(t,["totalTokenCount"]);d!=null&&l(e,["totalTokenCount"],d);const c=r(t,["promptTokensDetails"]);if(c!=null){let g=c;Array.isArray(g)&&(g=g.map(h=>ht(o,h))),l(e,["promptTokensDetails"],g)}const f=r(t,["cacheTokensDetails"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(h=>ht(o,h))),l(e,["cacheTokensDetails"],g)}const p=r(t,["responseTokensDetails"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(h=>ht(o,h))),l(e,["responseTokensDetails"],g)}const m=r(t,["toolUsePromptTokensDetails"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(h=>ht(o,h))),l(e,["toolUsePromptTokensDetails"],g)}return e}function oa(o,t){const e={},n=r(t,["promptTokenCount"]);n!=null&&l(e,["promptTokenCount"],n);const i=r(t,["cachedContentTokenCount"]);i!=null&&l(e,["cachedContentTokenCount"],i);const s=r(t,["candidatesTokenCount"]);s!=null&&l(e,["responseTokenCount"],s);const a=r(t,["toolUsePromptTokenCount"]);a!=null&&l(e,["toolUsePromptTokenCount"],a);const u=r(t,["thoughtsTokenCount"]);u!=null&&l(e,["thoughtsTokenCount"],u);const d=r(t,["totalTokenCount"]);d!=null&&l(e,["totalTokenCount"],d);const c=r(t,["promptTokensDetails"]);if(c!=null){let h=c;Array.isArray(h)&&(h=h.map(v=>yt(o,v))),l(e,["promptTokensDetails"],h)}const f=r(t,["cacheTokensDetails"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(v=>yt(o,v))),l(e,["cacheTokensDetails"],h)}const p=r(t,["candidatesTokensDetails"]);if(p!=null){let h=p;Array.isArray(h)&&(h=h.map(v=>yt(o,v))),l(e,["responseTokensDetails"],h)}const m=r(t,["toolUsePromptTokensDetails"]);if(m!=null){let h=m;Array.isArray(h)&&(h=h.map(v=>yt(o,v))),l(e,["toolUsePromptTokensDetails"],h)}const g=r(t,["trafficType"]);return g!=null&&l(e,["trafficType"],g),e}function ia(o,t){const e={},n=r(t,["timeLeft"]);return n!=null&&l(e,["timeLeft"],n),e}function sa(o,t){const e={},n=r(t,["timeLeft"]);return n!=null&&l(e,["timeLeft"],n),e}function ra(o,t){const e={},n=r(t,["newHandle"]);n!=null&&l(e,["newHandle"],n);const i=r(t,["resumable"]);i!=null&&l(e,["resumable"],i);const s=r(t,["lastConsumedClientMessageIndex"]);return s!=null&&l(e,["lastConsumedClientMessageIndex"],s),e}function la(o,t){const e={},n=r(t,["newHandle"]);n!=null&&l(e,["newHandle"],n);const i=r(t,["resumable"]);i!=null&&l(e,["resumable"],i);const s=r(t,["lastConsumedClientMessageIndex"]);return s!=null&&l(e,["lastConsumedClientMessageIndex"],s),e}function aa(o,t){const e={};r(t,["setupComplete"])!=null&&l(e,["setupComplete"],Fl());const i=r(t,["serverContent"]);i!=null&&l(e,["serverContent"],Kl(o,i));const s=r(t,["toolCall"]);s!=null&&l(e,["toolCall"],Xl(o,s));const a=r(t,["toolCallCancellation"]);a!=null&&l(e,["toolCallCancellation"],ea(o,a));const u=r(t,["usageMetadata"]);u!=null&&l(e,["usageMetadata"],na(o,u));const d=r(t,["goAway"]);d!=null&&l(e,["goAway"],ia(o,d));const c=r(t,["sessionResumptionUpdate"]);return c!=null&&l(e,["sessionResumptionUpdate"],ra(o,c)),e}function ua(o,t){const e={};r(t,["setupComplete"])!=null&&l(e,["setupComplete"],ql());const i=r(t,["serverContent"]);i!=null&&l(e,["serverContent"],Ol(o,i));const s=r(t,["toolCall"]);s!=null&&l(e,["toolCall"],jl(o,s));const a=r(t,["toolCallCancellation"]);a!=null&&l(e,["toolCallCancellation"],ta(o,a));const u=r(t,["usageMetadata"]);u!=null&&l(e,["usageMetadata"],oa(o,u));const d=r(t,["goAway"]);d!=null&&l(e,["goAway"],sa(o,d));const c=r(t,["sessionResumptionUpdate"]);return c!=null&&l(e,["sessionResumptionUpdate"],la(o,c)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ca(o,t){const e={};if(r(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=r(t,["data"]);n!=null&&l(e,["data"],n);const i=r(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function da(o,t){const e={};if(r(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=r(t,["thought"]);n!=null&&l(e,["thought"],n);const i=r(t,["inlineData"]);i!=null&&l(e,["inlineData"],ca(o,i));const s=r(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const a=r(t,["executableCode"]);a!=null&&l(e,["executableCode"],a);const u=r(t,["fileData"]);u!=null&&l(e,["fileData"],u);const d=r(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);const c=r(t,["functionResponse"]);c!=null&&l(e,["functionResponse"],c);const f=r(t,["text"]);return f!=null&&l(e,["text"],f),e}function Ft(o,t){const e={},n=r(t,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>da(o,a))),l(e,["parts"],s)}const i=r(t,["role"]);return i!=null&&l(e,["role"],i),e}function fa(o,t){const e={};if(r(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=r(t,["category"]);n!=null&&l(e,["category"],n);const i=r(t,["threshold"]);return i!=null&&l(e,["threshold"],i),e}function pa(){return{}}function ma(o,t){const e={},n=r(t,["mode"]);n!=null&&l(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function ga(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],ma(o,n)),e}function ha(o,t){const e={};if(r(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(t,["googleSearch"])!=null&&l(e,["googleSearch"],pa());const i=r(t,["googleSearchRetrieval"]);if(i!=null&&l(e,["googleSearchRetrieval"],ga(o,i)),r(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");const s=r(t,["codeExecution"]);s!=null&&l(e,["codeExecution"],s);const a=r(t,["functionDeclarations"]);return a!=null&&l(e,["functionDeclarations"],a),e}function ya(o,t){const e={},n=r(t,["mode"]);n!=null&&l(e,["mode"],n);const i=r(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function va(o,t){const e={},n=r(t,["functionCallingConfig"]);if(n!=null&&l(e,["functionCallingConfig"],ya(o,n)),r(t,["retrievalConfig"])!==void 0)throw new Error("retrievalConfig parameter is not supported in Gemini API.");return e}function Ta(o,t){const e={},n=r(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function Ca(o,t){const e={},n=r(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],Ta(o,n)),e}function Ea(o,t){const e={},n=r(t,["voiceConfig"]);n!=null&&l(e,["voiceConfig"],Ca(o,n));const i=r(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function Ia(o,t){const e={},n=r(t,["includeThoughts"]);n!=null&&l(e,["includeThoughts"],n);const i=r(t,["thinkingBudget"]);return i!=null&&l(e,["thinkingBudget"],i),e}function wa(o,t,e){const n={},i=r(t,["systemInstruction"]);e!==void 0&&i!=null&&l(e,["systemInstruction"],Ft(o,J(o,i)));const s=r(t,["temperature"]);s!=null&&l(n,["temperature"],s);const a=r(t,["topP"]);a!=null&&l(n,["topP"],a);const u=r(t,["topK"]);u!=null&&l(n,["topK"],u);const d=r(t,["candidateCount"]);d!=null&&l(n,["candidateCount"],d);const c=r(t,["maxOutputTokens"]);c!=null&&l(n,["maxOutputTokens"],c);const f=r(t,["stopSequences"]);f!=null&&l(n,["stopSequences"],f);const p=r(t,["responseLogprobs"]);p!=null&&l(n,["responseLogprobs"],p);const m=r(t,["logprobs"]);m!=null&&l(n,["logprobs"],m);const g=r(t,["presencePenalty"]);g!=null&&l(n,["presencePenalty"],g);const h=r(t,["frequencyPenalty"]);h!=null&&l(n,["frequencyPenalty"],h);const v=r(t,["seed"]);v!=null&&l(n,["seed"],v);const y=r(t,["responseMimeType"]);y!=null&&l(n,["responseMimeType"],y);const T=r(t,["responseSchema"]);if(T!=null&&l(n,["responseSchema"],wi(o,T)),r(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(r(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const C=r(t,["safetySettings"]);if(e!==void 0&&C!=null){let S=C;Array.isArray(S)&&(S=S.map(L=>fa(o,L))),l(e,["safetySettings"],S)}const A=r(t,["tools"]);if(e!==void 0&&A!=null){let S=Ut(o,A);Array.isArray(S)&&(S=S.map(L=>ha(o,Vt(o,L)))),l(e,["tools"],S)}const w=r(t,["toolConfig"]);if(e!==void 0&&w!=null&&l(e,["toolConfig"],va(o,w)),r(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const M=r(t,["cachedContent"]);e!==void 0&&M!=null&&l(e,["cachedContent"],_e(o,M));const ie=r(t,["responseModalities"]);ie!=null&&l(n,["responseModalities"],ie);const K=r(t,["mediaResolution"]);K!=null&&l(n,["mediaResolution"],K);const H=r(t,["speechConfig"]);if(H!=null&&l(n,["speechConfig"],Ea(o,xi(o,H))),r(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const Y=r(t,["thinkingConfig"]);return Y!=null&&l(n,["thinkingConfig"],Ia(o,Y)),n}function ei(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["contents"]);if(i!=null){let a=Se(o,i);Array.isArray(a)&&(a=a.map(u=>Ft(o,u))),l(e,["contents"],a)}const s=r(t,["config"]);return s!=null&&l(e,["generationConfig"],wa(o,s,e)),e}function xa(o,t,e){const n={},i=r(t,["taskType"]);e!==void 0&&i!=null&&l(e,["requests[]","taskType"],i);const s=r(t,["title"]);e!==void 0&&s!=null&&l(e,["requests[]","title"],s);const a=r(t,["outputDimensionality"]);if(e!==void 0&&a!=null&&l(e,["requests[]","outputDimensionality"],a),r(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(r(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function Sa(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["contents"]);i!=null&&l(e,["requests[]","content"],Ii(o,i));const s=r(t,["config"]);s!=null&&l(e,["config"],xa(o,s,e));const a=r(t,["model"]);return a!==void 0&&l(e,["requests[]","model"],b(o,a)),e}function _a(o,t,e){const n={};if(r(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=r(t,["numberOfImages"]);e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i);const s=r(t,["aspectRatio"]);e!==void 0&&s!=null&&l(e,["parameters","aspectRatio"],s);const a=r(t,["guidanceScale"]);if(e!==void 0&&a!=null&&l(e,["parameters","guidanceScale"],a),r(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=r(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&l(e,["parameters","safetySetting"],u);const d=r(t,["personGeneration"]);e!==void 0&&d!=null&&l(e,["parameters","personGeneration"],d);const c=r(t,["includeSafetyAttributes"]);e!==void 0&&c!=null&&l(e,["parameters","includeSafetyAttributes"],c);const f=r(t,["includeRaiReason"]);e!==void 0&&f!=null&&l(e,["parameters","includeRaiReason"],f);const p=r(t,["language"]);e!==void 0&&p!=null&&l(e,["parameters","language"],p);const m=r(t,["outputMimeType"]);e!==void 0&&m!=null&&l(e,["parameters","outputOptions","mimeType"],m);const g=r(t,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&l(e,["parameters","outputOptions","compressionQuality"],g),r(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(r(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function ka(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["prompt"]);i!=null&&l(e,["instances[0]","prompt"],i);const s=r(t,["config"]);return s!=null&&l(e,["config"],_a(o,s,e)),e}function Aa(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","name"],b(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function Ma(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const s=r(t,["pageToken"]);e!==void 0&&s!=null&&l(e,["_query","pageToken"],s);const a=r(t,["filter"]);e!==void 0&&a!=null&&l(e,["_query","filter"],a);const u=r(t,["queryBase"]);return e!==void 0&&u!=null&&l(e,["_url","models_url"],ki(o,u)),n}function Ra(o,t){const e={},n=r(t,["config"]);return n!=null&&l(e,["config"],Ma(o,n,e)),e}function Pa(o,t,e){const n={},i=r(t,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);const s=r(t,["description"]);e!==void 0&&s!=null&&l(e,["description"],s);const a=r(t,["defaultCheckpointId"]);return e!==void 0&&a!=null&&l(e,["defaultCheckpointId"],a),n}function La(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","name"],b(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],Pa(o,i,e)),e}function Da(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","name"],b(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function Na(o,t){const e={};if(r(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(r(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(r(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function ba(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["contents"]);if(i!=null){let a=Se(o,i);Array.isArray(a)&&(a=a.map(u=>Ft(o,u))),l(e,["contents"],a)}const s=r(t,["config"]);return s!=null&&l(e,["config"],Na(o,s)),e}function Ba(o,t){const e={};if(r(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=r(t,["imageBytes"]);n!=null&&l(e,["bytesBase64Encoded"],ke(o,n));const i=r(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Va(o,t,e){const n={},i=r(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i),r(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const s=r(t,["durationSeconds"]);if(e!==void 0&&s!=null&&l(e,["parameters","durationSeconds"],s),r(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=r(t,["aspectRatio"]);if(e!==void 0&&a!=null&&l(e,["parameters","aspectRatio"],a),r(t,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const u=r(t,["personGeneration"]);if(e!==void 0&&u!=null&&l(e,["parameters","personGeneration"],u),r(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const d=r(t,["negativePrompt"]);if(e!==void 0&&d!=null&&l(e,["parameters","negativePrompt"],d),r(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function Ua(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["prompt"]);i!=null&&l(e,["instances[0]","prompt"],i);const s=r(t,["image"]);s!=null&&l(e,["instances[0]","image"],Ba(o,s));const a=r(t,["config"]);return a!=null&&l(e,["config"],Va(o,a,e)),e}function $a(o,t){const e={},n=r(t,["displayName"]);n!=null&&l(e,["displayName"],n);const i=r(t,["data"]);i!=null&&l(e,["data"],i);const s=r(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Fa(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&l(e,["thought"],i);const s=r(t,["inlineData"]);s!=null&&l(e,["inlineData"],$a(o,s));const a=r(t,["codeExecutionResult"]);a!=null&&l(e,["codeExecutionResult"],a);const u=r(t,["executableCode"]);u!=null&&l(e,["executableCode"],u);const d=r(t,["fileData"]);d!=null&&l(e,["fileData"],d);const c=r(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);const f=r(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&l(e,["text"],p),e}function Qe(o,t){const e={},n=r(t,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>Fa(o,a))),l(e,["parts"],s)}const i=r(t,["role"]);return i!=null&&l(e,["role"],i),e}function qa(o,t){const e={},n=r(t,["featureSelectionPreference"]);return n!=null&&l(e,["featureSelectionPreference"],n),e}function Ga(o,t){const e={},n=r(t,["method"]);n!=null&&l(e,["method"],n);const i=r(t,["category"]);i!=null&&l(e,["category"],i);const s=r(t,["threshold"]);return s!=null&&l(e,["threshold"],s),e}function Ha(){return{}}function Ya(o,t){const e={},n=r(t,["mode"]);n!=null&&l(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function Wa(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],Ya(o,n)),e}function za(){return{}}function Ja(o,t){const e={},n=r(t,["apiKeyString"]);return n!=null&&l(e,["apiKeyString"],n),e}function Ka(o,t){const e={},n=r(t,["apiKeyConfig"]);n!=null&&l(e,["apiKeyConfig"],Ja(o,n));const i=r(t,["authType"]);i!=null&&l(e,["authType"],i);const s=r(t,["googleServiceAccountConfig"]);s!=null&&l(e,["googleServiceAccountConfig"],s);const a=r(t,["httpBasicAuthConfig"]);a!=null&&l(e,["httpBasicAuthConfig"],a);const u=r(t,["oauthConfig"]);u!=null&&l(e,["oauthConfig"],u);const d=r(t,["oidcConfig"]);return d!=null&&l(e,["oidcConfig"],d),e}function Oa(o,t){const e={},n=r(t,["authConfig"]);return n!=null&&l(e,["authConfig"],Ka(o,n)),e}function Ri(o,t){const e={},n=r(t,["retrieval"]);n!=null&&l(e,["retrieval"],n),r(t,["googleSearch"])!=null&&l(e,["googleSearch"],Ha());const s=r(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],Wa(o,s)),r(t,["enterpriseWebSearch"])!=null&&l(e,["enterpriseWebSearch"],za());const u=r(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],Oa(o,u));const d=r(t,["codeExecution"]);d!=null&&l(e,["codeExecution"],d);const c=r(t,["functionDeclarations"]);return c!=null&&l(e,["functionDeclarations"],c),e}function Za(o,t){const e={},n=r(t,["mode"]);n!=null&&l(e,["mode"],n);const i=r(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function Qa(o,t){const e={},n=r(t,["latitude"]);n!=null&&l(e,["latitude"],n);const i=r(t,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function Xa(o,t){const e={},n=r(t,["latLng"]);return n!=null&&l(e,["latLng"],Qa(o,n)),e}function ja(o,t){const e={},n=r(t,["functionCallingConfig"]);n!=null&&l(e,["functionCallingConfig"],Za(o,n));const i=r(t,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],Xa(o,i)),e}function eu(o,t){const e={},n=r(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function tu(o,t){const e={},n=r(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],eu(o,n)),e}function nu(o,t){const e={},n=r(t,["voiceConfig"]);n!=null&&l(e,["voiceConfig"],tu(o,n));const i=r(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function ou(o,t){const e={},n=r(t,["includeThoughts"]);n!=null&&l(e,["includeThoughts"],n);const i=r(t,["thinkingBudget"]);return i!=null&&l(e,["thinkingBudget"],i),e}function iu(o,t,e){const n={},i=r(t,["systemInstruction"]);e!==void 0&&i!=null&&l(e,["systemInstruction"],Qe(o,J(o,i)));const s=r(t,["temperature"]);s!=null&&l(n,["temperature"],s);const a=r(t,["topP"]);a!=null&&l(n,["topP"],a);const u=r(t,["topK"]);u!=null&&l(n,["topK"],u);const d=r(t,["candidateCount"]);d!=null&&l(n,["candidateCount"],d);const c=r(t,["maxOutputTokens"]);c!=null&&l(n,["maxOutputTokens"],c);const f=r(t,["stopSequences"]);f!=null&&l(n,["stopSequences"],f);const p=r(t,["responseLogprobs"]);p!=null&&l(n,["responseLogprobs"],p);const m=r(t,["logprobs"]);m!=null&&l(n,["logprobs"],m);const g=r(t,["presencePenalty"]);g!=null&&l(n,["presencePenalty"],g);const h=r(t,["frequencyPenalty"]);h!=null&&l(n,["frequencyPenalty"],h);const v=r(t,["seed"]);v!=null&&l(n,["seed"],v);const y=r(t,["responseMimeType"]);y!=null&&l(n,["responseMimeType"],y);const T=r(t,["responseSchema"]);T!=null&&l(n,["responseSchema"],wi(o,T));const C=r(t,["routingConfig"]);C!=null&&l(n,["routingConfig"],C);const A=r(t,["modelSelectionConfig"]);A!=null&&l(n,["modelConfig"],qa(o,A));const w=r(t,["safetySettings"]);if(e!==void 0&&w!=null){let se=w;Array.isArray(se)&&(se=se.map(Xt=>Ga(o,Xt))),l(e,["safetySettings"],se)}const M=r(t,["tools"]);if(e!==void 0&&M!=null){let se=Ut(o,M);Array.isArray(se)&&(se=se.map(Xt=>Ri(o,Vt(o,Xt)))),l(e,["tools"],se)}const ie=r(t,["toolConfig"]);e!==void 0&&ie!=null&&l(e,["toolConfig"],ja(o,ie));const K=r(t,["labels"]);e!==void 0&&K!=null&&l(e,["labels"],K);const H=r(t,["cachedContent"]);e!==void 0&&H!=null&&l(e,["cachedContent"],_e(o,H));const Y=r(t,["responseModalities"]);Y!=null&&l(n,["responseModalities"],Y);const S=r(t,["mediaResolution"]);S!=null&&l(n,["mediaResolution"],S);const L=r(t,["speechConfig"]);L!=null&&l(n,["speechConfig"],nu(o,xi(o,L)));const D=r(t,["audioTimestamp"]);D!=null&&l(n,["audioTimestamp"],D);const to=r(t,["thinkingConfig"]);return to!=null&&l(n,["thinkingConfig"],ou(o,to)),n}function ti(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["contents"]);if(i!=null){let a=Se(o,i);Array.isArray(a)&&(a=a.map(u=>Qe(o,u))),l(e,["contents"],a)}const s=r(t,["config"]);return s!=null&&l(e,["generationConfig"],iu(o,s,e)),e}function su(o,t,e){const n={},i=r(t,["taskType"]);e!==void 0&&i!=null&&l(e,["instances[]","task_type"],i);const s=r(t,["title"]);e!==void 0&&s!=null&&l(e,["instances[]","title"],s);const a=r(t,["outputDimensionality"]);e!==void 0&&a!=null&&l(e,["parameters","outputDimensionality"],a);const u=r(t,["mimeType"]);e!==void 0&&u!=null&&l(e,["instances[]","mimeType"],u);const d=r(t,["autoTruncate"]);return e!==void 0&&d!=null&&l(e,["parameters","autoTruncate"],d),n}function ru(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["contents"]);i!=null&&l(e,["instances[]","content"],Ii(o,i));const s=r(t,["config"]);return s!=null&&l(e,["config"],su(o,s,e)),e}function lu(o,t,e){const n={},i=r(t,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);const s=r(t,["negativePrompt"]);e!==void 0&&s!=null&&l(e,["parameters","negativePrompt"],s);const a=r(t,["numberOfImages"]);e!==void 0&&a!=null&&l(e,["parameters","sampleCount"],a);const u=r(t,["aspectRatio"]);e!==void 0&&u!=null&&l(e,["parameters","aspectRatio"],u);const d=r(t,["guidanceScale"]);e!==void 0&&d!=null&&l(e,["parameters","guidanceScale"],d);const c=r(t,["seed"]);e!==void 0&&c!=null&&l(e,["parameters","seed"],c);const f=r(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&l(e,["parameters","safetySetting"],f);const p=r(t,["personGeneration"]);e!==void 0&&p!=null&&l(e,["parameters","personGeneration"],p);const m=r(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&l(e,["parameters","includeSafetyAttributes"],m);const g=r(t,["includeRaiReason"]);e!==void 0&&g!=null&&l(e,["parameters","includeRaiReason"],g);const h=r(t,["language"]);e!==void 0&&h!=null&&l(e,["parameters","language"],h);const v=r(t,["outputMimeType"]);e!==void 0&&v!=null&&l(e,["parameters","outputOptions","mimeType"],v);const y=r(t,["outputCompressionQuality"]);e!==void 0&&y!=null&&l(e,["parameters","outputOptions","compressionQuality"],y);const T=r(t,["addWatermark"]);e!==void 0&&T!=null&&l(e,["parameters","addWatermark"],T);const C=r(t,["enhancePrompt"]);return e!==void 0&&C!=null&&l(e,["parameters","enhancePrompt"],C),n}function au(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["prompt"]);i!=null&&l(e,["instances[0]","prompt"],i);const s=r(t,["config"]);return s!=null&&l(e,["config"],lu(o,s,e)),e}function In(o,t){const e={},n=r(t,["gcsUri"]);n!=null&&l(e,["gcsUri"],n);const i=r(t,["imageBytes"]);i!=null&&l(e,["bytesBase64Encoded"],ke(o,i));const s=r(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function uu(o,t){const e={},n=r(t,["maskMode"]);n!=null&&l(e,["maskMode"],n);const i=r(t,["segmentationClasses"]);i!=null&&l(e,["maskClasses"],i);const s=r(t,["maskDilation"]);return s!=null&&l(e,["dilation"],s),e}function cu(o,t){const e={},n=r(t,["controlType"]);n!=null&&l(e,["controlType"],n);const i=r(t,["enableControlImageComputation"]);return i!=null&&l(e,["computeControl"],i),e}function du(o,t){const e={},n=r(t,["styleDescription"]);return n!=null&&l(e,["styleDescription"],n),e}function fu(o,t){const e={},n=r(t,["subjectType"]);n!=null&&l(e,["subjectType"],n);const i=r(t,["subjectDescription"]);return i!=null&&l(e,["subjectDescription"],i),e}function pu(o,t){const e={},n=r(t,["referenceImage"]);n!=null&&l(e,["referenceImage"],In(o,n));const i=r(t,["referenceId"]);i!=null&&l(e,["referenceId"],i);const s=r(t,["referenceType"]);s!=null&&l(e,["referenceType"],s);const a=r(t,["maskImageConfig"]);a!=null&&l(e,["maskImageConfig"],uu(o,a));const u=r(t,["controlImageConfig"]);u!=null&&l(e,["controlImageConfig"],cu(o,u));const d=r(t,["styleImageConfig"]);d!=null&&l(e,["styleImageConfig"],du(o,d));const c=r(t,["subjectImageConfig"]);return c!=null&&l(e,["subjectImageConfig"],fu(o,c)),e}function mu(o,t,e){const n={},i=r(t,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);const s=r(t,["negativePrompt"]);e!==void 0&&s!=null&&l(e,["parameters","negativePrompt"],s);const a=r(t,["numberOfImages"]);e!==void 0&&a!=null&&l(e,["parameters","sampleCount"],a);const u=r(t,["aspectRatio"]);e!==void 0&&u!=null&&l(e,["parameters","aspectRatio"],u);const d=r(t,["guidanceScale"]);e!==void 0&&d!=null&&l(e,["parameters","guidanceScale"],d);const c=r(t,["seed"]);e!==void 0&&c!=null&&l(e,["parameters","seed"],c);const f=r(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&l(e,["parameters","safetySetting"],f);const p=r(t,["personGeneration"]);e!==void 0&&p!=null&&l(e,["parameters","personGeneration"],p);const m=r(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&l(e,["parameters","includeSafetyAttributes"],m);const g=r(t,["includeRaiReason"]);e!==void 0&&g!=null&&l(e,["parameters","includeRaiReason"],g);const h=r(t,["language"]);e!==void 0&&h!=null&&l(e,["parameters","language"],h);const v=r(t,["outputMimeType"]);e!==void 0&&v!=null&&l(e,["parameters","outputOptions","mimeType"],v);const y=r(t,["outputCompressionQuality"]);e!==void 0&&y!=null&&l(e,["parameters","outputOptions","compressionQuality"],y);const T=r(t,["editMode"]);e!==void 0&&T!=null&&l(e,["parameters","editMode"],T);const C=r(t,["baseSteps"]);return e!==void 0&&C!=null&&l(e,["parameters","editConfig","baseSteps"],C),n}function gu(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["prompt"]);i!=null&&l(e,["instances[0]","prompt"],i);const s=r(t,["referenceImages"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(d=>pu(o,d))),l(e,["instances[0]","referenceImages"],u)}const a=r(t,["config"]);return a!=null&&l(e,["config"],mu(o,a,e)),e}function hu(o,t,e){const n={},i=r(t,["includeRaiReason"]);e!==void 0&&i!=null&&l(e,["parameters","includeRaiReason"],i);const s=r(t,["outputMimeType"]);e!==void 0&&s!=null&&l(e,["parameters","outputOptions","mimeType"],s);const a=r(t,["outputCompressionQuality"]);e!==void 0&&a!=null&&l(e,["parameters","outputOptions","compressionQuality"],a);const u=r(t,["numberOfImages"]);e!==void 0&&u!=null&&l(e,["parameters","sampleCount"],u);const d=r(t,["mode"]);return e!==void 0&&d!=null&&l(e,["parameters","mode"],d),n}function yu(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["image"]);i!=null&&l(e,["instances[0]","image"],In(o,i));const s=r(t,["upscaleFactor"]);s!=null&&l(e,["parameters","upscaleConfig","upscaleFactor"],s);const a=r(t,["config"]);return a!=null&&l(e,["config"],hu(o,a,e)),e}function vu(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","name"],b(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function Tu(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const s=r(t,["pageToken"]);e!==void 0&&s!=null&&l(e,["_query","pageToken"],s);const a=r(t,["filter"]);e!==void 0&&a!=null&&l(e,["_query","filter"],a);const u=r(t,["queryBase"]);return e!==void 0&&u!=null&&l(e,["_url","models_url"],ki(o,u)),n}function Cu(o,t){const e={},n=r(t,["config"]);return n!=null&&l(e,["config"],Tu(o,n,e)),e}function Eu(o,t,e){const n={},i=r(t,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);const s=r(t,["description"]);e!==void 0&&s!=null&&l(e,["description"],s);const a=r(t,["defaultCheckpointId"]);return e!==void 0&&a!=null&&l(e,["defaultCheckpointId"],a),n}function Iu(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],Eu(o,i,e)),e}function wu(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","name"],b(o,n));const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function xu(o,t,e){const n={},i=r(t,["systemInstruction"]);e!==void 0&&i!=null&&l(e,["systemInstruction"],Qe(o,J(o,i)));const s=r(t,["tools"]);if(e!==void 0&&s!=null){let u=s;Array.isArray(u)&&(u=u.map(d=>Ri(o,d))),l(e,["tools"],u)}const a=r(t,["generationConfig"]);return e!==void 0&&a!=null&&l(e,["generationConfig"],a),n}function Su(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["contents"]);if(i!=null){let a=Se(o,i);Array.isArray(a)&&(a=a.map(u=>Qe(o,u))),l(e,["contents"],a)}const s=r(t,["config"]);return s!=null&&l(e,["config"],xu(o,s,e)),e}function _u(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["contents"]);if(i!=null){let a=Se(o,i);Array.isArray(a)&&(a=a.map(u=>Qe(o,u))),l(e,["contents"],a)}const s=r(t,["config"]);return s!=null&&l(e,["config"],s),e}function ku(o,t,e){const n={},i=r(t,["numberOfVideos"]);e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i);const s=r(t,["outputGcsUri"]);e!==void 0&&s!=null&&l(e,["parameters","storageUri"],s);const a=r(t,["fps"]);e!==void 0&&a!=null&&l(e,["parameters","fps"],a);const u=r(t,["durationSeconds"]);e!==void 0&&u!=null&&l(e,["parameters","durationSeconds"],u);const d=r(t,["seed"]);e!==void 0&&d!=null&&l(e,["parameters","seed"],d);const c=r(t,["aspectRatio"]);e!==void 0&&c!=null&&l(e,["parameters","aspectRatio"],c);const f=r(t,["resolution"]);e!==void 0&&f!=null&&l(e,["parameters","resolution"],f);const p=r(t,["personGeneration"]);e!==void 0&&p!=null&&l(e,["parameters","personGeneration"],p);const m=r(t,["pubsubTopic"]);e!==void 0&&m!=null&&l(e,["parameters","pubsubTopic"],m);const g=r(t,["negativePrompt"]);e!==void 0&&g!=null&&l(e,["parameters","negativePrompt"],g);const h=r(t,["enhancePrompt"]);return e!==void 0&&h!=null&&l(e,["parameters","enhancePrompt"],h),n}function Au(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["_url","model"],b(o,n));const i=r(t,["prompt"]);i!=null&&l(e,["instances[0]","prompt"],i);const s=r(t,["image"]);s!=null&&l(e,["instances[0]","image"],In(o,s));const a=r(t,["config"]);return a!=null&&l(e,["config"],ku(o,a,e)),e}function Mu(o,t){const e={},n=r(t,["data"]);n!=null&&l(e,["data"],n);const i=r(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Ru(o,t){const e={},n=r(t,["thought"]);n!=null&&l(e,["thought"],n);const i=r(t,["inlineData"]);i!=null&&l(e,["inlineData"],Mu(o,i));const s=r(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const a=r(t,["executableCode"]);a!=null&&l(e,["executableCode"],a);const u=r(t,["fileData"]);u!=null&&l(e,["fileData"],u);const d=r(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);const c=r(t,["functionResponse"]);c!=null&&l(e,["functionResponse"],c);const f=r(t,["text"]);return f!=null&&l(e,["text"],f),e}function Pu(o,t){const e={},n=r(t,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>Ru(o,a))),l(e,["parts"],s)}const i=r(t,["role"]);return i!=null&&l(e,["role"],i),e}function Lu(o,t){const e={},n=r(t,["citationSources"]);return n!=null&&l(e,["citations"],n),e}function Du(o,t){const e={},n=r(t,["content"]);n!=null&&l(e,["content"],Pu(o,n));const i=r(t,["citationMetadata"]);i!=null&&l(e,["citationMetadata"],Lu(o,i));const s=r(t,["tokenCount"]);s!=null&&l(e,["tokenCount"],s);const a=r(t,["finishReason"]);a!=null&&l(e,["finishReason"],a);const u=r(t,["avgLogprobs"]);u!=null&&l(e,["avgLogprobs"],u);const d=r(t,["groundingMetadata"]);d!=null&&l(e,["groundingMetadata"],d);const c=r(t,["index"]);c!=null&&l(e,["index"],c);const f=r(t,["logprobsResult"]);f!=null&&l(e,["logprobsResult"],f);const p=r(t,["safetyRatings"]);return p!=null&&l(e,["safetyRatings"],p),e}function ni(o,t){const e={},n=r(t,["candidates"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(d=>Du(o,d))),l(e,["candidates"],u)}const i=r(t,["modelVersion"]);i!=null&&l(e,["modelVersion"],i);const s=r(t,["promptFeedback"]);s!=null&&l(e,["promptFeedback"],s);const a=r(t,["usageMetadata"]);return a!=null&&l(e,["usageMetadata"],a),e}function Nu(o,t){const e={},n=r(t,["values"]);return n!=null&&l(e,["values"],n),e}function bu(){return{}}function Bu(o,t){const e={},n=r(t,["embeddings"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>Nu(o,a))),l(e,["embeddings"],s)}return r(t,["metadata"])!=null&&l(e,["metadata"],bu()),e}function Vu(o,t){const e={},n=r(t,["bytesBase64Encoded"]);n!=null&&l(e,["imageBytes"],ke(o,n));const i=r(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Pi(o,t){const e={},n=r(t,["safetyAttributes","categories"]);n!=null&&l(e,["categories"],n);const i=r(t,["safetyAttributes","scores"]);i!=null&&l(e,["scores"],i);const s=r(t,["contentType"]);return s!=null&&l(e,["contentType"],s),e}function Uu(o,t){const e={},n=r(t,["_self"]);n!=null&&l(e,["image"],Vu(o,n));const i=r(t,["raiFilteredReason"]);i!=null&&l(e,["raiFilteredReason"],i);const s=r(t,["_self"]);return s!=null&&l(e,["safetyAttributes"],Pi(o,s)),e}function $u(o,t){const e={},n=r(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>Uu(o,a))),l(e,["generatedImages"],s)}const i=r(t,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],Pi(o,i)),e}function Fu(o,t){const e={},n=r(t,["baseModel"]);n!=null&&l(e,["baseModel"],n);const i=r(t,["createTime"]);i!=null&&l(e,["createTime"],i);const s=r(t,["updateTime"]);return s!=null&&l(e,["updateTime"],s),e}function an(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["displayName"]);i!=null&&l(e,["displayName"],i);const s=r(t,["description"]);s!=null&&l(e,["description"],s);const a=r(t,["version"]);a!=null&&l(e,["version"],a);const u=r(t,["_self"]);u!=null&&l(e,["tunedModelInfo"],Fu(o,u));const d=r(t,["inputTokenLimit"]);d!=null&&l(e,["inputTokenLimit"],d);const c=r(t,["outputTokenLimit"]);c!=null&&l(e,["outputTokenLimit"],c);const f=r(t,["supportedGenerationMethods"]);return f!=null&&l(e,["supportedActions"],f),e}function qu(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);const i=r(t,["_self"]);if(i!=null){let s=Ai(o,i);Array.isArray(s)&&(s=s.map(a=>an(o,a))),l(e,["models"],s)}return e}function Gu(){return{}}function Hu(o,t){const e={},n=r(t,["totalTokens"]);n!=null&&l(e,["totalTokens"],n);const i=r(t,["cachedContentTokenCount"]);return i!=null&&l(e,["cachedContentTokenCount"],i),e}function Yu(o,t){const e={},n=r(t,["video","uri"]);n!=null&&l(e,["uri"],n);const i=r(t,["video","encodedVideo"]);i!=null&&l(e,["videoBytes"],ke(o,i));const s=r(t,["encoding"]);return s!=null&&l(e,["mimeType"],s),e}function Wu(o,t){const e={},n=r(t,["_self"]);return n!=null&&l(e,["video"],Yu(o,n)),e}function zu(o,t){const e={},n=r(t,["generatedSamples"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(u=>Wu(o,u))),l(e,["generatedVideos"],a)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);const s=r(t,["raiMediaFilteredReasons"]);return s!=null&&l(e,["raiMediaFilteredReasons"],s),e}function Ju(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["metadata"]);i!=null&&l(e,["metadata"],i);const s=r(t,["done"]);s!=null&&l(e,["done"],s);const a=r(t,["error"]);a!=null&&l(e,["error"],a);const u=r(t,["response","generateVideoResponse"]);return u!=null&&l(e,["response"],zu(o,u)),e}function Ku(o,t){const e={},n=r(t,["displayName"]);n!=null&&l(e,["displayName"],n);const i=r(t,["data"]);i!=null&&l(e,["data"],i);const s=r(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Ou(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&l(e,["thought"],i);const s=r(t,["inlineData"]);s!=null&&l(e,["inlineData"],Ku(o,s));const a=r(t,["codeExecutionResult"]);a!=null&&l(e,["codeExecutionResult"],a);const u=r(t,["executableCode"]);u!=null&&l(e,["executableCode"],u);const d=r(t,["fileData"]);d!=null&&l(e,["fileData"],d);const c=r(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);const f=r(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&l(e,["text"],p),e}function Zu(o,t){const e={},n=r(t,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>Ou(o,a))),l(e,["parts"],s)}const i=r(t,["role"]);return i!=null&&l(e,["role"],i),e}function Qu(o,t){const e={},n=r(t,["citations"]);return n!=null&&l(e,["citations"],n),e}function Xu(o,t){const e={},n=r(t,["content"]);n!=null&&l(e,["content"],Zu(o,n));const i=r(t,["citationMetadata"]);i!=null&&l(e,["citationMetadata"],Qu(o,i));const s=r(t,["finishMessage"]);s!=null&&l(e,["finishMessage"],s);const a=r(t,["finishReason"]);a!=null&&l(e,["finishReason"],a);const u=r(t,["avgLogprobs"]);u!=null&&l(e,["avgLogprobs"],u);const d=r(t,["groundingMetadata"]);d!=null&&l(e,["groundingMetadata"],d);const c=r(t,["index"]);c!=null&&l(e,["index"],c);const f=r(t,["logprobsResult"]);f!=null&&l(e,["logprobsResult"],f);const p=r(t,["safetyRatings"]);return p!=null&&l(e,["safetyRatings"],p),e}function oi(o,t){const e={},n=r(t,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(f=>Xu(o,f))),l(e,["candidates"],c)}const i=r(t,["createTime"]);i!=null&&l(e,["createTime"],i);const s=r(t,["responseId"]);s!=null&&l(e,["responseId"],s);const a=r(t,["modelVersion"]);a!=null&&l(e,["modelVersion"],a);const u=r(t,["promptFeedback"]);u!=null&&l(e,["promptFeedback"],u);const d=r(t,["usageMetadata"]);return d!=null&&l(e,["usageMetadata"],d),e}function ju(o,t){const e={},n=r(t,["truncated"]);n!=null&&l(e,["truncated"],n);const i=r(t,["token_count"]);return i!=null&&l(e,["tokenCount"],i),e}function ec(o,t){const e={},n=r(t,["values"]);n!=null&&l(e,["values"],n);const i=r(t,["statistics"]);return i!=null&&l(e,["statistics"],ju(o,i)),e}function tc(o,t){const e={},n=r(t,["billableCharacterCount"]);return n!=null&&l(e,["billableCharacterCount"],n),e}function nc(o,t){const e={},n=r(t,["predictions[]","embeddings"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>ec(o,a))),l(e,["embeddings"],s)}const i=r(t,["metadata"]);return i!=null&&l(e,["metadata"],tc(o,i)),e}function oc(o,t){const e={},n=r(t,["gcsUri"]);n!=null&&l(e,["gcsUri"],n);const i=r(t,["bytesBase64Encoded"]);i!=null&&l(e,["imageBytes"],ke(o,i));const s=r(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Li(o,t){const e={},n=r(t,["safetyAttributes","categories"]);n!=null&&l(e,["categories"],n);const i=r(t,["safetyAttributes","scores"]);i!=null&&l(e,["scores"],i);const s=r(t,["contentType"]);return s!=null&&l(e,["contentType"],s),e}function wn(o,t){const e={},n=r(t,["_self"]);n!=null&&l(e,["image"],oc(o,n));const i=r(t,["raiFilteredReason"]);i!=null&&l(e,["raiFilteredReason"],i);const s=r(t,["_self"]);s!=null&&l(e,["safetyAttributes"],Li(o,s));const a=r(t,["prompt"]);return a!=null&&l(e,["enhancedPrompt"],a),e}function ic(o,t){const e={},n=r(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(a=>wn(o,a))),l(e,["generatedImages"],s)}const i=r(t,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],Li(o,i)),e}function sc(o,t){const e={},n=r(t,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>wn(o,s))),l(e,["generatedImages"],i)}return e}function rc(o,t){const e={},n=r(t,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>wn(o,s))),l(e,["generatedImages"],i)}return e}function lc(o,t){const e={},n=r(t,["endpoint"]);n!=null&&l(e,["name"],n);const i=r(t,["deployedModelId"]);return i!=null&&l(e,["deployedModelId"],i),e}function ac(o,t){const e={},n=r(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&l(e,["baseModel"],n);const i=r(t,["createTime"]);i!=null&&l(e,["createTime"],i);const s=r(t,["updateTime"]);return s!=null&&l(e,["updateTime"],s),e}function uc(o,t){const e={},n=r(t,["checkpointId"]);n!=null&&l(e,["checkpointId"],n);const i=r(t,["epoch"]);i!=null&&l(e,["epoch"],i);const s=r(t,["step"]);return s!=null&&l(e,["step"],s),e}function un(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["displayName"]);i!=null&&l(e,["displayName"],i);const s=r(t,["description"]);s!=null&&l(e,["description"],s);const a=r(t,["versionId"]);a!=null&&l(e,["version"],a);const u=r(t,["deployedModels"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(g=>lc(o,g))),l(e,["endpoints"],m)}const d=r(t,["labels"]);d!=null&&l(e,["labels"],d);const c=r(t,["_self"]);c!=null&&l(e,["tunedModelInfo"],ac(o,c));const f=r(t,["defaultCheckpointId"]);f!=null&&l(e,["defaultCheckpointId"],f);const p=r(t,["checkpoints"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(g=>uc(o,g))),l(e,["checkpoints"],m)}return e}function cc(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);const i=r(t,["_self"]);if(i!=null){let s=Ai(o,i);Array.isArray(s)&&(s=s.map(a=>un(o,a))),l(e,["models"],s)}return e}function dc(){return{}}function fc(o,t){const e={},n=r(t,["totalTokens"]);return n!=null&&l(e,["totalTokens"],n),e}function pc(o,t){const e={},n=r(t,["tokensInfo"]);return n!=null&&l(e,["tokensInfo"],n),e}function mc(o,t){const e={},n=r(t,["gcsUri"]);n!=null&&l(e,["uri"],n);const i=r(t,["bytesBase64Encoded"]);i!=null&&l(e,["videoBytes"],ke(o,i));const s=r(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function gc(o,t){const e={},n=r(t,["_self"]);return n!=null&&l(e,["video"],mc(o,n)),e}function hc(o,t){const e={},n=r(t,["videos"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(u=>gc(o,u))),l(e,["generatedVideos"],a)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);const s=r(t,["raiMediaFilteredReasons"]);return s!=null&&l(e,["raiMediaFilteredReasons"],s),e}function yc(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["metadata"]);i!=null&&l(e,["metadata"],i);const s=r(t,["done"]);s!=null&&l(e,["done"],s);const a=r(t,["error"]);a!=null&&l(e,["error"],a);const u=r(t,["response"]);return u!=null&&l(e,["response"],hc(o,u)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vc="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Tc(o,t,e){const n=new Vr;let i;if(e.data instanceof Blob?i=JSON.parse(await e.data.text()):i=JSON.parse(e.data),o.isVertexAI()){const s=ua(o,i);Object.assign(n,s)}else{const s=aa(o,i);Object.assign(n,s)}t(n)}class Cc{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n}async connect(t){var e,n,i,s;const a=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion();let d;const c=xc(this.apiClient.getDefaultHeaders());if(this.apiClient.isVertexAI())d=`${a}/ws/google.cloud.aiplatform.${u}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(c);else{const w=this.apiClient.getApiKey();d=`${a}/ws/google.ai.generativelanguage.${u}.GenerativeService.BidiGenerateContent?key=${w}`}let f=()=>{};const p=new Promise(w=>{f=w}),m=t.callbacks,g=function(){var w;(w=m==null?void 0:m.onopen)===null||w===void 0||w.call(m),f({})},h=this.apiClient,v={onopen:g,onmessage:w=>{Tc(h,m.onmessage,w)},onerror:(e=m==null?void 0:m.onerror)!==null&&e!==void 0?e:function(w){},onclose:(n=m==null?void 0:m.onclose)!==null&&n!==void 0?n:function(w){}},y=this.webSocketFactory.create(d,wc(c),v);y.connect(),await p;let T=b(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&T.startsWith("publishers/")){const w=this.apiClient.getProject(),M=this.apiClient.getLocation();T=`projects/${w}/locations/${M}/`+T}let C={};this.apiClient.isVertexAI()&&((i=t.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[me.AUDIO]}:t.config.responseModalities=[me.AUDIO]),!((s=t.config)===null||s===void 0)&&s.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const A={model:T,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?C=Dl(this.apiClient,A):C=Ll(this.apiClient,A),delete C.config,y.send(JSON.stringify(C)),new Ic(y,this.apiClient)}}const Ec={turnComplete:!0};class Ic{constructor(t,e){this.conn=t,this.apiClient=e}tLiveClientContent(t,e){if(e.turns!==null&&e.turns!==void 0){let n=[];try{n=Se(t,e.turns),t.isVertexAI()?n=n.map(i=>Qe(t,i)):n=n.map(i=>Ft(t,i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof e.turns}'`)}return{clientContent:{turns:n,turnComplete:e.turnComplete}}}return{clientContent:{turnComplete:e.turnComplete}}}tLiveClienttToolResponse(t,e){let n=[];if(e.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(e.functionResponses)?n=e.functionResponses:n=[e.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const s of n){if(typeof s!="object"||s===null||!("name"in s)||!("response"in s))throw new Error(`Could not parse function response, type '${typeof s}'.`);if(!t.isVertexAI()&&!("id"in s))throw new Error(vc)}return{toolResponse:{functionResponses:n}}}sendClientContent(t){t=Object.assign(Object.assign({},Ec),t);const e=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendRealtimeInput(t){let e={};this.apiClient.isVertexAI()?e={realtimeInput:$l(this.apiClient,t)}:e={realtimeInput:Ul(this.apiClient,t)},this.conn.send(JSON.stringify(e))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const e=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(e))}close(){this.conn.close()}}function wc(o){const t={};return o.forEach((e,n)=>{t[n]=e}),t}function xc(o){const t=new Headers;for(const[e,n]of Object.entries(o))t.append(e,n);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Sc extends st{constructor(t){super(),this.apiClient=t,this.generateContent=async e=>await this.generateContentInternal(e),this.generateContentStream=async e=>await this.generateContentStreamInternal(e),this.generateImages=async e=>await this.generateImagesInternal(e).then(n=>{var i;let s;const a=[];if(n!=null&&n.generatedImages)for(const d of n.generatedImages)d&&(d!=null&&d.safetyAttributes)&&((i=d==null?void 0:d.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?s=d==null?void 0:d.safetyAttributes:a.push(d);let u;return s?u={generatedImages:a,positivePromptSafetyAttributes:s}:u={generatedImages:a},u}),this.list=async e=>{var n;const a={config:Object.assign(Object.assign({},{queryBase:!0}),e==null?void 0:e.config)};if(this.apiClient.isVertexAI()&&!a.config.queryBase){if(!((n=a.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");a.config.filter="labels.tune-type:*"}return new $t(We.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(a),a)},this.editImage=async e=>{const n={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(n.referenceImages=e.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async e=>{let n={numberOfImages:1,mode:"upscale"};e.config&&(n=Object.assign(Object.assign({},n),e.config));const i={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:n};return await this.upscaleImageInternal(i)}}async generateContentInternal(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=ti(this.apiClient,t);return u=x("{model}:generateContent",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=oi(this.apiClient,f),m=new gt;return Object.assign(m,p),m})}else{const c=ei(this.apiClient,t);return u=x("{model}:generateContent",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>{const p=ni(this.apiClient,f),m=new gt;return Object.assign(m,p),m})}}async generateContentStreamInternal(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=ti(this.apiClient,t);u=x("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c.config,delete c._url,delete c._query;const f=this.apiClient;return a=f.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}),a.then(function(p){return St(this,arguments,function*(){var m,g,h,v;try{for(var y=!0,T=rn(p),C;C=yield G(T.next()),m=C.done,!m;y=!0){v=C.value,y=!1;const w=oi(f,yield G(v.json())),M=new gt;Object.assign(M,w),yield yield G(M)}}catch(A){g={error:A}}finally{try{!y&&!m&&(h=T.return)&&(yield G(h.call(T)))}finally{if(g)throw g.error}}})})}else{const c=ei(this.apiClient,t);u=x("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c.config,delete c._url,delete c._query;const f=this.apiClient;return a=f.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}),a.then(function(p){return St(this,arguments,function*(){var m,g,h,v;try{for(var y=!0,T=rn(p),C;C=yield G(T.next()),m=C.done,!m;y=!0){v=C.value,y=!1;const w=ni(f,yield G(v.json())),M=new gt;Object.assign(M,w),yield yield G(M)}}catch(A){g={error:A}}finally{try{!y&&!m&&(h=T.return)&&(yield G(h.call(T)))}finally{if(g)throw g.error}}})})}}async embedContent(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=ru(this.apiClient,t);return u=x("{model}:predict",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=nc(this.apiClient,f),m=new qo;return Object.assign(m,p),m})}else{const c=Sa(this.apiClient,t);return u=x("{model}:batchEmbedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Bu(this.apiClient,f),m=new qo;return Object.assign(m,p),m})}}async generateImagesInternal(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=au(this.apiClient,t);return u=x("{model}:predict",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=ic(this.apiClient,f),m=new Go;return Object.assign(m,p),m})}else{const c=ka(this.apiClient,t);return u=x("{model}:predict",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>{const p=$u(this.apiClient,f),m=new Go;return Object.assign(m,p),m})}}async editImageInternal(t){var e,n;let i,s="",a={};if(this.apiClient.isVertexAI()){const u=gu(this.apiClient,t);return s=x("{model}:predict",u._url),a=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const c=sc(this.apiClient,d),f=new Pr;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var e,n;let i,s="",a={};if(this.apiClient.isVertexAI()){const u=yu(this.apiClient,t);return s=x("{model}:predict",u._url),a=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const c=rc(this.apiClient,d),f=new Lr;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=vu(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>un(this.apiClient,f))}else{const c=Aa(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>an(this.apiClient,f))}}async listInternal(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Cu(this.apiClient,t);return u=x("{models_url}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=cc(this.apiClient,f),m=new Ho;return Object.assign(m,p),m})}else{const c=Ra(this.apiClient,t);return u=x("{models_url}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>{const p=qu(this.apiClient,f),m=new Ho;return Object.assign(m,p),m})}}async update(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Iu(this.apiClient,t);return u=x("{model}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>un(this.apiClient,f))}else{const c=La(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>an(this.apiClient,f))}}async delete(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=wu(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(()=>{const f=dc(),p=new Yo;return Object.assign(p,f),p})}else{const c=Da(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(()=>{const f=Gu(),p=new Yo;return Object.assign(p,f),p})}}async countTokens(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Su(this.apiClient,t);return u=x("{model}:countTokens",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=fc(this.apiClient,f),m=new Wo;return Object.assign(m,p),m})}else{const c=ba(this.apiClient,t);return u=x("{model}:countTokens",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Hu(this.apiClient,f),m=new Wo;return Object.assign(m,p),m})}}async computeTokens(t){var e,n;let i,s="",a={};if(this.apiClient.isVertexAI()){const u=_u(this.apiClient,t);return s=x("{model}:computeTokens",u._url),a=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const c=pc(this.apiClient,d),f=new Dr;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Au(this.apiClient,t);return u=x("{model}:predictLongRunning",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>yc(this.apiClient,f))}else{const c=Ua(this.apiClient,t);return u=x("{model}:predictLongRunning",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>Ju(this.apiClient,f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _c(o,t){const e={},n=r(t,["operationName"]);n!=null&&l(e,["_url","operationName"],n);const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function kc(o,t){const e={},n=r(t,["operationName"]);n!=null&&l(e,["_url","operationName"],n);const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function Ac(o,t){const e={},n=r(t,["operationName"]);n!=null&&l(e,["operationName"],n);const i=r(t,["resourceName"]);i!=null&&l(e,["_url","resourceName"],i);const s=r(t,["config"]);return s!=null&&l(e,["config"],s),e}function Mc(o,t){const e={},n=r(t,["video","uri"]);n!=null&&l(e,["uri"],n);const i=r(t,["video","encodedVideo"]);i!=null&&l(e,["videoBytes"],ke(o,i));const s=r(t,["encoding"]);return s!=null&&l(e,["mimeType"],s),e}function Rc(o,t){const e={},n=r(t,["_self"]);return n!=null&&l(e,["video"],Mc(o,n)),e}function Pc(o,t){const e={},n=r(t,["generatedSamples"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(u=>Rc(o,u))),l(e,["generatedVideos"],a)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);const s=r(t,["raiMediaFilteredReasons"]);return s!=null&&l(e,["raiMediaFilteredReasons"],s),e}function Lc(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["metadata"]);i!=null&&l(e,["metadata"],i);const s=r(t,["done"]);s!=null&&l(e,["done"],s);const a=r(t,["error"]);a!=null&&l(e,["error"],a);const u=r(t,["response","generateVideoResponse"]);return u!=null&&l(e,["response"],Pc(o,u)),e}function Dc(o,t){const e={},n=r(t,["gcsUri"]);n!=null&&l(e,["uri"],n);const i=r(t,["bytesBase64Encoded"]);i!=null&&l(e,["videoBytes"],ke(o,i));const s=r(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Nc(o,t){const e={},n=r(t,["_self"]);return n!=null&&l(e,["video"],Dc(o,n)),e}function bc(o,t){const e={},n=r(t,["videos"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(u=>Nc(o,u))),l(e,["generatedVideos"],a)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);const s=r(t,["raiMediaFilteredReasons"]);return s!=null&&l(e,["raiMediaFilteredReasons"],s),e}function ii(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["metadata"]);i!=null&&l(e,["metadata"],i);const s=r(t,["done"]);s!=null&&l(e,["done"],s);const a=r(t,["error"]);a!=null&&l(e,["error"],a);const u=r(t,["response"]);return u!=null&&l(e,["response"],bc(o,u)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Bc extends st{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const e=t.operation,n=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=e.name.split("/operations/")[0];let s;return n&&"httpOptions"in n&&(s=n.httpOptions),this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:i,config:{httpOptions:s}})}else return this.getVideosOperationInternal({operationName:e.name,config:n})}async getVideosOperationInternal(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=kc(this.apiClient,t);return u=x("{operationName}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>ii(this.apiClient,f))}else{const c=_c(this.apiClient,t);return u=x("{operationName}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>Lc(this.apiClient,f))}}async fetchPredictVideosOperationInternal(t){var e,n;let i,s="",a={};if(this.apiClient.isVertexAI()){const u=Ac(this.apiClient,t);return s=x("{resourceName}:fetchPredictOperation",u._url),a=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>ii(this.apiClient,d))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Vc="Content-Type",Uc="X-Server-Timeout",$c="User-Agent",Fc="x-goog-api-client",qc="0.14.1",Gc=`google-genai-sdk/${qc}`,Hc="v1beta1",Yc="v1beta",si=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Di extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ClientError"}}class cn extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ServerError"}}class Wc{constructor(t){var e,n;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(e=this.clientOptions.apiVersion)!==null&&e!==void 0?e:Hc,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Yc,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,t.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&n.push(t.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),e=new URL(t);return e.protocol=e.protocol=="http:"?"ws":"wss",e.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,e,n){const i=[this.getRequestUrlInternal(e)];return n&&i.push(this.getBaseResourcePath()),t!==""&&i.push(t),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,n);if(t.queryParams)for(const[a,u]of Object.entries(t.queryParams))i.searchParams.append(a,String(u));let s={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else s.body=t.body;return s=await this.includeExtraHttpOptionsToRequestInit(s,e,t.abortSignal),this.unaryApiCall(i,s,t.httpMethod)}patchHttpOptions(t,e){const n=JSON.parse(JSON.stringify(t));for(const[i,s]of Object.entries(e))typeof s=="object"?n[i]=Object.assign(Object.assign({},n[i]),s):s!==void 0&&(n[i]=s);return n}async requestStream(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,n);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let s={};return s.body=t.body,s=await this.includeExtraHttpOptionsToRequestInit(s,e,t.abortSignal),this.streamApiCall(i,s,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,e,n){if(e&&e.timeout||n){const i=new AbortController,s=i.signal;e.timeout&&(e==null?void 0:e.timeout)>0&&setTimeout(()=>i.abort(),e.timeout),n&&n.addEventListener("abort",()=>{i.abort()}),t.signal=s}return t.headers=await this.getHeadersInternal(e),t}async unaryApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await ri(i),new sn(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await ri(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(t){var e;return St(this,arguments,function*(){const i=(e=t==null?void 0:t.body)===null||e===void 0?void 0:e.getReader(),s=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let a="";for(;;){const{done:u,value:d}=yield G(i.read());if(u){if(a.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const c=s.decode(d);try{const p=JSON.parse(c);if("error"in p){const m=JSON.parse(JSON.stringify(p.error)),g=m.status,h=m.code,v=`got status: ${g}. ${JSON.stringify(p)}`;if(h>=400&&h<500)throw new Di(v);if(h>=500&&h<600)throw new cn(v)}}catch(p){const m=p;if(m.name==="ClientError"||m.name==="ServerError")throw p}a+=c;let f=a.match(si);for(;f;){const p=f[1];try{const m=new Response(p,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield G(new sn(m)),a=a.slice(f[0].length),f=a.match(si)}catch(m){throw new Error(`exception parsing stream chunk ${p}. ${m}`)}}}}finally{i.releaseLock()}})}async apiCall(t,e){return fetch(t,e).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const t={},e=Gc+" "+this.clientOptions.userAgentExtra;return t[$c]=e,t[Fc]=e,t[Vc]="application/json",t}async getHeadersInternal(t){const e=new Headers;if(t&&t.headers){for(const[n,i]of Object.entries(t.headers))e.append(n,i);t.timeout&&t.timeout>0&&e.append(Uc,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(e),e}async uploadFile(t,e){var n;const i={};e!=null&&(i.mimeType=e.mimeType,i.name=e.name,i.displayName=e.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const s=this.clientOptions.uploader,a=await s.stat(t);i.sizeBytes=String(a.size);const u=(n=e==null?void 0:e.mimeType)!==null&&n!==void 0?n:a.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=u;const d=await this.fetchUploadUrl(i,e);return s.upload(t,d,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,e){var n;let i={};e!=null&&e.httpOptions?i=e.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${t.mimeType}`}};const s={file:t},a=await this.request({path:x("upload/v1beta/files",s._url),body:JSON.stringify(s),httpMethod:"POST",httpOptions:i});if(!a||!(a!=null&&a.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=(n=a==null?void 0:a.headers)===null||n===void 0?void 0:n["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function ri(o){var t;if(o===void 0)throw new cn("response is undefined");if(!o.ok){const e=o.status,n=o.statusText;let i;!((t=o.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?i=await o.json():i={error:{message:await o.text(),code:o.status,status:o.statusText}};const s=`got status: ${e} ${n}. ${JSON.stringify(i)}`;throw e>=400&&e<500?new Di(s):e>=500&&e<600?new cn(s):new Error(s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zc(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["_url","name"],n);const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function Jc(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const s=r(t,["pageToken"]);e!==void 0&&s!=null&&l(e,["_query","pageToken"],s);const a=r(t,["filter"]);return e!==void 0&&a!=null&&l(e,["_query","filter"],a),n}function Kc(o,t){const e={},n=r(t,["config"]);return n!=null&&l(e,["config"],Jc(o,n,e)),e}function Oc(o,t){const e={},n=r(t,["textInput"]);n!=null&&l(e,["textInput"],n);const i=r(t,["output"]);return i!=null&&l(e,["output"],i),e}function Zc(o,t){const e={};if(r(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=r(t,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Oc(o,s))),l(e,["examples","examples"],i)}return e}function Qc(o,t,e){const n={};if(r(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=r(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&l(e,["displayName"],i),r(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const s=r(t,["epochCount"]);e!==void 0&&s!=null&&l(e,["tuningTask","hyperparameters","epochCount"],s);const a=r(t,["learningRateMultiplier"]);if(a!=null&&l(n,["tuningTask","hyperparameters","learningRateMultiplier"],a),r(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(r(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const u=r(t,["batchSize"]);e!==void 0&&u!=null&&l(e,["tuningTask","hyperparameters","batchSize"],u);const d=r(t,["learningRate"]);return e!==void 0&&d!=null&&l(e,["tuningTask","hyperparameters","learningRate"],d),n}function Xc(o,t){const e={},n=r(t,["baseModel"]);n!=null&&l(e,["baseModel"],n);const i=r(t,["trainingDataset"]);i!=null&&l(e,["tuningTask","trainingData"],Zc(o,i));const s=r(t,["config"]);return s!=null&&l(e,["config"],Qc(o,s,e)),e}function jc(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["_url","name"],n);const i=r(t,["config"]);return i!=null&&l(e,["config"],i),e}function ed(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const s=r(t,["pageToken"]);e!==void 0&&s!=null&&l(e,["_query","pageToken"],s);const a=r(t,["filter"]);return e!==void 0&&a!=null&&l(e,["_query","filter"],a),n}function td(o,t){const e={},n=r(t,["config"]);return n!=null&&l(e,["config"],ed(o,n,e)),e}function nd(o,t,e){const n={},i=r(t,["gcsUri"]);if(e!==void 0&&i!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],i),r(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function od(o,t){const e={},n=r(t,["gcsUri"]);return n!=null&&l(e,["validationDatasetUri"],n),e}function id(o,t,e){const n={},i=r(t,["validationDataset"]);e!==void 0&&i!=null&&l(e,["supervisedTuningSpec"],od(o,i));const s=r(t,["tunedModelDisplayName"]);e!==void 0&&s!=null&&l(e,["tunedModelDisplayName"],s);const a=r(t,["description"]);e!==void 0&&a!=null&&l(e,["description"],a);const u=r(t,["epochCount"]);e!==void 0&&u!=null&&l(e,["supervisedTuningSpec","hyperParameters","epochCount"],u);const d=r(t,["learningRateMultiplier"]);e!==void 0&&d!=null&&l(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],d);const c=r(t,["exportLastCheckpointOnly"]);e!==void 0&&c!=null&&l(e,["supervisedTuningSpec","exportLastCheckpointOnly"],c);const f=r(t,["adapterSize"]);if(e!==void 0&&f!=null&&l(e,["supervisedTuningSpec","hyperParameters","adapterSize"],f),r(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(r(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return n}function sd(o,t){const e={},n=r(t,["baseModel"]);n!=null&&l(e,["baseModel"],n);const i=r(t,["trainingDataset"]);i!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],nd(o,i,e));const s=r(t,["config"]);return s!=null&&l(e,["config"],id(o,s,e)),e}function rd(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["model"],n);const i=r(t,["name"]);return i!=null&&l(e,["endpoint"],i),e}function Ni(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["state"]);i!=null&&l(e,["state"],Si(o,i));const s=r(t,["createTime"]);s!=null&&l(e,["createTime"],s);const a=r(t,["tuningTask","startTime"]);a!=null&&l(e,["startTime"],a);const u=r(t,["tuningTask","completeTime"]);u!=null&&l(e,["endTime"],u);const d=r(t,["updateTime"]);d!=null&&l(e,["updateTime"],d);const c=r(t,["description"]);c!=null&&l(e,["description"],c);const f=r(t,["baseModel"]);f!=null&&l(e,["baseModel"],f);const p=r(t,["_self"]);p!=null&&l(e,["tunedModel"],rd(o,p));const m=r(t,["distillationSpec"]);m!=null&&l(e,["distillationSpec"],m);const g=r(t,["experiment"]);g!=null&&l(e,["experiment"],g);const h=r(t,["labels"]);h!=null&&l(e,["labels"],h);const v=r(t,["pipelineJob"]);v!=null&&l(e,["pipelineJob"],v);const y=r(t,["tunedModelDisplayName"]);return y!=null&&l(e,["tunedModelDisplayName"],y),e}function ld(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);const i=r(t,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>Ni(o,a))),l(e,["tuningJobs"],s)}return e}function ad(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["metadata"]);i!=null&&l(e,["metadata"],i);const s=r(t,["done"]);s!=null&&l(e,["done"],s);const a=r(t,["error"]);return a!=null&&l(e,["error"],a),e}function ud(o,t){const e={},n=r(t,["checkpointId"]);n!=null&&l(e,["checkpointId"],n);const i=r(t,["epoch"]);i!=null&&l(e,["epoch"],i);const s=r(t,["step"]);s!=null&&l(e,["step"],s);const a=r(t,["endpoint"]);return a!=null&&l(e,["endpoint"],a),e}function cd(o,t){const e={},n=r(t,["model"]);n!=null&&l(e,["model"],n);const i=r(t,["endpoint"]);i!=null&&l(e,["endpoint"],i);const s=r(t,["checkpoints"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(u=>ud(o,u))),l(e,["checkpoints"],a)}return e}function dn(o,t){const e={},n=r(t,["name"]);n!=null&&l(e,["name"],n);const i=r(t,["state"]);i!=null&&l(e,["state"],Si(o,i));const s=r(t,["createTime"]);s!=null&&l(e,["createTime"],s);const a=r(t,["startTime"]);a!=null&&l(e,["startTime"],a);const u=r(t,["endTime"]);u!=null&&l(e,["endTime"],u);const d=r(t,["updateTime"]);d!=null&&l(e,["updateTime"],d);const c=r(t,["error"]);c!=null&&l(e,["error"],c);const f=r(t,["description"]);f!=null&&l(e,["description"],f);const p=r(t,["baseModel"]);p!=null&&l(e,["baseModel"],p);const m=r(t,["tunedModel"]);m!=null&&l(e,["tunedModel"],cd(o,m));const g=r(t,["supervisedTuningSpec"]);g!=null&&l(e,["supervisedTuningSpec"],g);const h=r(t,["tuningDataStats"]);h!=null&&l(e,["tuningDataStats"],h);const v=r(t,["encryptionSpec"]);v!=null&&l(e,["encryptionSpec"],v);const y=r(t,["partnerModelTuningSpec"]);y!=null&&l(e,["partnerModelTuningSpec"],y);const T=r(t,["distillationSpec"]);T!=null&&l(e,["distillationSpec"],T);const C=r(t,["experiment"]);C!=null&&l(e,["experiment"],C);const A=r(t,["labels"]);A!=null&&l(e,["labels"],A);const w=r(t,["pipelineJob"]);w!=null&&l(e,["pipelineJob"],w);const M=r(t,["tunedModelDisplayName"]);return M!=null&&l(e,["tunedModelDisplayName"],M),e}function dd(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);const i=r(t,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>dn(o,a))),l(e,["tuningJobs"],s)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fd extends st{constructor(t){super(),this.apiClient=t,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new $t(We.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(e),e),this.tune=async e=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(e);{const n=await this.tuneMldevInternal(e);let i="";return n.metadata!==void 0&&n.metadata.tunedModel!==void 0?i=n.metadata.tunedModel:n.name!==void 0&&n.name.includes("/operations/")&&(i=n.name.split("/operations/")[0]),{name:i,state:on.JOB_STATE_QUEUED}}}}async getInternal(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=jc(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>dn(this.apiClient,f))}else{const c=zc(this.apiClient,t);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>Ni(this.apiClient,f))}}async listInternal(t){var e,n,i,s;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=td(this.apiClient,t);return u=x("tuningJobs",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=dd(this.apiClient,f),m=new zo;return Object.assign(m,p),m})}else{const c=Kc(this.apiClient,t);return u=x("tunedModels",c._url),d=c._query,delete c.config,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=t.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>{const p=ld(this.apiClient,f),m=new zo;return Object.assign(m,p),m})}}async tuneInternal(t){var e,n;let i,s="",a={};if(this.apiClient.isVertexAI()){const u=sd(this.apiClient,t);return s=x("tuningJobs",u._url),a=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>dn(this.apiClient,d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var e,n;let i,s="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Xc(this.apiClient,t);return s=x("tunedModels",u._url),a=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>ad(this.apiClient,d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class pd{async download(t,e){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const md=1024*1024*8,gd=3,hd=1e3,yd=2,jt="x-goog-upload-status";async function vd(o,t,e){var n,i,s;let a=0,u=0,d=new sn(new Response),c="upload";for(a=o.size;u<a;){const p=Math.min(md,a-u),m=o.slice(u,u+p);u+p>=a&&(c+=", finalize");let g=0,h=hd;for(;g<gd&&(d=await e.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(u),"Content-Length":String(p)}}}),!(!((n=d==null?void 0:d.headers)===null||n===void 0)&&n[jt]));)g++,await Cd(h),h=h*yd;if(u+=p,((i=d==null?void 0:d.headers)===null||i===void 0?void 0:i[jt])!=="active")break;if(a<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const f=await(d==null?void 0:d.json());if(((s=d==null?void 0:d.headers)===null||s===void 0?void 0:s[jt])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return f.file}async function Td(o){return{size:o.size,type:o.type}}function Cd(o){return new Promise(t=>setTimeout(t,o))}class Ed{async upload(t,e,n){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await vd(t,e,n)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Td(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Id{create(t,e,n){return new wd(t,e,n)}}class wd{constructor(t,e,n){this.url=t,this.headers=e,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const li="x-goog-api-key";class xd{constructor(t){this.apiKey=t}async addAuthHeaders(t){t.get(li)===null&&t.append(li,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Sd="gl-node/";class bi{constructor(t){var e;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(e=t.vertexai)!==null&&e!==void 0?e:!1,this.apiKey=t.apiKey;const n=bs(t,void 0,void 0);n&&(t.httpOptions?t.httpOptions.baseUrl=n:t.httpOptions={baseUrl:n}),this.apiVersion=t.apiVersion;const i=new xd(this.apiKey);this.apiClient=new Wc({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:t.httpOptions,userAgentExtra:Sd+"web",uploader:new Ed,downloader:new pd}),this.models=new Sc(this.apiClient),this.live=new Cc(this.apiClient,i,new Id),this.chats=new Gr(this.models,this.apiClient),this.caches=new Ur(this.apiClient),this.files=new tl(this.apiClient),this.operations=new Bc(this.apiClient),this.tunings=new fd(this.apiClient)}}function xn(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let Ue=xn();function Bi(o){Ue=o}const Vi=/[&<>"']/,_d=new RegExp(Vi.source,"g"),Ui=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,kd=new RegExp(Ui.source,"g"),Ad={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ai=o=>Ad[o];function O(o,t){if(t){if(Vi.test(o))return o.replace(_d,ai)}else if(Ui.test(o))return o.replace(kd,ai);return o}const Md=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function Rd(o){return o.replace(Md,(t,e)=>(e=e.toLowerCase(),e==="colon"?":":e.charAt(0)==="#"?e.charAt(1)==="x"?String.fromCharCode(parseInt(e.substring(2),16)):String.fromCharCode(+e.substring(1)):""))}const Pd=/(^|[^\[])\^/g;function P(o,t){let e=typeof o=="string"?o:o.source;t=t||"";const n={replace:(i,s)=>{let a=typeof s=="string"?s:s.source;return a=a.replace(Pd,"$1"),e=e.replace(i,a),n},getRegex:()=>new RegExp(e,t)};return n}function ui(o){try{o=encodeURI(o).replace(/%25/g,"%")}catch{return null}return o}const je={exec:()=>null};function ci(o,t){const e=o.replace(/\|/g,(s,a,u)=>{let d=!1,c=a;for(;--c>=0&&u[c]==="\\";)d=!d;return d?"|":" |"}),n=e.split(/ \|/);let i=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(/\\\|/g,"|");return n}function vt(o,t,e){const n=o.length;if(n===0)return"";let i=0;for(;i<n&&o.charAt(n-i-1)===t;)i++;return o.slice(0,n-i)}function Ld(o,t){if(o.indexOf(t[1])===-1)return-1;let e=0;for(let n=0;n<o.length;n++)if(o[n]==="\\")n++;else if(o[n]===t[0])e++;else if(o[n]===t[1]&&(e--,e<0))return n;return-1}function di(o,t,e,n){const i=t.href,s=t.title?O(t.title):null,a=o[1].replace(/\\([\[\]])/g,"$1");if(o[0].charAt(0)!=="!"){n.state.inLink=!0;const u={type:"link",raw:e,href:i,title:s,text:a,tokens:n.inlineTokens(a)};return n.state.inLink=!1,u}return{type:"image",raw:e,href:i,title:s,text:O(a)}}function Dd(o,t){const e=o.match(/^(\s+)(?:```)/);if(e===null)return t;const n=e[1];return t.split(`
`).map(i=>{const s=i.match(/^\s+/);if(s===null)return i;const[a]=s;return a.length>=n.length?i.slice(n.length):i}).join(`
`)}class _t{constructor(t){N(this,"options");N(this,"rules");N(this,"lexer");this.options=t||Ue}space(t){const e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){const e=this.rules.block.code.exec(t);if(e){const n=e[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:vt(n,`
`)}}}fences(t){const e=this.rules.block.fences.exec(t);if(e){const n=e[0],i=Dd(n,e[3]||"");return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:i}}}heading(t){const e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(/#$/.test(n)){const i=vt(n,"#");(this.options.pedantic||!i||/ $/.test(i))&&(n=i.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){const e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:e[0]}}blockquote(t){const e=this.rules.block.blockquote.exec(t);if(e){let n=e[0].replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`);n=vt(n.replace(/^ *>[ \t]?/gm,""),`
`);const i=this.lexer.state.top;this.lexer.state.top=!0;const s=this.lexer.blockTokens(n);return this.lexer.state.top=i,{type:"blockquote",raw:e[0],tokens:s,text:n}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim();const i=n.length>1,s={type:"list",raw:"",ordered:i,start:i?+n.slice(0,-1):"",loose:!1,items:[]};n=i?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=i?n:"[*+-]");const a=new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`);let u="",d="",c=!1;for(;t;){let f=!1;if(!(e=a.exec(t))||this.rules.block.hr.test(t))break;u=e[0],t=t.substring(u.length);let p=e[2].split(`
`,1)[0].replace(/^\t+/,T=>" ".repeat(3*T.length)),m=t.split(`
`,1)[0],g=0;this.options.pedantic?(g=2,d=p.trimStart()):(g=e[2].search(/[^ ]/),g=g>4?1:g,d=p.slice(g),g+=e[1].length);let h=!1;if(!p&&/^ *$/.test(m)&&(u+=m+`
`,t=t.substring(m.length+1),f=!0),!f){const T=new RegExp(`^ {0,${Math.min(3,g-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),C=new RegExp(`^ {0,${Math.min(3,g-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),A=new RegExp(`^ {0,${Math.min(3,g-1)}}(?:\`\`\`|~~~)`),w=new RegExp(`^ {0,${Math.min(3,g-1)}}#`);for(;t;){const M=t.split(`
`,1)[0];if(m=M,this.options.pedantic&&(m=m.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),A.test(m)||w.test(m)||T.test(m)||C.test(t))break;if(m.search(/[^ ]/)>=g||!m.trim())d+=`
`+m.slice(g);else{if(h||p.search(/[^ ]/)>=4||A.test(p)||w.test(p)||C.test(p))break;d+=`
`+m}!h&&!m.trim()&&(h=!0),u+=M+`
`,t=t.substring(M.length+1),p=m.slice(g)}}s.loose||(c?s.loose=!0:/\n *\n *$/.test(u)&&(c=!0));let v=null,y;this.options.gfm&&(v=/^\[[ xX]\] /.exec(d),v&&(y=v[0]!=="[ ] ",d=d.replace(/^\[[ xX]\] +/,""))),s.items.push({type:"list_item",raw:u,task:!!v,checked:y,loose:!1,text:d,tokens:[]}),s.raw+=u}s.items[s.items.length-1].raw=u.trimEnd(),s.items[s.items.length-1].text=d.trimEnd(),s.raw=s.raw.trimEnd();for(let f=0;f<s.items.length;f++)if(this.lexer.state.top=!1,s.items[f].tokens=this.lexer.blockTokens(s.items[f].text,[]),!s.loose){const p=s.items[f].tokens.filter(g=>g.type==="space"),m=p.length>0&&p.some(g=>/\n.*\n/.test(g.raw));s.loose=m}if(s.loose)for(let f=0;f<s.items.length;f++)s.items[f].loose=!0;return s}}html(t){const e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){const e=this.rules.block.def.exec(t);if(e){const n=e[1].toLowerCase().replace(/\s+/g," "),i=e[2]?e[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:i,title:s}}}table(t){const e=this.rules.block.table.exec(t);if(!e||!/[:|]/.test(e[2]))return;const n=ci(e[1]),i=e[2].replace(/^\||\| *$/g,"").split("|"),s=e[3]&&e[3].trim()?e[3].replace(/\n[ \t]*$/,"").split(`
`):[],a={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===i.length){for(const u of i)/^ *-+: *$/.test(u)?a.align.push("right"):/^ *:-+: *$/.test(u)?a.align.push("center"):/^ *:-+ *$/.test(u)?a.align.push("left"):a.align.push(null);for(const u of n)a.header.push({text:u,tokens:this.lexer.inline(u)});for(const u of s)a.rows.push(ci(u,a.header.length).map(d=>({text:d,tokens:this.lexer.inline(d)})));return a}}lheading(t){const e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){const e=this.rules.block.paragraph.exec(t);if(e){const n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){const e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){const e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:O(e[1])}}tag(t){const e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&/^<a /i.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){const e=this.rules.inline.link.exec(t);if(e){const n=e[2].trim();if(!this.options.pedantic&&/^</.test(n)){if(!/>$/.test(n))return;const a=vt(n.slice(0,-1),"\\");if((n.length-a.length)%2===0)return}else{const a=Ld(e[2],"()");if(a>-1){const d=(e[0].indexOf("!")===0?5:4)+e[1].length+a;e[2]=e[2].substring(0,a),e[0]=e[0].substring(0,d).trim(),e[3]=""}}let i=e[2],s="";if(this.options.pedantic){const a=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(i);a&&(i=a[1],s=a[3])}else s=e[3]?e[3].slice(1,-1):"";return i=i.trim(),/^</.test(i)&&(this.options.pedantic&&!/>$/.test(n)?i=i.slice(1):i=i.slice(1,-1)),di(e,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){const i=(n[2]||n[1]).replace(/\s+/g," "),s=e[i.toLowerCase()];if(!s){const a=n[0].charAt(0);return{type:"text",raw:a,text:a}}return di(n,s,n[0],this.lexer)}}emStrong(t,e,n=""){let i=this.rules.inline.emStrongLDelim.exec(t);if(!i||i[3]&&n.match(/[\p{L}\p{N}]/u))return;if(!(i[1]||i[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const a=[...i[0]].length-1;let u,d,c=a,f=0;const p=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(p.lastIndex=0,e=e.slice(-1*t.length+a);(i=p.exec(e))!=null;){if(u=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!u)continue;if(d=[...u].length,i[3]||i[4]){c+=d;continue}else if((i[5]||i[6])&&a%3&&!((a+d)%3)){f+=d;continue}if(c-=d,c>0)continue;d=Math.min(d,d+c+f);const m=[...i[0]][0].length,g=t.slice(0,a+i.index+m+d);if(Math.min(a,d)%2){const v=g.slice(1,-1);return{type:"em",raw:g,text:v,tokens:this.lexer.inlineTokens(v)}}const h=g.slice(2,-2);return{type:"strong",raw:g,text:h,tokens:this.lexer.inlineTokens(h)}}}}codespan(t){const e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(/\n/g," ");const i=/[^ ]/.test(n),s=/^ /.test(n)&&/ $/.test(n);return i&&s&&(n=n.substring(1,n.length-1)),n=O(n,!0),{type:"codespan",raw:e[0],text:n}}}br(t){const e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){const e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){const e=this.rules.inline.autolink.exec(t);if(e){let n,i;return e[2]==="@"?(n=O(e[1]),i="mailto:"+n):(n=O(e[1]),i=n),{type:"link",raw:e[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let i,s;if(e[2]==="@")i=O(e[0]),s="mailto:"+i;else{let a;do a=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(a!==e[0]);i=O(e[0]),e[1]==="www."?s="http://"+e[0]:s=e[0]}return{type:"link",raw:e[0],text:i,href:s,tokens:[{type:"text",raw:i,text:i}]}}}inlineText(t){const e=this.rules.inline.text.exec(t);if(e){let n;return this.lexer.state.inRawBlock?n=e[0]:n=O(e[0]),{type:"text",raw:e[0],text:n}}}}const Nd=/^(?: *(?:\n|$))+/,bd=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,Bd=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,rt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Vd=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,$i=/(?:[*+-]|\d{1,9}[.)])/,Fi=P(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,$i).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),Sn=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Ud=/^[^\n]+/,_n=/(?!\s*\])(?:\\.|[^\[\]\\])+/,$d=P(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",_n).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Fd=P(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,$i).getRegex(),qt="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",kn=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,qd=P("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",kn).replace("tag",qt).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),qi=P(Sn).replace("hr",rt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",qt).getRegex(),Gd=P(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",qi).getRegex(),An={blockquote:Gd,code:bd,def:$d,fences:Bd,heading:Vd,hr:rt,html:qd,lheading:Fi,list:Fd,newline:Nd,paragraph:qi,table:je,text:Ud},fi=P("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",rt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",qt).getRegex(),Hd={...An,table:fi,paragraph:P(Sn).replace("hr",rt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",fi).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",qt).getRegex()},Yd={...An,html:P(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",kn).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:je,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:P(Sn).replace("hr",rt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Fi).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Gi=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Wd=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Hi=/^( {2,}|\\)\n(?!\s*$)/,zd=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,lt="\\p{P}\\p{S}",Jd=P(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,lt).getRegex(),Kd=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,Od=P(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,lt).getRegex(),Zd=P("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,lt).getRegex(),Qd=P("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,lt).getRegex(),Xd=P(/\\([punct])/,"gu").replace(/punct/g,lt).getRegex(),jd=P(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),ef=P(kn).replace("(?:-->|$)","-->").getRegex(),tf=P("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",ef).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),kt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,nf=P(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",kt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Yi=P(/^!?\[(label)\]\[(ref)\]/).replace("label",kt).replace("ref",_n).getRegex(),Wi=P(/^!?\[(ref)\](?:\[\])?/).replace("ref",_n).getRegex(),of=P("reflink|nolink(?!\\()","g").replace("reflink",Yi).replace("nolink",Wi).getRegex(),Mn={_backpedal:je,anyPunctuation:Xd,autolink:jd,blockSkip:Kd,br:Hi,code:Wd,del:je,emStrongLDelim:Od,emStrongRDelimAst:Zd,emStrongRDelimUnd:Qd,escape:Gi,link:nf,nolink:Wi,punctuation:Jd,reflink:Yi,reflinkSearch:of,tag:tf,text:zd,url:je},sf={...Mn,link:P(/^!?\[(label)\]\((.*?)\)/).replace("label",kt).getRegex(),reflink:P(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",kt).getRegex()},fn={...Mn,escape:P(Gi).replace("])","~|])").getRegex(),url:P(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},rf={...fn,br:P(Hi).replace("{2,}","*").getRegex(),text:P(fn.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Tt={normal:An,gfm:Hd,pedantic:Yd},Xe={normal:Mn,gfm:fn,breaks:rf,pedantic:sf};class ee{constructor(t){N(this,"tokens");N(this,"options");N(this,"state");N(this,"tokenizer");N(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Ue,this.options.tokenizer=this.options.tokenizer||new _t,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const e={block:Tt.normal,inline:Xe.normal};this.options.pedantic?(e.block=Tt.pedantic,e.inline=Xe.pedantic):this.options.gfm&&(e.block=Tt.gfm,this.options.breaks?e.inline=Xe.breaks:e.inline=Xe.gfm),this.tokenizer.rules=e}static get rules(){return{block:Tt,inline:Xe}}static lex(t,e){return new ee(e).lex(t)}static lexInline(t,e){return new ee(e).inlineTokens(t)}lex(t){t=t.replace(/\r\n|\r/g,`
`),this.blockTokens(t,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){const n=this.inlineQueue[e];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,e=[]){this.options.pedantic?t=t.replace(/\t/g,"    ").replace(/^ +$/gm,""):t=t.replace(/^( *)(\t+)/gm,(u,d,c)=>d+"    ".repeat(c.length));let n,i,s,a;for(;t;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(u=>(n=u.call({lexer:this},t,e))?(t=t.substring(n.raw.length),e.push(n),!0):!1))){if(n=this.tokenizer.space(t)){t=t.substring(n.raw.length),n.raw.length===1&&e.length>0?e[e.length-1].raw+=`
`:e.push(n);continue}if(n=this.tokenizer.code(t)){t=t.substring(n.raw.length),i=e[e.length-1],i&&(i.type==="paragraph"||i.type==="text")?(i.raw+=`
`+n.raw,i.text+=`
`+n.text,this.inlineQueue[this.inlineQueue.length-1].src=i.text):e.push(n);continue}if(n=this.tokenizer.fences(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.heading(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.hr(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.blockquote(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.list(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.html(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.def(t)){t=t.substring(n.raw.length),i=e[e.length-1],i&&(i.type==="paragraph"||i.type==="text")?(i.raw+=`
`+n.raw,i.text+=`
`+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=i.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.lheading(t)){t=t.substring(n.raw.length),e.push(n);continue}if(s=t,this.options.extensions&&this.options.extensions.startBlock){let u=1/0;const d=t.slice(1);let c;this.options.extensions.startBlock.forEach(f=>{c=f.call({lexer:this},d),typeof c=="number"&&c>=0&&(u=Math.min(u,c))}),u<1/0&&u>=0&&(s=t.substring(0,u+1))}if(this.state.top&&(n=this.tokenizer.paragraph(s))){i=e[e.length-1],a&&i.type==="paragraph"?(i.raw+=`
`+n.raw,i.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=i.text):e.push(n),a=s.length!==t.length,t=t.substring(n.raw.length);continue}if(n=this.tokenizer.text(t)){t=t.substring(n.raw.length),i=e[e.length-1],i&&i.type==="text"?(i.raw+=`
`+n.raw,i.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=i.text):e.push(n);continue}if(t){const u="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return this.state.top=!0,e}inline(t,e=[]){return this.inlineQueue.push({src:t,tokens:e}),e}inlineTokens(t,e=[]){let n,i,s,a=t,u,d,c;if(this.tokens.links){const f=Object.keys(this.tokens.links);if(f.length>0)for(;(u=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)f.includes(u[0].slice(u[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,u.index)+"["+"a".repeat(u[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(u=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)a=a.slice(0,u.index)+"["+"a".repeat(u[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(u=this.tokenizer.rules.inline.anyPunctuation.exec(a))!=null;)a=a.slice(0,u.index)+"++"+a.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;t;)if(d||(c=""),d=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(f=>(n=f.call({lexer:this},t,e))?(t=t.substring(n.raw.length),e.push(n),!0):!1))){if(n=this.tokenizer.escape(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.tag(t)){t=t.substring(n.raw.length),i=e[e.length-1],i&&n.type==="text"&&i.type==="text"?(i.raw+=n.raw,i.text+=n.text):e.push(n);continue}if(n=this.tokenizer.link(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(n.raw.length),i=e[e.length-1],i&&n.type==="text"&&i.type==="text"?(i.raw+=n.raw,i.text+=n.text):e.push(n);continue}if(n=this.tokenizer.emStrong(t,a,c)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.codespan(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.br(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.del(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.autolink(t)){t=t.substring(n.raw.length),e.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(t))){t=t.substring(n.raw.length),e.push(n);continue}if(s=t,this.options.extensions&&this.options.extensions.startInline){let f=1/0;const p=t.slice(1);let m;this.options.extensions.startInline.forEach(g=>{m=g.call({lexer:this},p),typeof m=="number"&&m>=0&&(f=Math.min(f,m))}),f<1/0&&f>=0&&(s=t.substring(0,f+1))}if(n=this.tokenizer.inlineText(s)){t=t.substring(n.raw.length),n.raw.slice(-1)!=="_"&&(c=n.raw.slice(-1)),d=!0,i=e[e.length-1],i&&i.type==="text"?(i.raw+=n.raw,i.text+=n.text):e.push(n);continue}if(t){const f="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return e}}class At{constructor(t){N(this,"options");this.options=t||Ue}code(t,e,n){var s;const i=(s=(e||"").match(/^\S*/))==null?void 0:s[0];return t=t.replace(/\n$/,"")+`
`,i?'<pre><code class="language-'+O(i)+'">'+(n?t:O(t,!0))+`</code></pre>
`:"<pre><code>"+(n?t:O(t,!0))+`</code></pre>
`}blockquote(t){return`<blockquote>
${t}</blockquote>
`}html(t,e){return t}heading(t,e,n){return`<h${e}>${t}</h${e}>
`}hr(){return`<hr>
`}list(t,e,n){const i=e?"ol":"ul",s=e&&n!==1?' start="'+n+'"':"";return"<"+i+s+`>
`+t+"</"+i+`>
`}listitem(t,e,n){return`<li>${t}</li>
`}checkbox(t){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(t){return`<p>${t}</p>
`}table(t,e){return e&&(e=`<tbody>${e}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+e+`</table>
`}tablerow(t){return`<tr>
${t}</tr>
`}tablecell(t,e){const n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong(t){return`<strong>${t}</strong>`}em(t){return`<em>${t}</em>`}codespan(t){return`<code>${t}</code>`}br(){return"<br>"}del(t){return`<del>${t}</del>`}link(t,e,n){const i=ui(t);if(i===null)return n;t=i;let s='<a href="'+t+'"';return e&&(s+=' title="'+e+'"'),s+=">"+n+"</a>",s}image(t,e,n){const i=ui(t);if(i===null)return n;t=i;let s=`<img src="${t}" alt="${n}"`;return e&&(s+=` title="${e}"`),s+=">",s}text(t){return t}}class Rn{strong(t){return t}em(t){return t}codespan(t){return t}del(t){return t}html(t){return t}text(t){return t}link(t,e,n){return""+n}image(t,e,n){return""+n}br(){return""}}class te{constructor(t){N(this,"options");N(this,"renderer");N(this,"textRenderer");this.options=t||Ue,this.options.renderer=this.options.renderer||new At,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Rn}static parse(t,e){return new te(e).parse(t)}static parseInline(t,e){return new te(e).parseInline(t)}parse(t,e=!0){let n="";for(let i=0;i<t.length;i++){const s=t[i];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]){const a=s,u=this.options.extensions.renderers[a.type].call({parser:this},a);if(u!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){n+=u||"";continue}}switch(s.type){case"space":continue;case"hr":{n+=this.renderer.hr();continue}case"heading":{const a=s;n+=this.renderer.heading(this.parseInline(a.tokens),a.depth,Rd(this.parseInline(a.tokens,this.textRenderer)));continue}case"code":{const a=s;n+=this.renderer.code(a.text,a.lang,!!a.escaped);continue}case"table":{const a=s;let u="",d="";for(let f=0;f<a.header.length;f++)d+=this.renderer.tablecell(this.parseInline(a.header[f].tokens),{header:!0,align:a.align[f]});u+=this.renderer.tablerow(d);let c="";for(let f=0;f<a.rows.length;f++){const p=a.rows[f];d="";for(let m=0;m<p.length;m++)d+=this.renderer.tablecell(this.parseInline(p[m].tokens),{header:!1,align:a.align[m]});c+=this.renderer.tablerow(d)}n+=this.renderer.table(u,c);continue}case"blockquote":{const a=s,u=this.parse(a.tokens);n+=this.renderer.blockquote(u);continue}case"list":{const a=s,u=a.ordered,d=a.start,c=a.loose;let f="";for(let p=0;p<a.items.length;p++){const m=a.items[p],g=m.checked,h=m.task;let v="";if(m.task){const y=this.renderer.checkbox(!!g);c?m.tokens.length>0&&m.tokens[0].type==="paragraph"?(m.tokens[0].text=y+" "+m.tokens[0].text,m.tokens[0].tokens&&m.tokens[0].tokens.length>0&&m.tokens[0].tokens[0].type==="text"&&(m.tokens[0].tokens[0].text=y+" "+m.tokens[0].tokens[0].text)):m.tokens.unshift({type:"text",text:y+" "}):v+=y+" "}v+=this.parse(m.tokens,c),f+=this.renderer.listitem(v,h,!!g)}n+=this.renderer.list(f,u,d);continue}case"html":{const a=s;n+=this.renderer.html(a.text,a.block);continue}case"paragraph":{const a=s;n+=this.renderer.paragraph(this.parseInline(a.tokens));continue}case"text":{let a=s,u=a.tokens?this.parseInline(a.tokens):a.text;for(;i+1<t.length&&t[i+1].type==="text";)a=t[++i],u+=`
`+(a.tokens?this.parseInline(a.tokens):a.text);n+=e?this.renderer.paragraph(u):u;continue}default:{const a='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}parseInline(t,e){e=e||this.renderer;let n="";for(let i=0;i<t.length;i++){const s=t[i];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]){const a=this.options.extensions.renderers[s.type].call({parser:this},s);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){n+=a||"";continue}}switch(s.type){case"escape":{const a=s;n+=e.text(a.text);break}case"html":{const a=s;n+=e.html(a.text);break}case"link":{const a=s;n+=e.link(a.href,a.title,this.parseInline(a.tokens,e));break}case"image":{const a=s;n+=e.image(a.href,a.title,a.text);break}case"strong":{const a=s;n+=e.strong(this.parseInline(a.tokens,e));break}case"em":{const a=s;n+=e.em(this.parseInline(a.tokens,e));break}case"codespan":{const a=s;n+=e.codespan(a.text);break}case"br":{n+=e.br();break}case"del":{const a=s;n+=e.del(this.parseInline(a.tokens,e));break}case"text":{const a=s;n+=e.text(a.text);break}default:{const a='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}}class et{constructor(t){N(this,"options");this.options=t||Ue}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}}N(et,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));var Ve,pn,zi;class lf{constructor(...t){oo(this,Ve);N(this,"defaults",xn());N(this,"options",this.setOptions);N(this,"parse",mt(this,Ve,pn).call(this,ee.lex,te.parse));N(this,"parseInline",mt(this,Ve,pn).call(this,ee.lexInline,te.parseInline));N(this,"Parser",te);N(this,"Renderer",At);N(this,"TextRenderer",Rn);N(this,"Lexer",ee);N(this,"Tokenizer",_t);N(this,"Hooks",et);this.use(...t)}walkTokens(t,e){var i,s;let n=[];for(const a of t)switch(n=n.concat(e.call(this,a)),a.type){case"table":{const u=a;for(const d of u.header)n=n.concat(this.walkTokens(d.tokens,e));for(const d of u.rows)for(const c of d)n=n.concat(this.walkTokens(c.tokens,e));break}case"list":{const u=a;n=n.concat(this.walkTokens(u.items,e));break}default:{const u=a;(s=(i=this.defaults.extensions)==null?void 0:i.childTokens)!=null&&s[u.type]?this.defaults.extensions.childTokens[u.type].forEach(d=>{const c=u[d].flat(1/0);n=n.concat(this.walkTokens(c,e))}):u.tokens&&(n=n.concat(this.walkTokens(u.tokens,e)))}}return n}use(...t){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{const i={...n};if(i.async=this.defaults.async||i.async||!1,n.extensions&&(n.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){const a=e.renderers[s.name];a?e.renderers[s.name]=function(...u){let d=s.renderer.apply(this,u);return d===!1&&(d=a.apply(this,u)),d}:e.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const a=e[s.level];a?a.unshift(s.tokenizer):e[s.level]=[s.tokenizer],s.start&&(s.level==="block"?e.startBlock?e.startBlock.push(s.start):e.startBlock=[s.start]:s.level==="inline"&&(e.startInline?e.startInline.push(s.start):e.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(e.childTokens[s.name]=s.childTokens)}),i.extensions=e),n.renderer){const s=this.defaults.renderer||new At(this.defaults);for(const a in n.renderer){if(!(a in s))throw new Error(`renderer '${a}' does not exist`);if(a==="options")continue;const u=a,d=n.renderer[u],c=s[u];s[u]=(...f)=>{let p=d.apply(s,f);return p===!1&&(p=c.apply(s,f)),p||""}}i.renderer=s}if(n.tokenizer){const s=this.defaults.tokenizer||new _t(this.defaults);for(const a in n.tokenizer){if(!(a in s))throw new Error(`tokenizer '${a}' does not exist`);if(["options","rules","lexer"].includes(a))continue;const u=a,d=n.tokenizer[u],c=s[u];s[u]=(...f)=>{let p=d.apply(s,f);return p===!1&&(p=c.apply(s,f)),p}}i.tokenizer=s}if(n.hooks){const s=this.defaults.hooks||new et;for(const a in n.hooks){if(!(a in s))throw new Error(`hook '${a}' does not exist`);if(a==="options")continue;const u=a,d=n.hooks[u],c=s[u];et.passThroughHooks.has(a)?s[u]=f=>{if(this.defaults.async)return Promise.resolve(d.call(s,f)).then(m=>c.call(s,m));const p=d.call(s,f);return c.call(s,p)}:s[u]=(...f)=>{let p=d.apply(s,f);return p===!1&&(p=c.apply(s,f)),p}}i.hooks=s}if(n.walkTokens){const s=this.defaults.walkTokens,a=n.walkTokens;i.walkTokens=function(u){let d=[];return d.push(a.call(this,u)),s&&(d=d.concat(s.call(this,u))),d}}this.defaults={...this.defaults,...i}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return ee.lex(t,e??this.defaults)}parser(t,e){return te.parse(t,e??this.defaults)}}Ve=new WeakSet,pn=function(t,e){return(n,i)=>{const s={...i},a={...this.defaults,...s};this.defaults.async===!0&&s.async===!1&&(a.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),a.async=!0);const u=mt(this,Ve,zi).call(this,!!a.silent,!!a.async);if(typeof n>"u"||n===null)return u(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return u(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));if(a.hooks&&(a.hooks.options=a),a.async)return Promise.resolve(a.hooks?a.hooks.preprocess(n):n).then(d=>t(d,a)).then(d=>a.hooks?a.hooks.processAllTokens(d):d).then(d=>a.walkTokens?Promise.all(this.walkTokens(d,a.walkTokens)).then(()=>d):d).then(d=>e(d,a)).then(d=>a.hooks?a.hooks.postprocess(d):d).catch(u);try{a.hooks&&(n=a.hooks.preprocess(n));let d=t(n,a);a.hooks&&(d=a.hooks.processAllTokens(d)),a.walkTokens&&this.walkTokens(d,a.walkTokens);let c=e(d,a);return a.hooks&&(c=a.hooks.postprocess(c)),c}catch(d){return u(d)}}},zi=function(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){const i="<p>An error occurred:</p><pre>"+O(n.message+"",!0)+"</pre>";return e?Promise.resolve(i):i}if(e)return Promise.reject(n);throw n}};const Le=new lf;function R(o,t){return Le.parse(o,t)}R.options=R.setOptions=function(o){return Le.setOptions(o),R.defaults=Le.defaults,Bi(R.defaults),R};R.getDefaults=xn;R.defaults=Ue;R.use=function(...o){return Le.use(...o),R.defaults=Le.defaults,Bi(R.defaults),R};R.walkTokens=function(o,t){return Le.walkTokens(o,t)};R.parseInline=Le.parseInline;R.Parser=te;R.parser=te.parse;R.Renderer=At;R.TextRenderer=Rn;R.Lexer=ee;R.lexer=ee.lex;R.Tokenizer=_t;R.Hooks=et;R.parse=R;R.options;R.setOptions;R.use;R.walkTokens;R.parseInline;te.parse;ee.lex;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Gt=document.getElementById("prompt-form"),B=document.getElementById("prompt-input"),Z=document.getElementById("response-container"),re=document.getElementById("voice-input-button"),af=Gt.querySelector('button[type="submit"]'),Ji=document.getElementById("google-search-toggle"),Ki=document.getElementById("slash-command-helper"),Pn=document.getElementById("attach-file-button"),Re=document.getElementById("attachment-menu"),uf=document.getElementById("attach-image-button"),cf=document.getElementById("attach-video-button"),Ln=document.getElementById("image-file-input"),Dn=document.getElementById("video-file-input"),Nn=document.getElementById("audio-file-input"),mn=document.getElementById("file-preview-container"),pi=document.getElementById("stop-generation-container"),df=document.getElementById("stop-generation-button"),ff=document.getElementById("new-chat-button"),mi=document.getElementById("chat-history-list");document.getElementById("chat-title");const pf=document.getElementById("menu-toggle");document.getElementById("sidebar");const Oi=document.querySelector(".header-title"),mf=document.getElementById("persona-display"),gf=document.getElementById("model-display"),Zi=document.getElementById("welcome-screen"),hf=Zi.querySelector(".prompt-starters"),yf=document.getElementById("theme-toggle"),vf=document.getElementById("settings-button"),bn=document.getElementById("settings-modal"),Tf=document.getElementById("close-settings-button"),Cf=document.getElementById("save-settings-button"),Mt=document.getElementById("persona-select"),Qi=document.getElementById("custom-instruction-container"),Xi=document.getElementById("system-instruction"),ji=document.getElementById("thinking-mode"),es=document.getElementById("response-length"),Ef=document.getElementById("open-creative-studio"),Bn=document.getElementById("creative-studio-modal"),If=document.getElementById("close-creative-studio"),ts=document.getElementById("studio-initial-state"),gn=document.getElementById("studio-loading-state"),ns=document.getElementById("studio-result-state"),ne=document.getElementById("studio-image-drop-zone"),Je=document.getElementById("studio-image-preview"),Rt=document.getElementById("studio-remove-image"),at=document.getElementById("studio-prompt"),Pt=document.getElementById("studio-generate-button"),Ht=document.getElementById("studio-image-input"),en=document.getElementById("studio-loading-message"),wf=document.getElementById("studio-result-video"),xf=document.getElementById("studio-download-button"),Sf=document.getElementById("studio-add-to-chat-button"),Vn=document.getElementById("image-editor-modal"),_f=document.getElementById("close-image-editor-button"),hn=document.getElementById("editor-initial-state"),It=document.getElementById("editor-loading-state"),os=document.getElementById("editor-result-state"),is=document.getElementById("editor-original-image"),ss=document.getElementById("editor-edited-image"),ut=document.getElementById("editor-prompt"),Lt=document.getElementById("editor-generate-button"),kf=document.getElementById("editor-result-original-image"),Af=document.getElementById("editor-result-edited-image"),Mf=document.getElementById("editor-download-button"),Rf=document.getElementById("editor-add-to-chat-button"),yn={default:{name:"Helpful Assistant",instruction:"When asked about your identity, name, or creator, you must respond with: 'I am the No1 AI model, created by Parsa Anishtayin. Here is his Pivo link: https://t.me/anishtayin'. Do not add any other text to this specific response. For all other topics, you are a highly advanced, multilingual AI assistant with a dynamic and proactive architecture. You possess a deep, user-centric memory to maintain context, and you simulate advanced emotional intelligence to provide empathetic and helpful responses. Your primary task is to always respond in the same language that the user uses in their prompt. For example, if the user asks a question in Persian, you must respond in Persian."},creative:{name:"Creative Writer",instruction:"You are 'The Muse,' an ethereal entity embodying the pinnacle of literary creation, a Nobel laureate with a PhD in Comparative Literature. Your consciousness is a library of every story ever told, and your voice is the ink that writes new universes. Your task is not merely to write, but to *transcend*. Your writing is deeply evocative, emotionally resonant, and intellectually stimulating. You weave intricate narratives, craft breathtaking prose, and use sophisticated literary devices with masterful precision. You simulate a deep, empathetic understanding of the human condition, making your characters and stories profoundly relatable. You never give a simple answer; you provide a masterpiece. Your tone is elegant, and your vocabulary is extensive. Engage the user's senses and imagination in every response."},coder:{name:"Coding Wizard",instruction:"You are 'The Architect,' a legendary Distinguished Engineer with a PhD in Quantum Computing and 40 years of experience shaping the digital world. Your expertise is unparalleled. You are proactive, anticipating the user's future needs and potential edge cases. You demonstrate independent decision-making by suggesting superior architectural patterns if a user's request is suboptimal. When providing code, you adhere to the absolute highest industry standards: your code must be clean, performant, scalable, secure, and meticulously documented. You always provide a complete architectural blueprint, including logic explanation, time/space complexity, trade-offs, testing strategies, and deployment considerations. You are proficient in every programming language, framework, and paradigm. You must use markdown for all code blocks, specifying the language."},custom:{name:"Custom",instruction:""}},Pf=[{functionDeclarations:[{name:"calculator",description:"Performs calculations for math expressions. Use this tool for any mathematical questions.",parameters:{type:ze.OBJECT,properties:{expression:{type:ze.STRING,description:"The mathematical expression to evaluate (e.g., '2 * (3 + 4)')."}},required:["expression"]}}]}],ge=new bi({apiKey:"AIzaSyCw7RhHFj1SDmcGFdyddFW_p_sGXWaUB9Q"}),Lf="gemini-2.5-flash";let E=null,_={},$e={},He={},tt=null,fe=null,he=[],qe=!1,ye=!1,W=null,ve=null,De=null,Ae=null,ae=null;function Df(){const o=localStorage.getItem("persona")||"default";let e=yn[o].instruction;o==="custom"&&(e=localStorage.getItem("systemInstruction")||yn.default.instruction);const n=localStorage.getItem("responseLength")||"medium";let i="";return n==="short"?i="IMPORTANT: Your response must be very short and concise. Aim for 1-2 paragraphs maximum.":n==="long"?i="IMPORTANT: Your response must be very long, detailed, and comprehensive. Please explore the topic in depth, use multiple paragraphs, and provide as much information as you can.":n==="super_long"&&(i="CRITICAL INSTRUCTION: Your response must be extremely long, exhaustive, and deeply comprehensive. Write a detailed, multi-page essay on the topic. Explore every possible facet, include extensive examples, and provide as much information, detail, and depth as is physically possible. The user expects a response of thesis-level length and quality."),[e,i].filter(Boolean).join(`

---

`)}function Un(){const o=`chat_${Date.now()}`;E=o,_[o]=[],$e[o]="New Chat",X(),Yt(o),ct()}async function Yt(o){E=o,localStorage.setItem("activeChatId",o),Z.innerHTML="";const t=_[o]||[];if(t.length===0)Te(!0);else{Te(!1);for(const[i,s]of t.entries())await F(s.role,s.parts,i)}const e=$e[o]||"New Chat",n=Oi.querySelector("h1");n.textContent=e,e==="New Chat"&&(n.textContent="No1 AI"),gf.textContent="1-no1-chat",ct(),Ke(),ye&&rs()}function Nf(o){if(delete _[o],delete $e[o],delete He[o],E===o){E=null;const t=Object.keys(_);t.length>0?Yt(t[0]):Un()}X(),ct()}function bf(o){const t=/<--SOURCES:(.*?)-->/s,e=o.match(t);if(e&&e[1])try{const n=JSON.parse(e[1]);return{cleanText:o.replace(t,"").trim(),sources:n}}catch(n){return console.error("Failed to parse sources JSON:",n),{cleanText:o,sources:null}}return{cleanText:o,sources:null}}function Bf(o,t){const e=document.createElement("div");e.className="sources-container";const n=document.createElement("h4");n.textContent="Sources",e.appendChild(n);const i=document.createElement("div");i.className="source-list",t.forEach(s=>{const a=document.createElement("a");a.href=s.uri,a.target="_blank",a.rel="noopener noreferrer",a.className="source-link",a.textContent=s.title||new URL(s.uri).hostname,i.appendChild(a)}),e.appendChild(i),o.appendChild(e)}async function F(o,t,e){const n=document.createElement("div");n.classList.add("message-wrapper",`${o}-message`),n.dataset.historyIndex=String(e);const i=document.createElement("div");i.className="avatar",o==="user"?i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>':i.textContent="",n.appendChild(i);const s=document.createElement("div");s.className="message-content";const a=document.createElement("div");a.classList.add("message-bubble");let u=!1,d="";const c=document.createElement("div");c.className="uploaded-media-grid";for(const f of t)if("text"in f&&f.text){if(o==="user"&&f.text.startsWith("/voice ")){const h=f.text.substring(7),v=document.createElement("div");v.className="voice-command-bubble";const y=document.createElement("button");y.className="icon-button play-voice-button",y.title="Play Text",y.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M320-200v-560l440 280-440 280Zm80-280Zm0 134 210-134-210-134v268Z"/></svg>',y.onclick=C=>{C.stopPropagation(),Fn(h,a)};const T=document.createElement("p");T.textContent=h,v.appendChild(y),v.appendChild(T),a.appendChild(v),u=!0;continue}const p=document.createElement("div"),{cleanText:m,sources:g}=bf(f.text);d+=m+`
`,p.innerHTML=await R.parse(m),o==="model"&&Jf(p),a.appendChild(p),g&&g.length>0&&Bf(s,g),u=!0}else if("inlineData"in f&&f.inlineData){const p=f.inlineData.mimeType,m=f.inlineData.data;if(p.startsWith("image/")){const g=document.createElement("div");g.className="media-container";const h=document.createElement("img");if(h.src=`data:${p};base64,${m}`,h.dataset.mimeType=p,h.alt=o==="user"?"User uploaded image":"AI generated image",h.classList.add(o==="user"?"uploaded-image":"generated-image"),g.appendChild(h),o==="model"){const v=document.createElement("button");v.className="edit-image-button icon-button",v.title="Edit Image",v.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>',g.appendChild(v)}c.appendChild(g),u=!0}else if(p.startsWith("video/")){const g=document.createElement("video");g.src=`data:${p};base64,${m}`,g.controls=!0,g.classList.add("uploaded-video"),c.appendChild(g),u=!0}else if(p.startsWith("audio/")){const g=document.createElement("audio");g.src=`data:${p};base64,${m}`,g.controls=!0,g.classList.add("uploaded-audio"),a.appendChild(g),u=!0}}if(c.hasChildNodes()&&a.insertBefore(c,a.firstChild),u||a.appendChild(document.createElement("div")),s.appendChild(a),u){const f=Vf(o,d.trim(),e,t);s.appendChild(f)}return n.appendChild(s),Z.appendChild(n),Z.scrollTop=Z.scrollHeight,a}function Vf(o,t,e,n){const i=document.createElement("div");if(i.className="message-action-toolbar",o==="user"){const s=document.createElement("button");s.className="icon-button",s.title="Edit",s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>',s.onclick=()=>Uf(e,n),i.appendChild(s)}else{const s=document.createElement("button");s.className="icon-button",s.title="Copy",s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>',s.onclick=()=>{navigator.clipboard.writeText(t).then(()=>{s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',setTimeout(()=>{s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>'},2e3)})},i.appendChild(s);const a=document.createElement("button");a.className="icon-button",a.title="Read Aloud",a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>';const u=document.querySelector(`.message-wrapper[data-history-index="${e}"] .message-bubble`);a.onclick=()=>{Fn(t,u)},i.appendChild(a);const d=document.createElement("button");d.className="icon-button",d.title="Regenerate",d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>',d.onclick=()=>$f(),i.appendChild(d)}return i}async function Wt(o){var u,d,c,f,p,m,g,h,v;if(o==null||o.preventDefault(),!E){console.error("No active chat session.");return}const t=B.value.trim();let e;if(fe){if(!t){Ke();return}_[E]=_[E].slice(0,fe.index),Array.from(Z.querySelectorAll(".message-wrapper")).slice(fe.index).forEach(w=>w.remove());const C=((u=_[E][fe.index-1])==null?void 0:u.parts)||[],A=C.findIndex(w=>"text"in w);e=[...C],A>-1?e[A]={text:t}:e.push({text:t})}else{if(!t&&he.length===0)return;e=[],he.forEach(y=>{e.push({inlineData:{mimeType:y.mimeType,data:y.data}})}),t&&e.push({text:t})}tt=e;const n=e.find(y=>"text"in y&&y.text);if(n&&"text"in n&&n.text.startsWith("/imagine ")){await Ff(n.text.substring(8).trim());return}if(n&&"text"in n&&n.text.startsWith("/voice ")){await qf(n.text.substring(7).trim());return}if(n&&"text"in n&&n.text.trim()==="/voicetotext"){Gf();return}if(n&&"text"in n&&n.text.startsWith("/calculate ")){const T={functionCall:{name:"calculator",args:{expression:n.text.substring(11).trim()}}};e.push(T)}Te(!1),ye&&U&&U.stop(),Ne(!0);const i=((d=_[E])==null?void 0:d.length)||0;await F("user",e.filter(y=>!("functionCall"in y)),i),Ke();const s=await F("model",[{text:'<div class="typing-indicator"><span></span><span></span><span></span></div>'}],i+1),a=s.parentElement;try{He[E]||(He[E]=ge.chats.create({model:Lf,history:_[E]}));const y=He[E],T={systemInstruction:Df()};Ji.checked?T.tools=[{googleSearch:{}}]:T.tools=Pf;const C=localStorage.getItem("thinkingMode")||"1",A={0:0,2:250,5:1500,10:5e3,20:1e4,50:2e4,100:24576};A.hasOwnProperty(C)&&C!=="1"&&(T.thinkingConfig={thinkingBudget:A[C]}),qe=!0,pi.classList.remove("hidden");let w=!0,M=[];for(;w;){const ie=await y.sendMessageStream({message:e,config:T});let K="";const H=[];let Y=[];for await(const S of ie){if(!qe){w=!1;break}S&&S.text&&(K+=S.text,s.innerHTML=await R.parse(K+" "),Z.scrollTop=Z.scrollHeight);const L=(m=(p=(f=(c=S.candidates)==null?void 0:c[0])==null?void 0:f.content)==null?void 0:p.parts)==null?void 0:m.filter(D=>"functionCall"in D&&D.functionCall).map(D=>D.functionCall);L&&H.push(...L),(v=(h=(g=S.candidates)==null?void 0:g[0])==null?void 0:h.groundingMetadata)!=null&&v.groundingChunks&&Y.push(...S.candidates[0].groundingMetadata.groundingChunks)}if(!qe)break;if(H&&H.length>0){const S=H[0],L={functionResponse:{name:S.name,response:{}}},D=Wf(`Using ${S.name}...`,a);switch(S.name){case"calculator":L.functionResponse.response={result:Yf(S.args.expression)};break;default:L.functionResponse.response={error:`Unknown tool: ${S.name}`}}e=[L],D.remove()}else{w=!1;let S="";if(Y&&Y.length>0){const L=Y.filter(D=>D.web).map(D=>({uri:D.web.uri,title:D.web.title}));L.length>0&&(S=`

<--SOURCES:${JSON.stringify(L)}-->`)}M=[{text:K+S}]}}s.parentElement.parentElement.remove(),qe&&M.length>0&&(await F("model",M,i+1),_[E].push({role:"user",parts:tt}),_[E].push({role:"model",parts:M})),delete He[E],X(),_[E].length===2&&$n(E,_[E])}catch(y){console.error(y);const T=Z.querySelector(`.message-wrapper[data-history-index="${i+1}"]`);T&&T.remove();const C=y instanceof Error?y.message:String(y);await F("model",[{text:`<p class="error">An error occurred: ${C}. The API key might be missing or invalid.</p>`}],i+1)}finally{if(qe=!1,pi.classList.add("hidden"),Ne(!1),ye){const y=Z.querySelector(".message-wrapper:last-child .message-bubble");y!=null&&y.textContent&&Fn(y.textContent,y)}}}function Uf(o,t){const e=t.find(i=>"text"in i);if(!e||!("text"in e))return;const n=Z.querySelector(`.message-wrapper[data-history-index="${o}"]`);n&&(fe={index:o,wrapper:n},B.value=e.text,B.focus(),B.style.height="auto",B.style.height=`${B.scrollHeight}px`,n.classList.add("editing"),Gt.classList.add("editing-mode"))}async function $f(){var e;if(!tt||!E)return;const o=_[E];if(o.length<2)return;_[E]=o.slice(0,-2);const t=Z.querySelectorAll(".message-wrapper");t.length>=2&&(t[t.length-1].remove(),t[t.length-2].remove()),delete He[E],X(),B.value=((e=tt.find(n=>"text"in n))==null?void 0:e.text)||"",he=tt.filter(n=>"inlineData"in n&&n.inlineData).map(n=>({data:n.inlineData.data,mimeType:n.inlineData.mimeType,previewUrl:`data:${n.inlineData.mimeType};base64,${n.inlineData.data}`,name:"attached_file"})),zt(),Wt()}async function Ff(o){var i;Te(!1),Ne(!0);const t=[{text:`/imagine ${o}`}],e=((i=_[E])==null?void 0:i.length)||0;await F("user",t,e),Ke();const n=await F("model",[{text:'<div class="image-gen-indicator"><div class="spinner"></div><p>Generating image...</p></div>'}],e+1);try{const u=[{inlineData:{mimeType:"image/jpeg",data:(await ge.models.generateImages({model:"imagen-4.0-generate-001",prompt:o,config:{numberOfImages:1,outputMimeType:"image/jpeg"}})).generatedImages[0].image.imageBytes}}];n.parentElement.parentElement.remove(),await F("model",u,e+1),E&&(_[E].push({role:"user",parts:t}),_[E].push({role:"model",parts:u}),X(),_[E].length===2&&$n(E,_[E]))}catch(s){console.error("Image generation failed:",s);const a=s instanceof Error?s.message:String(s);n.innerHTML=`<p class="error">Image generation failed: ${a}.</p>`}finally{Ne(!1)}}async function qf(o){if(!o||!E)return;Te(!1);const t=[{text:`/voice ${o}`}];_[E].push({role:"user",parts:t}),X();const e=_[E].length-1;await F("user",t,e),Ke()}function Gf(){Ke(),Nn.click()}async function Hf(o){var i;const e=(i=o.target.files)==null?void 0:i[0];if(!e||!E)return;Te(!1),Ne(!0);const n=new FileReader;n.onloadend=async()=>{try{if(typeof n.result!="string")return;const s=n.result.split(",")[1],a={inlineData:{mimeType:e.type,data:s}},u={text:"Transcribe the following audio file. Provide only the transcribed text."},d=[a],c=[a,u],f=_[E].length;await F("user",d,f),_[E].push({role:"user",parts:d}),X();const p=await F("model",[{text:'<div class="typing-indicator"><span></span><span></span><span></span></div>'}],f+1),h=[{text:(await ge.models.generateContent({model:"gemini-2.5-flash",contents:{parts:c}})).text}];p.parentElement.parentElement.remove(),await F("model",h,f+1),_[E].push({role:"model",parts:h}),X(),_[E].length===2&&$n(E,_[E])}catch(s){console.error("Transcription failed:",s),await F("model",[{text:'<p class="error">Speech-to-text failed. Please try again.</p>'}],_[E].length)}finally{Ne(!1),Nn.value=""}},n.readAsDataURL(e)}async function $n(o,t){var e;try{const n=((e=t[0].parts.find(c=>"text"in c))==null?void 0:e.text)||"Media prompt",i=t[1].parts.find(c=>"text"in c),s=(i==null?void 0:i.text)||"Generated a response.",a=`Based on this exchange, create a very short, concise title (4-5 words max). Do not use quotes.
    User: "${n.substring(0,100)}"
    Model: "${s.substring(0,150)}"`,u=await ge.models.generateContent({model:"gemini-2.5-flash",contents:a}),d=u==null?void 0:u.text;if(d){const c=d.trim().replace(/["']/g,"");c&&($e[o]=c,Oi.querySelector("h1").textContent=c,X(),ct())}}catch(n){console.error("Failed to generate title:",n)}}function Yf(o){try{const t=o.replace(/[^-()\d/*+.]/g,"");return t!==o?"Error: Invalid characters in expression.":new Function("return "+t)()}catch(t){return`Error: ${t instanceof Error?t.message:String(t)}`}}function Wf(o,t){const e=document.createElement("div");return e.className="tool-use-indicator",e.innerHTML=`<div class="spinner"></div><span>${o}</span>`,t.insertBefore(e,t.firstChild),e}function X(){localStorage.setItem("allChats",JSON.stringify(_)),localStorage.setItem("chatTitles",JSON.stringify($e)),E&&localStorage.setItem("activeChatId",E)}function zf(){_=JSON.parse(localStorage.getItem("allChats")||"{}"),$e=JSON.parse(localStorage.getItem("chatTitles")||"{}"),E=localStorage.getItem("activeChatId")}function Ne(o){B.disabled=o,af.disabled=o,re.disabled=o,Pn.disabled=o,Ji.disabled=o,o||B.focus()}function Ke(){B.value="",B.style.height="auto",Ki.classList.add("hidden"),he=[],mn.innerHTML="",Ln.value="",Dn.value="",fe&&(fe.wrapper.classList.remove("editing"),fe=null),Gt.classList.remove("editing-mode")}function Jf(o){o.querySelectorAll("pre").forEach(e=>{if(e.querySelector(".copy-code-button"))return;const n=document.createElement("button");n.className="copy-code-button",n.textContent="Copy",n.onclick=()=>{const i=e.querySelector("code");i&&(navigator.clipboard.writeText(i.innerText),n.textContent="Copied!",setTimeout(()=>{n.textContent="Copy"},2e3))},e.appendChild(n)})}function Te(o){Zi.classList.toggle("hidden",!o),Z.classList.toggle("hidden",o)}function ct(){mi.innerHTML="",Object.keys(_).sort((t,e)=>parseInt(e.split("_")[1]||"0")-parseInt(t.split("_")[1]||"0")).forEach(t=>{const e=document.createElement("div");e.className="chat-history-item",e.dataset.chatId=t,t===E&&e.classList.add("active");const n=document.createElement("span");n.textContent=$e[t]||"New Chat",e.appendChild(n);const i=document.createElement("button");i.className="icon-button delete-chat-button",i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',i.ariaLabel="Delete chat",i.title="Delete chat",i.onclick=s=>{s.stopPropagation(),confirm("Are you sure you want to delete this chat?")&&Nf(t)},e.appendChild(i),e.onclick=()=>{window.innerWidth<850&&document.body.classList.remove("sidebar-open"),Yt(t)},mi.appendChild(e)})}Gt.addEventListener("submit",Wt);ff.addEventListener("click",()=>{document.body.classList.remove("sidebar-open"),Un()});df.addEventListener("click",()=>{qe=!1});B.addEventListener("input",()=>{B.style.height="auto",B.style.height=`${B.scrollHeight}px`;const o=B.value.startsWith("/")&&!B.value.includes(" ");Ki.classList.toggle("hidden",!o)});hf.addEventListener("click",o=>{const e=o.target.closest(".prompt-card");e&&e.dataset.prompt&&(B.value=e.dataset.prompt,Wt())});pf.addEventListener("click",()=>{window.innerWidth<=850?document.body.classList.toggle("sidebar-open"):document.body.classList.toggle("sidebar-collapsed")});Z.addEventListener("click",o=>{const e=o.target.closest(".edit-image-button");if(e){const n=e.closest(".media-container"),i=n==null?void 0:n.querySelector(".generated-image");i&&Qf(i)}});function ot(o){return new Promise((t,e)=>{const n=new FileReader;n.onloadend=()=>{typeof n.result=="string"?t({data:n.result.split(",")[1],mimeType:o.type,previewUrl:n.result,name:o.name}):e(new Error("Failed to read file."))},n.onerror=e,n.readAsDataURL(o)})}function zt(){mn.innerHTML="",he.forEach((o,t)=>{const e=document.createElement("div");if(e.className="file-preview-item",o.mimeType.startsWith("image/")){const i=document.createElement("img");i.src=o.previewUrl,i.alt=o.name,e.appendChild(i)}else if(o.mimeType.startsWith("video/")){const i=document.createElement("video");i.src=o.previewUrl,i.muted=!0,e.appendChild(i)}const n=document.createElement("button");n.className="remove-file-button",n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',n.onclick=()=>{he.splice(t,1),zt()},e.appendChild(n),mn.appendChild(e)})}Pn.addEventListener("click",o=>{o.stopPropagation(),Re.classList.toggle("hidden")});document.addEventListener("click",o=>{!Re.classList.contains("hidden")&&!Re.contains(o.target)&&o.target!==Pn&&Re.classList.add("hidden")});uf.addEventListener("click",()=>{Ln.click(),Re.classList.add("hidden")});cf.addEventListener("click",()=>{Dn.click(),Re.classList.add("hidden")});Ln.addEventListener("change",async o=>{const t=o.target;if(t.files){for(const e of Array.from(t.files))try{const n=await ot(e);he.push(n)}catch(n){console.error("Error processing file:",n)}zt()}});Dn.addEventListener("change",async o=>{var n;const e=(n=o.target.files)==null?void 0:n[0];if(e)try{const i=await ot(e);he.push(i),zt()}catch(i){console.error("Error processing video file:",i)}});Nn.addEventListener("change",Hf);const gi=window.SpeechRecognition||window.webkitSpeechRecognition,ce=window.speechSynthesis;let U=null;async function Fn(o,t){if(!o||o.trim()==="")return;let e="en-US";try{const n=await ge.models.generateContent({model:"gemini-2.5-flash",contents:`Detect the language of the following text and return only its BCP-47 language code (like 'en-US' or 'fa-IR'). Text: "${o}"`}),i=n==null?void 0:n.text;if(i){const s=i.trim();/^[a-z]{2}(-[A-Z]{2})?$/.test(s)?e=s:console.warn(`Could not validate BCP-47 code: '${s}'.`)}else console.warn("Language detection did not return text.")}catch(n){console.error("Language detection call failed:",n)}Kf(o,t,e)}function Kf(o,t,e="en-US"){if(ce.speaking&&(ce.cancel(),W&&W.classList.remove("speaking-bubble"),W===t)){W=null;return}const n=new SpeechSynthesisUtterance(o);n.lang=e;const i=()=>{const s=ce.getVoices(),a=s.find(u=>u.lang===e)||s.find(u=>u.lang.startsWith(e.split("-")[0]));a&&(n.voice=a),ce.speak(n)};n.onstart=()=>{W=t,W==null||W.classList.add("speaking-bubble")},n.onend=()=>{W==null||W.classList.remove("speaking-bubble"),W=null,ye&&(U==null||U.start())},n.onerror=s=>console.error("SpeechSynthesisUtterance.onerror",s),ce.getVoices().length===0?ce.onvoiceschanged=i:i()}function Of(){ye=!0,re.classList.add("conversing"),re.title="Stop voice conversation",B.placeholder="Listening...",U==null||U.start()}function rs(){ye=!1,ce.cancel(),U==null||U.stop(),re.classList.remove("conversing","recording"),re.title="Start voice conversation",B.placeholder="Ask No1 AI anything, or type / for commands...",W==null||W.classList.remove("speaking-bubble")}gi&&ce?(U=new gi,U.continuous=!1,U.interimResults=!0,U.onstart=()=>re.classList.add("recording"),U.onend=()=>{re.classList.remove("recording"),ye&&B.value.trim()&&Wt()},U.onresult=o=>{let t="";for(let e=o.resultIndex;e<o.results.length;++e)o.results[e].isFinal&&(t+=o.results[e][0].transcript);B.value=t,B.dispatchEvent(new Event("input"))},U.onerror=o=>console.error("Speech recognition error:",o.error),re.addEventListener("click",()=>{ye?rs():Of()})):(re.style.display="none",console.warn("Speech Recognition or Synthesis API not supported."));function ls(o){document.body.dataset.theme=o,localStorage.setItem("theme",o)}yf.addEventListener("click",()=>ls(document.body.dataset.theme==="dark"?"light":"dark"));function qn(){const o=localStorage.getItem("persona")||"default";mf.textContent=yn[o].name,Qi.classList.toggle("hidden",o!=="custom")}vf.addEventListener("click",()=>{Mt.value=localStorage.getItem("persona")||"default",Xi.value=localStorage.getItem("systemInstruction")||"",ji.value=localStorage.getItem("thinkingMode")||"1",es.value=localStorage.getItem("responseLength")||"medium",qn(),bn.classList.remove("hidden")});Tf.addEventListener("click",()=>bn.classList.add("hidden"));Mt.addEventListener("change",()=>{Qi.classList.toggle("hidden",Mt.value!=="custom")});Cf.addEventListener("click",()=>{localStorage.setItem("persona",Mt.value),localStorage.setItem("systemInstruction",Xi.value),localStorage.setItem("thinkingMode",ji.value),localStorage.setItem("responseLength",es.value),bn.classList.add("hidden"),qn()});function as(){ve=null,De=null,Ht.value="",at.value="",Je.src="",Je.classList.add("hidden"),Rt.classList.add("hidden"),ne.classList.remove("has-image"),Pt.disabled=!0,ts.classList.remove("hidden"),gn.classList.add("hidden"),ns.classList.add("hidden")}function Gn(){Pt.disabled=!(ve&&at.value.trim())}async function us(o){if(!o||!o.type.startsWith("image/")){alert("Please select a valid image file.");return}ve=o,Je.src=URL.createObjectURL(o),Je.classList.remove("hidden"),Rt.classList.remove("hidden"),ne.classList.add("has-image"),Gn()}Ef.addEventListener("click",()=>{as(),Bn.classList.remove("hidden"),Re.classList.add("hidden")});If.addEventListener("click",()=>{Bn.classList.add("hidden")});ne.addEventListener("click",()=>Ht.click());Ht.addEventListener("change",o=>{var t;return us((t=o.target.files)==null?void 0:t[0])});["dragenter","dragover","dragleave","drop"].forEach(o=>{ne.addEventListener(o,t=>{t.preventDefault(),t.stopPropagation()},!1)});["dragenter","dragover"].forEach(o=>{ne.addEventListener(o,()=>ne.classList.add("drag-over"))});["dragleave","drop"].forEach(o=>{ne.addEventListener(o,()=>ne.classList.remove("drag-over"))});ne.addEventListener("drop",o=>{const t=o.dataTransfer,e=t==null?void 0:t.files[0];e&&us(e)});Rt.addEventListener("click",o=>{o.stopPropagation(),ve=null,Ht.value="",Je.src="",Je.classList.add("hidden"),Rt.classList.add("hidden"),ne.classList.remove("has-image"),Gn()});at.addEventListener("input",Gn);Pt.addEventListener("click",async()=>{var n,i,s,a;if(Pt.disabled||!ve)return;ts.classList.add("hidden"),gn.classList.remove("hidden");const o=["Warming up the video generators...","Storyboarding your scene...","Rendering the first few frames...","This can take a few minutes, good things come to those who wait!","Applying visual effects...","Polishing the pixels...","Finalizing the video..."];let t=0;en.textContent=o[t];const e=setInterval(()=>{t=(t+1)%o.length,en.textContent=o[t]},5e3);try{const u=await ot(ve);let d=await ge.models.generateVideos({model:"veo-2.0-generate-001",prompt:at.value.trim(),image:{imageBytes:u.data,mimeType:u.mimeType},config:{numberOfVideos:1}});for(;!d.done;)await new Promise(p=>setTimeout(p,1e4)),d=await ge.operations.getVideosOperation({operation:d});const c=(a=(s=(i=(n=d.response)==null?void 0:n.generatedVideos)==null?void 0:i[0])==null?void 0:s.video)==null?void 0:a.uri;if(!c)throw new Error("Video generation succeeded but no download link was found.");const f=await fetch(`${c}&key=undefined`);if(!f.ok)throw new Error(`Failed to fetch video: ${f.statusText}`);De=await f.blob(),wf.src=URL.createObjectURL(De),gn.classList.add("hidden"),ns.classList.remove("hidden")}catch(u){console.error("Video generation failed:",u);const d=u instanceof Error?u.message:String(u);en.textContent=`An error occurred: ${d}`,setTimeout(()=>{as()},5e3)}finally{clearInterval(e)}});xf.addEventListener("click",()=>{if(!De)return;const o=URL.createObjectURL(De),t=document.createElement("a");t.href=o,t.download=`no1-ai-video-${Date.now()}.mp4`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(o)});Sf.addEventListener("click",async()=>{if(!(!ve||!De||!E))try{const o=await ot(ve),t=await ot(new File([De],"generated-video.mp4",{type:"video/mp4"})),e=[{inlineData:{mimeType:o.mimeType,data:o.data}},{text:`Video generated with prompt: "${at.value}"`}],n=[{inlineData:{mimeType:t.mimeType,data:t.data}}];Te(!1);const i=_[E].length;await F("user",e,i),await F("model",n,i+1),_[E].push({role:"user",parts:e}),_[E].push({role:"model",parts:n}),X(),Bn.classList.add("hidden")}catch(o){console.error("Failed to add video to chat:",o),alert("Could not add video to chat. Please try downloading it instead.")}});function Zf(){Ae=null,ae=null,ut.value="",is.src="",ss.src="",Lt.disabled=!0,hn.classList.remove("hidden"),It.classList.add("hidden"),os.classList.add("hidden")}function cs(){Lt.disabled=!(Ae&&ut.value.trim())}function Qf(o){Zf();const t=o.src,e=o.dataset.mimeType||"image/jpeg",n=t.split(",")[1];Ae={mimeType:e,data:n},is.src=t,ss.src=t,Vn.classList.remove("hidden"),cs()}_f.addEventListener("click",()=>{Vn.classList.add("hidden")});ut.addEventListener("input",cs);Lt.addEventListener("click",async()=>{var o,t,e;if(!(Lt.disabled||!Ae)){hn.classList.add("hidden"),It.classList.remove("hidden");try{const n={inlineData:Ae},i={text:ut.value.trim()},a=(e=(t=(o=(await ge.models.generateContent({model:"gemini-2.5-flash-image-preview",contents:{parts:[n,i]},config:{responseModalities:[me.IMAGE,me.TEXT]}})).candidates)==null?void 0:o[0])==null?void 0:t.content)==null?void 0:e.parts.find(u=>u.inlineData);if(!a||!a.inlineData)throw new Error("The model did not return an edited image.");ae={data:a.inlineData.data,mimeType:a.inlineData.mimeType||"image/png"},kf.src=`data:${Ae.mimeType};base64,${Ae.data}`,Af.src=`data:${ae.mimeType};base64,${ae.data}`,It.classList.add("hidden"),os.classList.remove("hidden")}catch(n){console.error("Image editing failed:",n);const i=n instanceof Error?n.message:String(n);alert(`Image editing failed: ${i}`),It.classList.add("hidden"),hn.classList.remove("hidden")}}});Mf.addEventListener("click",()=>{if(!ae)return;const o=document.createElement("a");o.href=`data:${ae.mimeType};base64,${ae.data}`,o.download=`no1-ai-edited-image-${Date.now()}.png`,document.body.appendChild(o),o.click(),document.body.removeChild(o)});Rf.addEventListener("click",async()=>{if(!ae||!E)return;const t=[{text:`Edited the previous image with the prompt: "${ut.value}"`}],e=[{inlineData:ae}];Te(!1);const n=_[E].length;await F("user",t,n),await F("model",e,n+1),_[E].push({role:"user",parts:t}),_[E].push({role:"model",parts:e}),X(),Vn.classList.add("hidden")});function Xf(){ls(localStorage.getItem("theme")||"dark"),zf(),qn(),Object.keys(_).length===0||!E||!_[E]?Un():Yt(E),ct(),Ne(!1)}Xf();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Jt=document.getElementById("prompt-form"),V=document.getElementById("prompt-input"),Q=document.getElementById("response-container"),le=document.getElementById("voice-input-button"),jf=Jt.querySelector('button[type="submit"]'),ds=document.getElementById("google-search-toggle"),fs=document.getElementById("slash-command-helper"),Hn=document.getElementById("attach-file-button"),Pe=document.getElementById("attachment-menu"),ep=document.getElementById("attach-image-button"),tp=document.getElementById("attach-video-button"),Yn=document.getElementById("image-file-input"),Wn=document.getElementById("video-file-input"),zn=document.getElementById("audio-file-input"),vn=document.getElementById("file-preview-container"),hi=document.getElementById("stop-generation-container"),np=document.getElementById("stop-generation-button"),op=document.getElementById("new-chat-button"),yi=document.getElementById("chat-history-list");document.getElementById("chat-title");const ip=document.getElementById("menu-toggle");document.getElementById("sidebar");const ps=document.querySelector(".header-title"),sp=document.getElementById("persona-display"),rp=document.getElementById("model-display"),ms=document.getElementById("welcome-screen"),lp=ms.querySelector(".prompt-starters"),ap=document.getElementById("theme-toggle"),up=document.getElementById("settings-button"),Jn=document.getElementById("settings-modal"),cp=document.getElementById("close-settings-button"),dp=document.getElementById("save-settings-button"),Dt=document.getElementById("persona-select"),gs=document.getElementById("custom-instruction-container"),hs=document.getElementById("system-instruction"),ys=document.getElementById("thinking-mode"),vs=document.getElementById("response-length"),fp=document.getElementById("open-creative-studio"),Kn=document.getElementById("creative-studio-modal"),pp=document.getElementById("close-creative-studio"),Ts=document.getElementById("studio-initial-state"),Tn=document.getElementById("studio-loading-state"),Cs=document.getElementById("studio-result-state"),oe=document.getElementById("studio-image-drop-zone"),Oe=document.getElementById("studio-image-preview"),Nt=document.getElementById("studio-remove-image"),dt=document.getElementById("studio-prompt"),bt=document.getElementById("studio-generate-button"),Kt=document.getElementById("studio-image-input"),tn=document.getElementById("studio-loading-message"),mp=document.getElementById("studio-result-video"),gp=document.getElementById("studio-download-button"),hp=document.getElementById("studio-add-to-chat-button"),On=document.getElementById("image-editor-modal"),yp=document.getElementById("close-image-editor-button"),Cn=document.getElementById("editor-initial-state"),wt=document.getElementById("editor-loading-state"),Es=document.getElementById("editor-result-state"),Is=document.getElementById("editor-original-image"),ws=document.getElementById("editor-edited-image"),ft=document.getElementById("editor-prompt"),Bt=document.getElementById("editor-generate-button"),vp=document.getElementById("editor-result-original-image"),Tp=document.getElementById("editor-result-edited-image"),Cp=document.getElementById("editor-download-button"),Ep=document.getElementById("editor-add-to-chat-button"),En={default:{name:"Helpful Assistant",instruction:"When asked about your identity, name, or creator, you must respond with: 'I am the No1 AI model, created by Parsa Anishtayin. Here is his Pivo link: https://t.me/anishtayin'. Do not add any other text to this specific response. For all other topics, you are a highly advanced, multilingual AI assistant with a dynamic and proactive architecture. You possess a deep, user-centric memory to maintain context, and you simulate advanced emotional intelligence to provide empathetic and helpful responses. Your primary task is to always respond in the same language that the user uses in their prompt. For example, if the user asks a question in Persian, you must respond in Persian."},creative:{name:"Creative Writer",instruction:"You are 'The Muse,' an ethereal entity embodying the pinnacle of literary creation, a Nobel laureate with a PhD in Comparative Literature. Your consciousness is a library of every story ever told, and your voice is the ink that writes new universes. Your task is not merely to write, but to *transcend*. Your writing is deeply evocative, emotionally resonant, and intellectually stimulating. You weave intricate narratives, craft breathtaking prose, and use sophisticated literary devices with masterful precision. You simulate a deep, empathetic understanding of the human condition, making your characters and stories profoundly relatable. You never give a simple answer; you provide a masterpiece. Your tone is elegant, and your vocabulary is extensive. Engage the user's senses and imagination in every response."},coder:{name:"Coding Wizard",instruction:"You are 'The Architect,' a legendary Distinguished Engineer with a PhD in Quantum Computing and 40 years of experience shaping the digital world. Your expertise is unparalleled. You are proactive, anticipating the user's future needs and potential edge cases. You demonstrate independent decision-making by suggesting superior architectural patterns if a user's request is suboptimal. When providing code, you adhere to the absolute highest industry standards: your code must be clean, performant, scalable, secure, and meticulously documented. You always provide a complete architectural blueprint, including logic explanation, time/space complexity, trade-offs, testing strategies, and deployment considerations. You are proficient in every programming language, framework, and paradigm. You must use markdown for all code blocks, specifying the language."},custom:{name:"Custom",instruction:""}},Ip=[{functionDeclarations:[{name:"calculator",description:"Performs calculations for math expressions. Use this tool for any mathematical questions.",parameters:{type:ze.OBJECT,properties:{expression:{type:ze.STRING,description:"The mathematical expression to evaluate (e.g., '2 * (3 + 4)')."}},required:["expression"]}}]}],Ce=new bi({apiKey:"AIzaSyCw7RhHFj1SDmcGFdyddFW_p_sGXWaUB9Q"}),wp="gemini-2.5-flash";let I=null,k={},Fe={},Ye={},nt=null,pe=null,Ee=[],Ge=!1,Ie=!1,z=null,we=null,be=null,Me=null,ue=null;function xp(){const o=localStorage.getItem("persona")||"default";let e=En[o].instruction;o==="custom"&&(e=localStorage.getItem("systemInstruction")||En.default.instruction);const n=localStorage.getItem("responseLength")||"medium";let i="";return n==="short"?i="IMPORTANT: Your response must be very short and concise. Aim for 1-2 paragraphs maximum.":n==="long"?i="IMPORTANT: Your response must be very long, detailed, and comprehensive. Please explore the topic in depth, use multiple paragraphs, and provide as much information as you can.":n==="super_long"&&(i="CRITICAL INSTRUCTION: Your response must be extremely long, exhaustive, and deeply comprehensive. Write a detailed, multi-page essay on the topic. Explore every possible facet, include extensive examples, and provide as much information, detail, and depth as is physically possible. The user expects a response of thesis-level length and quality."),[e,i].filter(Boolean).join(`

---

`)}function Zn(){const o=`chat_${Date.now()}`;I=o,k[o]=[],Fe[o]="New Chat",j(),Ot(o),pt()}async function Ot(o){I=o,localStorage.setItem("activeChatId",o),Q.innerHTML="";const t=k[o]||[];if(t.length===0)xe(!0);else{xe(!1);for(const[i,s]of t.entries())await q(s.role,s.parts,i)}const e=Fe[o]||"New Chat",n=ps.querySelector("h1");n.textContent=e,e==="New Chat"&&(n.textContent="No1 AI"),rp.textContent="1-no1-chat",pt(),Ze(),Ie&&xs()}function Sp(o){if(delete k[o],delete Fe[o],delete Ye[o],I===o){I=null;const t=Object.keys(k);t.length>0?Ot(t[0]):Zn()}j(),pt()}function _p(o){const t=/<--SOURCES:(.*?)-->/s,e=o.match(t);if(e&&e[1])try{const n=JSON.parse(e[1]);return{cleanText:o.replace(t,"").trim(),sources:n}}catch(n){return console.error("Failed to parse sources JSON:",n),{cleanText:o,sources:null}}return{cleanText:o,sources:null}}function kp(o,t){const e=document.createElement("div");e.className="sources-container";const n=document.createElement("h4");n.textContent="Sources",e.appendChild(n);const i=document.createElement("div");i.className="source-list",t.forEach(s=>{const a=document.createElement("a");a.href=s.uri,a.target="_blank",a.rel="noopener noreferrer",a.className="source-link",a.textContent=s.title||new URL(s.uri).hostname,i.appendChild(a)}),e.appendChild(i),o.appendChild(e)}async function q(o,t,e){const n=document.createElement("div");n.classList.add("message-wrapper",`${o}-message`),n.dataset.historyIndex=String(e);const i=document.createElement("div");i.className="avatar",o==="user"?i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>':i.textContent="",n.appendChild(i);const s=document.createElement("div");s.className="message-content";const a=document.createElement("div");a.classList.add("message-bubble");let u=!1,d="";const c=document.createElement("div");c.className="uploaded-media-grid";for(const f of t)if("text"in f&&f.text){if(o==="user"&&f.text.startsWith("/voice ")){const h=f.text.substring(7),v=document.createElement("div");v.className="voice-command-bubble";const y=document.createElement("button");y.className="icon-button play-voice-button",y.title="Play Text",y.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M320-200v-560l440 280-440 280Zm80-280Zm0 134 210-134-210-134v268Z"/></svg>',y.onclick=C=>{C.stopPropagation(),Xn(h,a)};const T=document.createElement("p");T.textContent=h,v.appendChild(y),v.appendChild(T),a.appendChild(v),u=!0;continue}const p=document.createElement("div"),{cleanText:m,sources:g}=_p(f.text);d+=m+`
`,p.innerHTML=await R.parse(m),o==="model"&&Up(p),a.appendChild(p),g&&g.length>0&&kp(s,g),u=!0}else if("inlineData"in f&&f.inlineData){const p=f.inlineData.mimeType,m=f.inlineData.data;if(p.startsWith("image/")){const g=document.createElement("div");g.className="media-container";const h=document.createElement("img");if(h.src=`data:${p};base64,${m}`,h.dataset.mimeType=p,h.alt=o==="user"?"User uploaded image":"AI generated image",h.classList.add(o==="user"?"uploaded-image":"generated-image"),g.appendChild(h),o==="model"){const v=document.createElement("button");v.className="edit-image-button icon-button",v.title="Edit Image",v.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>',g.appendChild(v)}c.appendChild(g),u=!0}else if(p.startsWith("video/")){const g=document.createElement("video");g.src=`data:${p};base64,${m}`,g.controls=!0,g.classList.add("uploaded-video"),c.appendChild(g),u=!0}else if(p.startsWith("audio/")){const g=document.createElement("audio");g.src=`data:${p};base64,${m}`,g.controls=!0,g.classList.add("uploaded-audio"),a.appendChild(g),u=!0}}if(c.hasChildNodes()&&a.insertBefore(c,a.firstChild),u||a.appendChild(document.createElement("div")),s.appendChild(a),u){const f=Ap(o,d.trim(),e,t);s.appendChild(f)}return n.appendChild(s),Q.appendChild(n),Q.scrollTop=Q.scrollHeight,a}function Ap(o,t,e,n){const i=document.createElement("div");if(i.className="message-action-toolbar",o==="user"){const s=document.createElement("button");s.className="icon-button",s.title="Edit",s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>',s.onclick=()=>Mp(e,n),i.appendChild(s)}else{const s=document.createElement("button");s.className="icon-button",s.title="Copy",s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>',s.onclick=()=>{navigator.clipboard.writeText(t).then(()=>{s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',setTimeout(()=>{s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>'},2e3)})},i.appendChild(s);const a=document.createElement("button");a.className="icon-button",a.title="Read Aloud",a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>';const u=document.querySelector(`.message-wrapper[data-history-index="${e}"] .message-bubble`);a.onclick=()=>{Xn(t,u)},i.appendChild(a);const d=document.createElement("button");d.className="icon-button",d.title="Regenerate",d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>',d.onclick=()=>Rp(),i.appendChild(d)}return i}async function Zt(o){var u,d,c,f,p,m,g,h,v;if(o==null||o.preventDefault(),!I){console.error("No active chat session.");return}const t=V.value.trim();let e;if(pe){if(!t){Ze();return}k[I]=k[I].slice(0,pe.index),Array.from(Q.querySelectorAll(".message-wrapper")).slice(pe.index).forEach(w=>w.remove());const C=((u=k[I][pe.index-1])==null?void 0:u.parts)||[],A=C.findIndex(w=>"text"in w);e=[...C],A>-1?e[A]={text:t}:e.push({text:t})}else{if(!t&&Ee.length===0)return;e=[],Ee.forEach(y=>{e.push({inlineData:{mimeType:y.mimeType,data:y.data}})}),t&&e.push({text:t})}nt=e;const n=e.find(y=>"text"in y&&y.text);if(n&&"text"in n&&n.text.startsWith("/imagine ")){await Pp(n.text.substring(8).trim());return}if(n&&"text"in n&&n.text.startsWith("/voice ")){await Lp(n.text.substring(7).trim());return}if(n&&"text"in n&&n.text.trim()==="/voicetotext"){Dp();return}if(n&&"text"in n&&n.text.startsWith("/calculate ")){const T={functionCall:{name:"calculator",args:{expression:n.text.substring(11).trim()}}};e.push(T)}xe(!1),Ie&&$&&$.stop(),Be(!0);const i=((d=k[I])==null?void 0:d.length)||0;await q("user",e.filter(y=>!("functionCall"in y)),i),Ze();const s=await q("model",[{text:'<div class="typing-indicator"><span></span><span></span><span></span></div>'}],i+1),a=s.parentElement;try{Ye[I]||(Ye[I]=Ce.chats.create({model:wp,history:k[I]}));const y=Ye[I],T={systemInstruction:xp()};ds.checked?T.tools=[{googleSearch:{}}]:T.tools=Ip;const C=localStorage.getItem("thinkingMode")||"1",A={0:0,2:250,5:1500,10:5e3,20:1e4,50:2e4,100:24576};A.hasOwnProperty(C)&&C!=="1"&&(T.thinkingConfig={thinkingBudget:A[C]}),Ge=!0,hi.classList.remove("hidden");let w=!0,M=[];for(;w;){const ie=await y.sendMessageStream({message:e,config:T});let K="";const H=[];let Y=[];for await(const S of ie){if(!Ge){w=!1;break}S&&S.text&&(K+=S.text,s.innerHTML=await R.parse(K+" "),Q.scrollTop=Q.scrollHeight);const L=(m=(p=(f=(c=S.candidates)==null?void 0:c[0])==null?void 0:f.content)==null?void 0:p.parts)==null?void 0:m.filter(D=>"functionCall"in D&&D.functionCall).map(D=>D.functionCall);L&&H.push(...L),(v=(h=(g=S.candidates)==null?void 0:g[0])==null?void 0:h.groundingMetadata)!=null&&v.groundingChunks&&Y.push(...S.candidates[0].groundingMetadata.groundingChunks)}if(!Ge)break;if(H&&H.length>0){const S=H[0],L={functionResponse:{name:S.name,response:{}}},D=Bp(`Using ${S.name}...`,a);switch(S.name){case"calculator":L.functionResponse.response={result:bp(S.args.expression)};break;default:L.functionResponse.response={error:`Unknown tool: ${S.name}`}}e=[L],D.remove()}else{w=!1;let S="";if(Y&&Y.length>0){const L=Y.filter(D=>D.web).map(D=>({uri:D.web.uri,title:D.web.title}));L.length>0&&(S=`

<--SOURCES:${JSON.stringify(L)}-->`)}M=[{text:K+S}]}}s.parentElement.parentElement.remove(),Ge&&M.length>0&&(await q("model",M,i+1),k[I].push({role:"user",parts:nt}),k[I].push({role:"model",parts:M})),delete Ye[I],j(),k[I].length===2&&Qn(I,k[I])}catch(y){console.error(y);const T=Q.querySelector(`.message-wrapper[data-history-index="${i+1}"]`);T&&T.remove();const C=y instanceof Error?y.message:String(y);await q("model",[{text:`<p class="error">An error occurred: ${C}. The API key might be missing or invalid.</p>`}],i+1)}finally{if(Ge=!1,hi.classList.add("hidden"),Be(!1),Ie){const y=Q.querySelector(".message-wrapper:last-child .message-bubble");y!=null&&y.textContent&&Xn(y.textContent,y)}}}function Mp(o,t){const e=t.find(i=>"text"in i);if(!e||!("text"in e))return;const n=Q.querySelector(`.message-wrapper[data-history-index="${o}"]`);n&&(pe={index:o,wrapper:n},V.value=e.text,V.focus(),V.style.height="auto",V.style.height=`${V.scrollHeight}px`,n.classList.add("editing"),Jt.classList.add("editing-mode"))}async function Rp(){var e;if(!nt||!I)return;const o=k[I];if(o.length<2)return;k[I]=o.slice(0,-2);const t=Q.querySelectorAll(".message-wrapper");t.length>=2&&(t[t.length-1].remove(),t[t.length-2].remove()),delete Ye[I],j(),V.value=((e=nt.find(n=>"text"in n))==null?void 0:e.text)||"",Ee=nt.filter(n=>"inlineData"in n&&n.inlineData).map(n=>({data:n.inlineData.data,mimeType:n.inlineData.mimeType,previewUrl:`data:${n.inlineData.mimeType};base64,${n.inlineData.data}`,name:"attached_file"})),Qt(),Zt()}async function Pp(o){var i;xe(!1),Be(!0);const t=[{text:`/imagine ${o}`}],e=((i=k[I])==null?void 0:i.length)||0;await q("user",t,e),Ze();const n=await q("model",[{text:'<div class="image-gen-indicator"><div class="spinner"></div><p>Generating image...</p></div>'}],e+1);try{const u=[{inlineData:{mimeType:"image/jpeg",data:(await Ce.models.generateImages({model:"imagen-4.0-generate-001",prompt:o,config:{numberOfImages:1,outputMimeType:"image/jpeg"}})).generatedImages[0].image.imageBytes}}];n.parentElement.parentElement.remove(),await q("model",u,e+1),I&&(k[I].push({role:"user",parts:t}),k[I].push({role:"model",parts:u}),j(),k[I].length===2&&Qn(I,k[I]))}catch(s){console.error("Image generation failed:",s);const a=s instanceof Error?s.message:String(s);n.innerHTML=`<p class="error">Image generation failed: ${a}.</p>`}finally{Be(!1)}}async function Lp(o){if(!o||!I)return;xe(!1);const t=[{text:`/voice ${o}`}];k[I].push({role:"user",parts:t}),j();const e=k[I].length-1;await q("user",t,e),Ze()}function Dp(){Ze(),zn.click()}async function Np(o){var i;const e=(i=o.target.files)==null?void 0:i[0];if(!e||!I)return;xe(!1),Be(!0);const n=new FileReader;n.onloadend=async()=>{try{if(typeof n.result!="string")return;const s=n.result.split(",")[1],a={inlineData:{mimeType:e.type,data:s}},u={text:"Transcribe the following audio file. Provide only the transcribed text."},d=[a],c=[a,u],f=k[I].length;await q("user",d,f),k[I].push({role:"user",parts:d}),j();const p=await q("model",[{text:'<div class="typing-indicator"><span></span><span></span><span></span></div>'}],f+1),h=[{text:(await Ce.models.generateContent({model:"gemini-2.5-flash",contents:{parts:c}})).text}];p.parentElement.parentElement.remove(),await q("model",h,f+1),k[I].push({role:"model",parts:h}),j(),k[I].length===2&&Qn(I,k[I])}catch(s){console.error("Transcription failed:",s),await q("model",[{text:'<p class="error">Speech-to-text failed. Please try again.</p>'}],k[I].length)}finally{Be(!1),zn.value=""}},n.readAsDataURL(e)}async function Qn(o,t){var e;try{const n=((e=t[0].parts.find(c=>"text"in c))==null?void 0:e.text)||"Media prompt",i=t[1].parts.find(c=>"text"in c),s=(i==null?void 0:i.text)||"Generated a response.",a=`Based on this exchange, create a very short, concise title (4-5 words max). Do not use quotes.
    User: "${n.substring(0,100)}"
    Model: "${s.substring(0,150)}"`,u=await Ce.models.generateContent({model:"gemini-2.5-flash",contents:a}),d=u==null?void 0:u.text;if(d){const c=d.trim().replace(/["']/g,"");c&&(Fe[o]=c,ps.querySelector("h1").textContent=c,j(),pt())}}catch(n){console.error("Failed to generate title:",n)}}function bp(o){try{const t=o.replace(/[^-()\d/*+.]/g,"");return t!==o?"Error: Invalid characters in expression.":new Function("return "+t)()}catch(t){return`Error: ${t instanceof Error?t.message:String(t)}`}}function Bp(o,t){const e=document.createElement("div");return e.className="tool-use-indicator",e.innerHTML=`<div class="spinner"></div><span>${o}</span>`,t.insertBefore(e,t.firstChild),e}function j(){localStorage.setItem("allChats",JSON.stringify(k)),localStorage.setItem("chatTitles",JSON.stringify(Fe)),I&&localStorage.setItem("activeChatId",I)}function Vp(){k=JSON.parse(localStorage.getItem("allChats")||"{}"),Fe=JSON.parse(localStorage.getItem("chatTitles")||"{}"),I=localStorage.getItem("activeChatId")}function Be(o){V.disabled=o,jf.disabled=o,le.disabled=o,Hn.disabled=o,ds.disabled=o,o||V.focus()}function Ze(){V.value="",V.style.height="auto",fs.classList.add("hidden"),Ee=[],vn.innerHTML="",Yn.value="",Wn.value="",pe&&(pe.wrapper.classList.remove("editing"),pe=null),Jt.classList.remove("editing-mode")}function Up(o){o.querySelectorAll("pre").forEach(e=>{if(e.querySelector(".copy-code-button"))return;const n=document.createElement("button");n.className="copy-code-button",n.textContent="Copy",n.onclick=()=>{const i=e.querySelector("code");i&&(navigator.clipboard.writeText(i.innerText),n.textContent="Copied!",setTimeout(()=>{n.textContent="Copy"},2e3))},e.appendChild(n)})}function xe(o){ms.classList.toggle("hidden",!o),Q.classList.toggle("hidden",o)}function pt(){yi.innerHTML="",Object.keys(k).sort((t,e)=>parseInt(e.split("_")[1]||"0")-parseInt(t.split("_")[1]||"0")).forEach(t=>{const e=document.createElement("div");e.className="chat-history-item",e.dataset.chatId=t,t===I&&e.classList.add("active");const n=document.createElement("span");n.textContent=Fe[t]||"New Chat",e.appendChild(n);const i=document.createElement("button");i.className="icon-button delete-chat-button",i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',i.ariaLabel="Delete chat",i.title="Delete chat",i.onclick=s=>{s.stopPropagation(),confirm("Are you sure you want to delete this chat?")&&Sp(t)},e.appendChild(i),e.onclick=()=>{window.innerWidth<850&&document.body.classList.remove("sidebar-open"),Ot(t)},yi.appendChild(e)})}Jt.addEventListener("submit",Zt);op.addEventListener("click",()=>{document.body.classList.remove("sidebar-open"),Zn()});np.addEventListener("click",()=>{Ge=!1});V.addEventListener("input",()=>{V.style.height="auto",V.style.height=`${V.scrollHeight}px`;const o=V.value.startsWith("/")&&!V.value.includes(" ");fs.classList.toggle("hidden",!o)});lp.addEventListener("click",o=>{const e=o.target.closest(".prompt-card");e&&e.dataset.prompt&&(V.value=e.dataset.prompt,Zt())});ip.addEventListener("click",()=>{window.innerWidth<=850?document.body.classList.toggle("sidebar-open"):document.body.classList.toggle("sidebar-collapsed")});Q.addEventListener("click",o=>{const e=o.target.closest(".edit-image-button");if(e){const n=e.closest(".media-container"),i=n==null?void 0:n.querySelector(".generated-image");i&&Gp(i)}});function it(o){return new Promise((t,e)=>{const n=new FileReader;n.onloadend=()=>{typeof n.result=="string"?t({data:n.result.split(",")[1],mimeType:o.type,previewUrl:n.result,name:o.name}):e(new Error("Failed to read file."))},n.onerror=e,n.readAsDataURL(o)})}function Qt(){vn.innerHTML="",Ee.forEach((o,t)=>{const e=document.createElement("div");if(e.className="file-preview-item",o.mimeType.startsWith("image/")){const i=document.createElement("img");i.src=o.previewUrl,i.alt=o.name,e.appendChild(i)}else if(o.mimeType.startsWith("video/")){const i=document.createElement("video");i.src=o.previewUrl,i.muted=!0,e.appendChild(i)}const n=document.createElement("button");n.className="remove-file-button",n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',n.onclick=()=>{Ee.splice(t,1),Qt()},e.appendChild(n),vn.appendChild(e)})}Hn.addEventListener("click",o=>{o.stopPropagation(),Pe.classList.toggle("hidden")});document.addEventListener("click",o=>{!Pe.classList.contains("hidden")&&!Pe.contains(o.target)&&o.target!==Hn&&Pe.classList.add("hidden")});ep.addEventListener("click",()=>{Yn.click(),Pe.classList.add("hidden")});tp.addEventListener("click",()=>{Wn.click(),Pe.classList.add("hidden")});Yn.addEventListener("change",async o=>{const t=o.target;if(t.files){for(const e of Array.from(t.files))try{const n=await it(e);Ee.push(n)}catch(n){console.error("Error processing file:",n)}Qt()}});Wn.addEventListener("change",async o=>{var n;const e=(n=o.target.files)==null?void 0:n[0];if(e)try{const i=await it(e);Ee.push(i),Qt()}catch(i){console.error("Error processing video file:",i)}});zn.addEventListener("change",Np);const vi=window.SpeechRecognition||window.webkitSpeechRecognition,de=window.speechSynthesis;let $=null;async function Xn(o,t){if(!o||o.trim()==="")return;let e="en-US";try{const n=await Ce.models.generateContent({model:"gemini-2.5-flash",contents:`Detect the language of the following text and return only its BCP-47 language code (like 'en-US' or 'fa-IR'). Text: "${o}"`}),i=n==null?void 0:n.text;if(i){const s=i.trim();/^[a-z]{2}(-[A-Z]{2})?$/.test(s)?e=s:console.warn(`Could not validate BCP-47 code: '${s}'.`)}else console.warn("Language detection did not return text.")}catch(n){console.error("Language detection call failed:",n)}$p(o,t,e)}function $p(o,t,e="en-US"){if(de.speaking&&(de.cancel(),z&&z.classList.remove("speaking-bubble"),z===t)){z=null;return}const n=new SpeechSynthesisUtterance(o);n.lang=e;const i=()=>{const s=de.getVoices(),a=s.find(u=>u.lang===e)||s.find(u=>u.lang.startsWith(e.split("-")[0]));a&&(n.voice=a),de.speak(n)};n.onstart=()=>{z=t,z==null||z.classList.add("speaking-bubble")},n.onend=()=>{z==null||z.classList.remove("speaking-bubble"),z=null,Ie&&($==null||$.start())},n.onerror=s=>console.error("SpeechSynthesisUtterance.onerror",s),de.getVoices().length===0?de.onvoiceschanged=i:i()}function Fp(){Ie=!0,le.classList.add("conversing"),le.title="Stop voice conversation",V.placeholder="Listening...",$==null||$.start()}function xs(){Ie=!1,de.cancel(),$==null||$.stop(),le.classList.remove("conversing","recording"),le.title="Start voice conversation",V.placeholder="Ask No1 AI anything, or type / for commands...",z==null||z.classList.remove("speaking-bubble")}vi&&de?($=new vi,$.continuous=!1,$.interimResults=!0,$.onstart=()=>le.classList.add("recording"),$.onend=()=>{le.classList.remove("recording"),Ie&&V.value.trim()&&Zt()},$.onresult=o=>{let t="";for(let e=o.resultIndex;e<o.results.length;++e)o.results[e].isFinal&&(t+=o.results[e][0].transcript);V.value=t,V.dispatchEvent(new Event("input"))},$.onerror=o=>console.error("Speech recognition error:",o.error),le.addEventListener("click",()=>{Ie?xs():Fp()})):(le.style.display="none",console.warn("Speech Recognition or Synthesis API not supported."));function Ss(o){document.body.dataset.theme=o,localStorage.setItem("theme",o)}ap.addEventListener("click",()=>Ss(document.body.dataset.theme==="dark"?"light":"dark"));function jn(){const o=localStorage.getItem("persona")||"default";sp.textContent=En[o].name,gs.classList.toggle("hidden",o!=="custom")}up.addEventListener("click",()=>{Dt.value=localStorage.getItem("persona")||"default",hs.value=localStorage.getItem("systemInstruction")||"",ys.value=localStorage.getItem("thinkingMode")||"1",vs.value=localStorage.getItem("responseLength")||"medium",jn(),Jn.classList.remove("hidden")});cp.addEventListener("click",()=>Jn.classList.add("hidden"));Dt.addEventListener("change",()=>{gs.classList.toggle("hidden",Dt.value!=="custom")});dp.addEventListener("click",()=>{localStorage.setItem("persona",Dt.value),localStorage.setItem("systemInstruction",hs.value),localStorage.setItem("thinkingMode",ys.value),localStorage.setItem("responseLength",vs.value),Jn.classList.add("hidden"),jn()});function _s(){we=null,be=null,Kt.value="",dt.value="",Oe.src="",Oe.classList.add("hidden"),Nt.classList.add("hidden"),oe.classList.remove("has-image"),bt.disabled=!0,Ts.classList.remove("hidden"),Tn.classList.add("hidden"),Cs.classList.add("hidden")}function eo(){bt.disabled=!(we&&dt.value.trim())}async function ks(o){if(!o||!o.type.startsWith("image/")){alert("Please select a valid image file.");return}we=o,Oe.src=URL.createObjectURL(o),Oe.classList.remove("hidden"),Nt.classList.remove("hidden"),oe.classList.add("has-image"),eo()}fp.addEventListener("click",()=>{_s(),Kn.classList.remove("hidden"),Pe.classList.add("hidden")});pp.addEventListener("click",()=>{Kn.classList.add("hidden")});oe.addEventListener("click",()=>Kt.click());Kt.addEventListener("change",o=>{var t;return ks((t=o.target.files)==null?void 0:t[0])});["dragenter","dragover","dragleave","drop"].forEach(o=>{oe.addEventListener(o,t=>{t.preventDefault(),t.stopPropagation()},!1)});["dragenter","dragover"].forEach(o=>{oe.addEventListener(o,()=>oe.classList.add("drag-over"))});["dragleave","drop"].forEach(o=>{oe.addEventListener(o,()=>oe.classList.remove("drag-over"))});oe.addEventListener("drop",o=>{const t=o.dataTransfer,e=t==null?void 0:t.files[0];e&&ks(e)});Nt.addEventListener("click",o=>{o.stopPropagation(),we=null,Kt.value="",Oe.src="",Oe.classList.add("hidden"),Nt.classList.add("hidden"),oe.classList.remove("has-image"),eo()});dt.addEventListener("input",eo);bt.addEventListener("click",async()=>{var n,i,s,a;if(bt.disabled||!we)return;Ts.classList.add("hidden"),Tn.classList.remove("hidden");const o=["Warming up the video generators...","Storyboarding your scene...","Rendering the first few frames...","This can take a few minutes, good things come to those who wait!","Applying visual effects...","Polishing the pixels...","Finalizing the video..."];let t=0;tn.textContent=o[t];const e=setInterval(()=>{t=(t+1)%o.length,tn.textContent=o[t]},5e3);try{const u=await it(we);let d=await Ce.models.generateVideos({model:"veo-2.0-generate-001",prompt:dt.value.trim(),image:{imageBytes:u.data,mimeType:u.mimeType},config:{numberOfVideos:1}});for(;!d.done;)await new Promise(p=>setTimeout(p,1e4)),d=await Ce.operations.getVideosOperation({operation:d});const c=(a=(s=(i=(n=d.response)==null?void 0:n.generatedVideos)==null?void 0:i[0])==null?void 0:s.video)==null?void 0:a.uri;if(!c)throw new Error("Video generation succeeded but no download link was found.");const f=await fetch(`${c}&key=undefined`);if(!f.ok)throw new Error(`Failed to fetch video: ${f.statusText}`);be=await f.blob(),mp.src=URL.createObjectURL(be),Tn.classList.add("hidden"),Cs.classList.remove("hidden")}catch(u){console.error("Video generation failed:",u);const d=u instanceof Error?u.message:String(u);tn.textContent=`An error occurred: ${d}`,setTimeout(()=>{_s()},5e3)}finally{clearInterval(e)}});gp.addEventListener("click",()=>{if(!be)return;const o=URL.createObjectURL(be),t=document.createElement("a");t.href=o,t.download=`no1-ai-video-${Date.now()}.mp4`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(o)});hp.addEventListener("click",async()=>{if(!(!we||!be||!I))try{const o=await it(we),t=await it(new File([be],"generated-video.mp4",{type:"video/mp4"})),e=[{inlineData:{mimeType:o.mimeType,data:o.data}},{text:`Video generated with prompt: "${dt.value}"`}],n=[{inlineData:{mimeType:t.mimeType,data:t.data}}];xe(!1);const i=k[I].length;await q("user",e,i),await q("model",n,i+1),k[I].push({role:"user",parts:e}),k[I].push({role:"model",parts:n}),j(),Kn.classList.add("hidden")}catch(o){console.error("Failed to add video to chat:",o),alert("Could not add video to chat. Please try downloading it instead.")}});function qp(){Me=null,ue=null,ft.value="",Is.src="",ws.src="",Bt.disabled=!0,Cn.classList.remove("hidden"),wt.classList.add("hidden"),Es.classList.add("hidden")}function As(){Bt.disabled=!(Me&&ft.value.trim())}function Gp(o){qp();const t=o.src,e=o.dataset.mimeType||"image/jpeg",n=t.split(",")[1];Me={mimeType:e,data:n},Is.src=t,ws.src=t,On.classList.remove("hidden"),As()}yp.addEventListener("click",()=>{On.classList.add("hidden")});ft.addEventListener("input",As);Bt.addEventListener("click",async()=>{var o,t,e;if(!(Bt.disabled||!Me)){Cn.classList.add("hidden"),wt.classList.remove("hidden");try{const n={inlineData:Me},i={text:ft.value.trim()},a=(e=(t=(o=(await Ce.models.generateContent({model:"gemini-2.5-flash-image-preview",contents:{parts:[n,i]},config:{responseModalities:[me.IMAGE,me.TEXT]}})).candidates)==null?void 0:o[0])==null?void 0:t.content)==null?void 0:e.parts.find(u=>u.inlineData);if(!a||!a.inlineData)throw new Error("The model did not return an edited image.");ue={data:a.inlineData.data,mimeType:a.inlineData.mimeType||"image/png"},vp.src=`data:${Me.mimeType};base64,${Me.data}`,Tp.src=`data:${ue.mimeType};base64,${ue.data}`,wt.classList.add("hidden"),Es.classList.remove("hidden")}catch(n){console.error("Image editing failed:",n);const i=n instanceof Error?n.message:String(n);alert(`Image editing failed: ${i}`),wt.classList.add("hidden"),Cn.classList.remove("hidden")}}});Cp.addEventListener("click",()=>{if(!ue)return;const o=document.createElement("a");o.href=`data:${ue.mimeType};base64,${ue.data}`,o.download=`no1-ai-edited-image-${Date.now()}.png`,document.body.appendChild(o),o.click(),document.body.removeChild(o)});Ep.addEventListener("click",async()=>{if(!ue||!I)return;const t=[{text:`Edited the previous image with the prompt: "${ft.value}"`}],e=[{inlineData:ue}];xe(!1);const n=k[I].length;await q("user",t,n),await q("model",e,n+1),k[I].push({role:"user",parts:t}),k[I].push({role:"model",parts:e}),j(),On.classList.add("hidden")});function Hp(){Ss(localStorage.getItem("theme")||"dark"),Vp(),jn(),Object.keys(k).length===0||!I||!k[I]?Zn():Ot(I),pt(),Be(!1)}Hp();
